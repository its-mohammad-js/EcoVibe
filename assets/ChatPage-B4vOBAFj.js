import{r as d,b as T,u as W,ar as fe,_ as B,j as e,K as X,as as _,at as ce,H as he,au as ge,av as G,aw as pe,ax as ye,ay as be,az as Q,aA as ve,aB as J,p as V,aC as te,V as F,W as H,al as E,X as Y,aa as ee,aD as je,aE as Ne,aF as we,y as Ie,aG as Ce,aH as Se,aI as ke,aJ as Me,aK as Le,ak as ze,aL as ne,aM as Te,aN as oe,aO as $e,aP as De}from"./index-B5E2kmdf.js";import{g as D,o as Re,r as z,a as Ee,b as K,c as Oe,s as Ae,q as U,u as $,d as P,e as Pe}from"./index.esm2017-ihnOV2J3.js";import{l as q}from"./lodash-BYUE0afR.js";import{C as _e}from"./index-D5kZ4OLN.js";import{R as Be}from"./index-D_S0xUBk.js";import{M as de,a as ue}from"./index.esm-CJ4NjDtu.js";const xe=d.createContext();function Ve({children:s}){var N;const[{status:r,rooms:l},o]=d.useState({rooms:[],status:null}),[t,f]=d.useState(null),[i,n]=d.useState(null),[a,x]=d.useState(null),{userId:c,personalInformation:h,businessInformation:u,userType:m,auth_status:p}=T(b=>b.userData),v=W(),y=D(),w=fe(),j=(N=w==null?void 0:w.state)==null?void 0:N.roomId;d.useEffect(()=>{t&&v(w.pathname,{roomId:null})},[t]),d.useEffect(()=>{if(j){const b=l.find(C=>C.roomId===j);f(b)}else t&&f(l.find(b=>b.roomId===t.roomId))},[j,l]);function g(){const b=z(y,"rooms");K(b,C=>{if(!C.exists()){o({rooms:[],status:"No Conversations Yet..."});return}const O=Object.entries(C.val()).map(([L,A])=>({...A,roomId:L})).filter(({members:L})=>L.includes(c)).map(L=>({roomId:L.roomId,messageList:L.messageList||null,members:L.members,owner:L[c],reciver:{...q.find(L,(A,Z)=>![c,"roomId","messageList","members"].includes(Z)),reciverId:Object.keys(L).find(A=>![c,"roomId","messageList","members"].includes(A))}}));o({rooms:O,status:O.length?null:"No Conversations Yet..."})})}d.useEffect(()=>{t&&c&&Re(z(y,`rooms/${t.roomId}/${c}/last_seen`)).set({date:0})},[t,c]),d.useEffect(()=>{if(p===200){Ee(y);const b=z(y,".info/connected");K(b,C=>{C.val()===!0?g():o({rooms:[],status:"loading..."})})}else p===401&&(B("Create an account to join the chat!"),v("/EcoVibe/Customers/sign-up"));return()=>{Oe(y),o({rooms:[],status:null})}},[c]),d.useEffect(()=>{!t&&!j&&(n(null),x(null))},[j,t]);const I=async b=>{const C=l.find(({members:S})=>S.includes(c)&&S.includes(b.userId));if(C)f(C);else try{const S=`FROM:${c}&TO:${b.userId}`;console.log({roomId:S,[c]:{...h,...u,userType:m},[b.userId]:{...b.personalInformation,...b.businessInformation,userType:b.userType},members:[c,b.userId]}),await Ae(z(y,`rooms/${S}`),{roomId:S,[c]:{...h,...u,userType:m},[b.userId]:{...b.personalInformation,...b.businessInformation,userType:b.userType},members:[c,b.userId]}),f(l.find(O=>O.roomId===S))}catch(S){console.log(S),B.error("There was an error, please try again later")}};return e.jsx(xe.Provider,{value:{rooms:l,status:r,selectedRoom:t,setSelectedRoom:f,selectedMessage:i,setSelectedMessage:n,messageMode:a,setMode:x,createNewChatRoom:I},children:s})}const k=()=>d.useContext(xe);function le({action:s,backTitle:r,sureTitle:l,message:o,closeModal:t,submitCallBack:f}){return e.jsxs("div",{className:"bg-gray-50 px-4 py-2 rounded-md flex flex-col gap-y-2 w-80 lg:w-96 xl:w-[30rem]",children:[e.jsx("h4",{className:"text-lg xl:text-2xl font-bold",children:s||"Alert"}),e.jsx("p",{className:"line-clamp-6",children:o||"Are You Sure?"}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx("button",{onClick:()=>t(),className:"px-4 py-2 text-lg hover:bg-gray-200 transition-all rounded-md",children:r||"Cancel"}),e.jsx("button",{onClick:()=>{f(),t()},className:"px-4 py-2 text-lg hover:bg-gray-200 transition-all rounded-md",children:l||"Im Sure"})]})]})}const ie=({room:s,mode:r,deleteRoom:l})=>{var Z,ae;const{profilePic:o,last_seen:t,first_name:f,last_name:i,business_name:n,userType:a}=s.reciver,[x,c]=d.useState(!1),h=d.useRef();X(h,()=>c(!1));const[u,m]=d.useState({x:0,y:0}),[p,v]=d.useState(!1),{content:y,createdAt:w,type:j}=((Z=s.messageList)==null?void 0:Z.at(-1))||{},[g,I]=d.useState(""),{selectedRoom:N,setSelectedRoom:b,setSelectedMessage:C,rooms:S}=k(),[O,L]=d.useState(!1);d.useEffect(()=>{const M=new Date(w),R=new Date;M.getFullYear()===R.getFullYear()&&M.getMonth()===R.getMonth()&&M.getDate()===R.getDate()?I(M.toLocaleTimeString("en-us",{month:"2-digit",hour:"2-digit",minute:"2-digit"})):I(M.toDateString())},[w]);function A(){var R;C(r==="message"?(R=s.messageList)==null?void 0:R.at(-1):null),r==="message"&&setTimeout(()=>{C(null)},2e3);const M=S.find(({roomId:se})=>se===s.roomId);b(M)}return d.useEffect(()=>{if(!t){O.current=!1;return}const M=D(),R=K(z(M,".info/serverTimeOffset"),se=>{const me=Date.now()+se.val()-(t==null?void 0:t.date),re=Math.floor(me/1e3);console.log(re),L(re>=30)});return()=>R()},[t,N]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{onContextMenu:M=>{M.preventDefault(),m({x:M.clientX,y:M.clientY}),c(!x)},onClick:()=>A(),className:"w-full h-24 relative select-none rounded-md flex items-center hover:bg-gray-300/30 transition-all cursor-pointer gap-x-2 px-4 py-2",children:[e.jsxs("div",{className:"relative",children:[o?e.jsx("img",{src:o,className:"size-20 bg-gray-100 rounded-full"}):e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(_,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})}),e.jsx("div",{className:`
              ${O?"bg-gray-400":"bg-green-400"} ${r==="message"&&"hidden"} absolute -bottom-1 size-5 right-1 rounded-full transition-all`})]}),e.jsxs("div",{className:"flex flex-col mt-2.5 justify-center h-full w-2/3 select-none",children:[e.jsx("h6",{className:"line-clamp-2 font-bold text-lg text-gray-800",children:a==="customer"?f+" "+i:n}),e.jsx("p",{className:"line-clamp-1 text-gray-700 break-words max-w-56",children:(ae=s==null?void 0:s.messageList)!=null&&ae.length?j==="text"?y:j:"Nothing yet"}),e.jsx("p",{className:"absolute top-2 right-2 text-sm text-gray-700",children:w?g:""})]})]}),e.jsxs("div",{style:{top:u.y,left:u.x/1.7},ref:h,className:`${x?"opacity-100 visible":"opacity-0 invisible"} fixed rounded-md transition-all overflow-hidden z-50 top-24 flex flex-col`,children:[e.jsxs("button",{onClick:()=>{const M=S.find(({roomId:R})=>R===s.roomId);b(M),c(!1)},className:"p-4 bg-gray-100 hover:bg-gray-200 transition-all flex items-center gap-x-2",children:[e.jsx(_e,{className:"text-2xl"}),"open Chat"]}),e.jsxs("button",{onClick:()=>{v(!0),c(!1)},className:"p-4 bg-gray-100 hover:bg-gray-200 transition-all flex items-center gap-x-2 text-red-500",children:[e.jsx(ce,{className:"text-2xl"}),"delete chat"]})]}),e.jsxs("div",{className:`${p?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex justify-center items-center transition-all`,children:[e.jsx(le,{action:"Delete Chat Room",closeModal:()=>v(!1),message:"Are You Sure You Want To Delete This Chat?, you cannot access messages again...",submitCallBack:()=>l(s.roomId,S)}),e.jsx("div",{onClick:()=>v(!1),className:"absolute inset-0 bg-gray-950/50 -z-10"})]})]})};function Fe({openSideNav:s,deleteRoom:r}){const[l,o]=d.useState(""),{rooms:t,setSelectedRoom:f,selectedRoom:i,status:n}=k();he(".contacts-container");function a(c){const h=c.toLowerCase();return t.flatMap(({messageList:u,roomId:m,reciver:p})=>u==null?void 0:u.filter(v=>{var y;return(y=v==null?void 0:v.content)==null?void 0:y.toLowerCase().includes(h)}).map(v=>({messageList:[v],roomId:m,reciver:p})))}function x(c){const h=c.toLowerCase();return t.filter(({reciver:u})=>[u==null?void 0:u.business_name,u==null?void 0:u.first_name,u==null?void 0:u.last_name].some(m=>m==null?void 0:m.toLowerCase().includes(h)))}return e.jsxs("div",{className:`${i&&"hidden"} lg:!block lg:w-1/4 w-full h-screen bg-gray-50 flex flex-col`,children:[e.jsxs("div",{className:"",children:[e.jsx("div",{className:"bg-gray-50 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-1.5 cursor-pointer relative",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Messages"}),e.jsx("button",{onClick:()=>s(),className:"absolute -left-2 p-1.5 rounded-full text-4xl hover:text-gray-700 transition-all",children:e.jsx(ge,{})})]})}),e.jsx("div",{className:"w-full px-4 pb-2 pt-3",children:e.jsx("input",{onChange:({target:c})=>{var h;o((h=c.value)==null?void 0:h.toLowerCase())},type:"text",value:l,placeholder:"Search Messages & Contacts",className:"py-2.5 bg-gray-200 w-full outline-none px-4 rounded-lg placeholder:text-gray-500"})})]}),e.jsx("div",{className:`${!x(l).length||!(l!=null&&l.length)?"hidden":"basis-[19%] min-h-32"} overflow-x-auto overflow-y-hidden mx-auto flex px-4 gap-3 py-1 hidden-scroll-bar w-full contacts-container`,children:l&&e.jsx("div",{className:"flex items-center gap-x-4 select-none",children:x(l).map((c,h)=>{var u;return e.jsxs("div",{className:"w-24 gap-y-1 flex flex-col items-center justify-center",children:[e.jsx("div",{onClick:()=>f(c),className:"cursor-pointer",children:(u=c.reciver)!=null&&u.profilePic?e.jsx("img",{src:c.reciver.profilePic,className:"size-20 bg-gray-100 rounded-full"}):e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(_,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})})}),e.jsx("p",{onClick:()=>f(c),className:"line-clamp-2 break-words w-10/12 text-sm text-center cursor-pointer",children:c.reciver.userType==="customer"?c.reciver.first_name+" "+c.reciver.last_name:c.reciver.business_name})]},h)})})}),e.jsxs("div",{className:`${l!=null&&l.length?"basis-[55%]":""} flex flex-col overflow-auto relative styled-scroll-bar`,children:[e.jsxs("h2",{className:`${!(l!=null&&l.length)&&"hidden"} block px-4 sticky top-0 z-10 py-1 w-full bg-gray-200`,children:["Found ",a(l).length," Messages"]}),n?e.jsx("h4",{className:"px-2 py-1 absolute bottom-1/2 w-full flex justify-center",children:e.jsx("p",{className:"px-4 py-1 text-lg font-bold bg-gray-200/80 rounded-xl",children:n})}):l?a(l).map((c,h)=>e.jsx(ie,{room:c,mode:"message"},h)):t.map((c,h)=>e.jsx(ie,{room:c,mode:"user",deleteRoom:r},h))]})]})}function He({onCloseNav:s,navIsShow:r,openContacts:l}){const{personalInformation:o,userType:t,userId:f}=T(a=>a.userData),{auth_status:i}=T(a=>a.userData),n=W();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${r?"translate-x-0 opacity-100 visible":"-translate-x-16 opacity-0 invisible"} absolute transition-all ease-linear z-50 max-w-20 h-full bg-gray-50 px-4 py-4 flex flex-col items-center gap-y-6 border-r-2 rounded-r-2xl`,children:[e.jsx("button",{onClick:()=>s(),className:"px-2 py-2 bg-primary-500 text-gray-50 text-xl rounded-lg",children:e.jsx(G,{className:"text-3xl"})}),e.jsxs("div",{className:"flex flex-col h-full relative items-center gap-y-6",children:[e.jsxs("button",{onClick:()=>n("/EcoVibe/"),className:"text-3xl group flex items-center relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(pe,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Back To Home"})]}),e.jsxs("button",{disabled:i!==200,onClick:()=>{s(),l()},className:"text-3xl disabled:hidden group flex items-center relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(Be,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Search Contacts"})]}),e.jsxs("button",{onClick:()=>n(t==="customer"?"/EcoVibe/bag/orders":"/EcoVibe/Dashboard/Orders"),className:"text-3xl group flex items-center relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(ye,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Check Orders"})]}),e.jsxs("button",{onClick:()=>n("/EcoVibe/Dashboard"),disabled:t==="customer",className:"text-3xl group flex items-center disabled:hidden relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(be,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Dashboard"})]}),e.jsxs("div",{onClick:()=>n(t==="customer"?"/EcoVibe/profile":`/EcoVibe/seller/${f}`),className:"text-3xl absolute bottom-2 group flex items-center hover:bg-gray-200 transition-all rounded-lg",children:[e.jsx(e.Fragment,{children:o!=null&&o.profilePic?e.jsx("img",{src:o==null?void 0:o.profilePic,className:"rounded-full size-14 object-cover"}):e.jsx("p",{className:"p-2",children:e.jsx(_,{})})}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"My Profile"})]})]})]}),e.jsx("div",{onClick:()=>s(),className:`${r?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-40 bg-gray-950/50 backdrop-blur-sm`})]})}function Ye(s){return Q({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M2.287 2.326L2.692 2h.677v3h-.708V2.792l-.374.281v-.747zM5 3h10v1H5V3zm0 4h10v1H5V7zm10 4H5v1h10v-1zM3.742 7.626l.029-.039.065-.09a.84.84 0 0 0 .156-.507c0-.12-.02-.24-.057-.354a.848.848 0 0 0-.492-.529 1.123 1.123 0 0 0-.452-.082 1.094 1.094 0 0 0-.458.087.867.867 0 0 0-.479.522A1.038 1.038 0 0 0 2 6.957v.05h.81v-.05a.3.3 0 0 1 .046-.157.174.174 0 0 1 .057-.054.19.19 0 0 1 .172 0 .188.188 0 0 1 .056.06.24.24 0 0 1 .031.081.445.445 0 0 1-.036.29 1.309 1.309 0 0 1-.12.182l-1 1.138-.012.013v.54h1.988v-.7h-.9l.65-.724zm-.037 3.817c.046.032.086.07.12.114a.841.841 0 0 1 .167.55c0 .107-.017.213-.05.314a.792.792 0 0 1-.487.5 1.288 1.288 0 0 1-.48.079c-.115 0-.23-.016-.341-.049a.94.94 0 0 1-.258-.123.751.751 0 0 1-.182-.177 1.063 1.063 0 0 1-.116-.2A1.038 1.038 0 0 1 2 12.078v-.049h.814v.049c0 .027.003.055.009.082a.207.207 0 0 0 .03.074.14.14 0 0 0 .053.052.2.2 0 0 0 .157.008.159.159 0 0 0 .056-.039.22.22 0 0 0 .042-.075.417.417 0 0 0 .017-.126.483.483 0 0 0-.022-.163.2.2 0 0 0-.051-.08.138.138 0 0 0-.06-.029.537.537 0 0 0-.077-.007h-.161v-.645h.168a.241.241 0 0 0 .069-.011.164.164 0 0 0 .065-.034.175.175 0 0 0 .048-.067.286.286 0 0 0 .021-.121.28.28 0 0 0-.016-.1.166.166 0 0 0-.097-.099.2.2 0 0 0-.156.007.164.164 0 0 0-.055.053.344.344 0 0 0-.04.156v.049H2v-.049a.987.987 0 0 1 .18-.544.8.8 0 0 1 .179-.186.87.87 0 0 1 .262-.133c.114-.036.234-.053.354-.051.116-.001.231.01.344.036.092.021.18.055.263.1a.757.757 0 0 1 .32.318.73.73 0 0 1 .09.347.81.81 0 0 1-.167.528.562.562 0 0 1-.12.114z"},child:[]}]})(s)}function Qe(s){return Q({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M6.306 2.146l-4.02 4.02v.708l4.02 4.02.708-.707L3.807 6.98H5.69c2.813 0 4.605.605 5.705 1.729 1.102 1.125 1.615 2.877 1.615 5.421v.35h1v-.35c0-2.646-.527-4.72-1.9-6.121C10.735 6.605 8.617 5.98 5.69 5.98H3.887l3.127-3.126-.708-.708z"},child:[]}]})(s)}function Ue(){const{setSelectedMessage:s,selectedMessage:r,messageMode:l,setMode:o,selectedRoom:t}=k(),{first_name:f,last_name:i,business_name:n,userType:a}=(t==null?void 0:t.reciver)||{};return e.jsx("div",{className:`${l?"block":"hidden"} w-full h-20`,children:e.jsxs("div",{className:"size-full bg-gray-50 flex items-center gap-x-4 px-4 py-2",children:[e.jsx("p",{className:"text-3xl",children:l==="reply"?e.jsx(Qe,{}):e.jsx(ve,{})}),e.jsxs("div",{className:"w-full h-full flex flex-col justify-evenly",children:[e.jsxs("h4",{className:"text-xl font-bold line-clamp-1",children:[l==="edit"?"Edit Message...":`Reply To ${a==="customer"?f+" "+i:n} `,`${r==null?void 0:r.type} Message`]}),e.jsx("p",{className:"text-sm line-clamp-2",children:(r==null?void 0:r.type)==="text"?r==null?void 0:r.content:r==null?void 0:r.type})]}),e.jsx("button",{onClick:()=>{s(null),o(null)},className:"text-3xl",children:e.jsx(J,{})})]})})}function qe(s){return Q({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"},child:[]}]})(s)}function Ze(s){return Q({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75Z"},child:[]},{tag:"path",attr:{d:"M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Z"},child:[]}]})(s)}function Ge(s){return Q({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7.886 1.553a1.75 1.75 0 0 1 2.869.604l.633 1.629a5.667 5.667 0 0 0 3.725 3.395l3.959 1.131a1.749 1.749 0 0 1 .757 2.92L16.06 15l5.594 5.595a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L15 16.061l-3.768 3.768a1.749 1.749 0 0 1-2.92-.757l-1.131-3.96a5.665 5.665 0 0 0-3.395-3.724l-1.63-.633a1.75 1.75 0 0 1-.603-2.869Zm6.589 12.912 4.293-4.294a.25.25 0 0 0-.108-.417L14.7 8.623A7.165 7.165 0 0 1 9.99 4.33L9.357 2.7a.25.25 0 0 0-.41-.086L2.614 8.946a.25.25 0 0 0 .086.41l1.63.634a7.167 7.167 0 0 1 4.294 4.71l1.13 3.96a.25.25 0 0 0 .417.108l4.294-4.293Z"},child:[]}]})(s)}function Ke(){return e.jsx(e.Fragment,{children:V(3).map((s,r)=>e.jsxs("div",{className:"w-full cursor-pointer animate-pulse hover:bg-gray-300 transition-all h-24 bg-gray-200 rounded-md flex items-center px-2 py-2 gap-x-2.5 relative",children:[e.jsx("div",{className:"size-20 bg-gray-100 overflow-hidden grid z-10 rounded-full grid-cols-2 grid-rows-2"}),e.jsxs("div",{className:"w-4/6",children:[e.jsx("h4",{className:"w-3/4 h-2 mb-4 bg-gray-400 rounded-md"}),e.jsx("p",{className:"w-1/4 h-2 bg-gray-400 rounded-md"})]}),e.jsx("p",{className:"absolute right-2.5 bottom-2 w-14 h-2 bg-gray-400 rounded-md"})]},r))})}function We({onCloseModal:s}){const[{loading:r,orders:l,ordersType:o},t]=d.useState({loading:!1,orders:[],ordersType:"sells"}),[f,i]=d.useState(""),{selectedRoom:n,messageMode:a,selectedMessage:x,setSelectedMessage:c,setMode:h}=k(),{userId:u,userType:m}=T(j=>j.userData),p=W();d.useEffect(()=>{t(j=>({...j,ordersType:m==="customer"?"purchases":"sells"}))},[m]);async function v(){try{t(N=>({...N,loading:!0}));const j=U(F(H,"Orders"),o==="purchases"?E("customerId","==",u):E("sellers","array-contains",u)),I=(await Y(j).then(({docs:N})=>N.map(b=>({...b.data()})))).map(N=>({...N,orders:o==="purchases"?N.orders[n.reciver.reciverId]:N.orders[u]})).filter(N=>o==="purchases"?N.orders:N.customerId===n.reciver.reciverId);t(N=>({...N,loading:!1,orders:I}))}catch(j){t(g=>({...g,loading:!1})),console.log(j)}}d.useEffect(()=>{v()},[o]);function y(){return l.filter(({orderId:j})=>j.toLowerCase().includes(f.toLowerCase()))}function w(j){const g=l.find(b=>b.orderId===j),I=D(),N=z(I,`rooms/${n.roomId}`);$(N,{members:[u,n.reciver.reciverId],messageList:[...(n==null?void 0:n.messageList)||[],{uiid:ee(u),type:"order",senderId:u,createdAt:P(),order:{orderId:g.orderId,createdAt:g.createdAt,totalPrice:g.totalPrice,thumbnails:g.orders.items.map(b=>b.Thumbnail)},replyTo:a==="reply"?x.uiid:null,visibleTo:[u,n.reciver.reciverId]}]}),s(),c(null),h(null)}return e.jsxs("div",{className:"size-full bg-gray-50 rounded-md px-2 py-2 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",onChange:({target:j})=>i(j.value),value:f,placeholder:"search orders",className:"px-4 py-2 w-full rounded-md outline-none bg-gray-50 border border-gray-300"}),e.jsxs("div",{className:`${m==="customer"&&"hidden"} mb-1 mt-2 flex items-center justify-between gap-x-1`,children:[e.jsx("button",{onClick:()=>t(j=>({...j,ordersType:"sells"})),className:`${o==="sells"&&"!border-gray-600"} px-4 py-3 w-1/2 h-full border-b-2 border-transparent transition-all`,children:"my sells"}),e.jsx("button",{onClick:()=>t(j=>({...j,ordersType:"purchases"})),className:`${o==="purchases"&&"!border-gray-600"} px-4 py-3 border-b-2 border-transparent w-1/2 h-full transition-all`,children:"my purchases"})]})]}),e.jsx("div",{className:"w-full overflow-auto h-full scroll-smooth styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-2 px-2 py-1",children:r?e.jsx(Ke,{}):l.length?y().map(({orders:j,totalPrice:g,createdAt:I,orderId:N},b)=>e.jsxs("div",{onClick:()=>w(N),className:"w-full cursor-pointer hover:bg-gray-300 transition-all h-28 bg-gray-200 rounded-md flex items-center px-2 py-2 gap-x-2.5 relative",children:[e.jsx("div",{className:"size-20 bg-gray-100 overflow-hidden grid z-10 rounded-full grid-cols-2 grid-rows-2",children:j.items.map(({Thumbnail:C},S)=>S<3&&e.jsx("img",{className:"size-full object-cover -z-10",src:C},S))}),e.jsxs("div",{className:"w-4/6",children:[e.jsx("h4",{className:"line-clamp-1 break-words font-bold mb-1.5 w-11/12",children:N}),e.jsxs("p",{className:"text-gray-800 font-semibold",children:["Prcie: $",g]})]}),e.jsx("button",{onClick:()=>p(o==="sells"?`/EcoVibe/Dashboard/orders/${N}`:"/EcoVibe/bag/orders"),className:"absolute right-2 top-1.5 text-2xl opacity-70 hover:opacity-100 transition-all",children:e.jsx(Ze,{})}),e.jsx("p",{className:"absolute right-2.5 bottom-1 text-xs",children:te(I)})]},b)):e.jsx("h4",{className:"m-auto text-center my-20 text-lg font-semibold line-clamp-2",children:o==="sells"?"you have no orders from this customer":"you have no purchase this seller"})})})]})}function Xe({onCloseModal:s}){const[r,l]=d.useState(null),{userId:o}=T(c=>c.userData),{messageMode:t,selectedMessage:f,setSelectedMessage:i,setMode:n,selectedRoom:a}=k();function x(){const c={location:r,senderId:o,createdAt:P(),uiid:ee(o),type:"location",replyTo:t==="reply"?f.uiid:null,visibleTo:[o,a.reciver.reciverId]},h=D(),u=z(h,`rooms/${a.roomId}`);$(u,{messageList:[...(a==null?void 0:a.messageList)||[],c],members:[o,a.reciver.reciverId]}),s(),i(null),n(null)}return e.jsxs("div",{className:"size-full bg-gray-50 rounded-md relative",children:[e.jsx("div",{className:"w-full h-full rounded-t-md overflow-hidden",children:e.jsx(de,{onClick:c=>l(c.latLng),defaultCenter:[35.77142984637282,51.46089654722849],defaultZoom:11,children:r&&e.jsx(ue,{color:"#1632e9",width:50,anchor:r})})}),e.jsx("button",{disabled:!r,onClick:x,className:"px-4 py-2 bg-primary-500 rounded-2xl text-gray-50 disabled:bg-gray-400 transition-all absolute bottom-2 right-2",children:"Send Location"}),e.jsx("button",{onClick:()=>s(),className:"absolute top-1 right-1 bg-gray-100 p-1.5 text-xl rounded-full",children:e.jsx(J,{})})]})}function Je({onCloseModal:s}){const[{loading:r,products:l,error:o},t]=d.useState({loading:!1,products:[],error:null}),{userId:f}=T(m=>m.userData),{selectedRoom:i,messageMode:n,selectedMessage:a,setSelectedMessage:x,setMode:c}=k();async function h(){try{t(v=>({...v,loading:!0}));const m=U(F(H,"Products"),E("SellerId","in",[f,i.reciver.reciverId])),p=await Y(m).then(({docs:v})=>v.map(y=>({...y.data(),id:y.id})));t({loading:!1,products:p,error:!p.length&&404})}catch(m){t({loading:!1,products:[],error:m}),console.log(m)}}d.useEffect(()=>{h()},[]);function u(m){const p={senderId:f,createdAt:P(),uiid:ee(f),replyTo:n==="reply"?a.uiid:null,type:"product",product:{id:m.id,thumbnail:m.Thumbnail,desc:m.Description,price:m.Price,name:m.Name},visibleTo:[f,i.reciver.reciverId]},v=D(),y=z(v,`rooms/${i.roomId}`);$(y,{messageList:[...(i==null?void 0:i.messageList)||[],p],members:[f,i.reciver.reciverId]}),s(),x(null),c(null)}return o?e.jsx("div",{className:"size-full bg-gray-50 rounded-md overflow-hidden px-2 py-1 flex flex-col justify-center items-center",children:e.jsx("h2",{className:"text-center font-medium text-lg",children:"No product related to you or your contact was found."})}):e.jsxs("div",{className:"size-full bg-gray-50 rounded-md overflow-hidden px-2 py-1 flex flex-col justify-evenly",children:[e.jsx("div",{className:"",children:e.jsx("input",{type:"text",placeholder:"Search Your Products",className:"w-full h-10 bg-gray-200 rounded-md px-4"})}),e.jsx("div",{className:"overflow-auto styled-scroll-bar h-5/6 px-2 py-1",children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:r?V(5).map((m,p)=>e.jsxs("div",{className:"h-48 animate-pulse bg-gray-200 rounded-lg px-2 flex flex-col justify-evenly cursor-pointer",children:[e.jsx("div",{alt:"item-thumbnail",className:"w-full bg-gray-300 h-36 object-cover rounded-lg"}),e.jsx("h4",{className:"w-20 h-2 bg-gray-400 rounded-md"})]},p)):l==null?void 0:l.map((m,p)=>e.jsxs("div",{onClick:()=>u(m),className:"h-48 bg-gray-200 rounded-lg px-2 flex flex-col justify-evenly cursor-pointer",children:[e.jsx("img",{src:m.Thumbnail,alt:"item-thumbnail",className:"w-full h-36 object-cover rounded-lg"}),e.jsx("h4",{className:"line-clamp-1 text-sm font-bold",children:m.Name})]},p))})})]})}function es(){const{messageMode:s}=k(),[{modalIsShow:r,type:l},o]=d.useState({modalIsShow:!1,type:null});function t(){o({modalIsShow:!1,type:null})}return e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:s==="edit",className:"text-3xl disabled:opacity-50 text-gray-900 py-2 rounded-md peer",children:e.jsx(qe,{})}),e.jsxs("div",{className:"w-72 z-50 flex flex-col absolute bg-gray-100 -top-44 left-2 rounded-md opacity-0 invisible peer-disabled:hidden peer-hover:visible peer-hover:opacity-100 hover:visible hover:opacity-100 transition-all",children:[e.jsxs("button",{onClick:()=>o({modalIsShow:!0,type:"order"}),className:"px-4 py-4 hover:bg-gray-200 transition-all rounded-md flex items-center justify-start gap-x-2",children:[e.jsx("span",{children:e.jsx(Ye,{})}),e.jsx("p",{children:"Share Order"})]}),e.jsxs("button",{onClick:()=>o({modalIsShow:!0,type:"location"}),className:"px-4 py-4 hover:bg-gray-200 transition-all rounded-md flex items-center justify-start gap-x-2",children:[e.jsx("span",{children:e.jsx(Ge,{})}),e.jsx("p",{children:"Send Location"})]}),e.jsxs("button",{onClick:()=>o({modalIsShow:!0,type:"product"}),className:"px-4 py-4 hover:bg-gray-200 transition-all rounded-md flex items-center justify-start gap-x-2",children:[e.jsx("span",{children:e.jsx(je,{})}),e.jsx("p",{children:"Send Product"})]})]}),e.jsxs("div",{className:`${r?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex items-center justify-center transition-all`,children:[e.jsx("div",{className:"w-80 h-[70vh] max-h-[30rem] lg:size-96 p-2",children:l==="order"?e.jsx(We,{onCloseModal:t}):l==="location"?e.jsx(Xe,{onCloseModal:t}):e.jsx(Je,{onCloseModal:t})}),e.jsx("div",{onClick:()=>o({modalIsShow:!1,type:null}),className:"absolute inset-0 bg-gray-950/50 -z-10"})]})]})}function ss(){const[s,r]=d.useState(""),[l,o]=d.useState(1),{userId:t}=T(u=>u.userData),{setSelectedMessage:f,selectedMessage:i,messageMode:n,setMode:a,selectedRoom:x}=k();d.useEffect(()=>{const u=s==null?void 0:s.length,m=[180,260,350,440];o(q.findIndex(m,p=>u<=p)+1||10)},[s]),d.useEffect(()=>{n==="edit"&&r(i==null?void 0:i.content)},[n]);const c=()=>{const u={content:s,senderId:t,createdAt:P(),uiid:ee(t),replyTo:n==="reply"?i.uiid:null,type:"text",visibleTo:[t,x.reciver.reciverId]},m=D(),p=z(m,`rooms/${x.roomId}`);$(p,{messageList:[...(x==null?void 0:x.messageList)||[],u],members:[t,x.reciver.reciverId]}),f(null),a(null),r("")},h=()=>{const u=[...x==null?void 0:x.messageList],m=u.findIndex(({uiid:y})=>y===i.uiid);u[m]={...u[m],content:s,isEdited:!0};const p=D(),v=z(p,`rooms/${x.roomId}`);$(v,{messageList:u}),f(null),a(null),r("")};return e.jsxs("div",{id:"input_message",className:`${n&&"min-h-36 flex flex-col"} w-full transition-all`,children:[e.jsx(Ue,{}),e.jsxs("div",{className:"w-full bg-gray-50 px-4 pb-2 pt-1 flex items-end justify-between relative",children:[e.jsx(es,{}),e.jsx("textarea",{rows:l,value:s,onKeyDown:u=>{u.key==="Enter"&&s.length&&(u.preventDefault(),n==="edit"?h():c())},onChange:u=>{r(u.target.value)},type:"text",placeholder:"write new message",className:"px-4 py-2.5 resize-none transition-all min-h-12 flex-1 outline-none text-lg text-wrap bg-transparent styled-scroll-bar"}),e.jsx("button",{disabled:!s.length,onClick:()=>n==="edit"?h():c(),className:"text-4xl disabled:text-primary-950 disabled:opacity-50 text-primary-500 hover:text-primary-700 p-2 rounded-md",children:e.jsx(Ne,{})})]})]})}function ts(){return e.jsx("div",{className:"h-2/5 overflow-auto absolute animate-pulse w-full bottom-1 styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-4 py-2 px-1",children:V(5).map((s,r)=>e.jsxs("div",{className:"h-28 anima flex flex-col items-start py-1.5 cursor-pointer border-b border-gray-300 hover:border-none hover:bg-gray-200 rounded-md p-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-x-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-x-2",children:[e.jsx("div",{className:"size-8 rounded-full bg-gray-300"}),e.jsx("h2",{className:"w-20 h-2 bg-gray-300 rounded-md"})]}),e.jsx("p",{className:"w-20 h-2 bg-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex flex-col gap-y-2 w-full py-2",children:V(4).map(l=>e.jsx("div",{className:"w-full h-2 bg-gray-300 rounded-md last:w-4/5"},l))})]},r))})})}const ls=()=>{const{selectedRoom:{reciver:s}}=k();return e.jsxs("div",{className:"size-full relative",children:[e.jsxs("div",{className:"flex flex-col items-center pt-4 pb-2 mb-3.5 gap-y-4 border-b border-gray-300",children:[e.jsx("div",{className:"size-24 gradient-background rounded-full",children:e.jsx("img",{src:s==null?void 0:s.profilePic,alt:"seller-avatar",className:"size-full rounded-full"})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("button",{className:"p-1.5 text-gray-800 hover:bg-gray-300 transition-all bg-gray-200 text-2xl rounded-lg",children:e.jsx(we,{})}),e.jsx("button",{className:"p-1.5 text-gray-800 hover:bg-gray-300 transition-all bg-gray-200 text-2xl rounded-lg",children:e.jsx(_,{})})]})]}),e.jsxs("div",{className:"flex flex-col gap-y-2 h-1/3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-x-3",children:[e.jsx("p",{className:"text-lg font-semibold w-3/5",children:"Shop Name"}),e.jsx("p",{className:"w-2/5 line-clamp-1 break-words",children:s==null?void 0:s.business_name})]}),e.jsxs("div",{className:"flex items-center justify-center gap-x-3",children:[e.jsx("p",{className:"text-lg font-semibold w-3/5",children:"Career Title"}),e.jsx("p",{className:"w-2/5 line-clamp-1 break-words",children:s==null?void 0:s.career_title})]}),e.jsxs("div",{className:"flex items-center justify-center gap-x-3",children:[e.jsx("p",{className:"text-lg font-semibold w-3/5",children:"Email"}),e.jsx("p",{className:"w-2/5 line-clamp-1 break-words",children:s==null?void 0:s.email})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold",children:"Biography"}),e.jsx("p",{className:"line-clamp-4 lg:line-clamp-4 mt-1",children:(s==null?void 0:s.biography)||"Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident blanditiis sed velit, doloribus ipsam possimus tenetur autem! Amet dolorum excepturi earum, tempore exercitationem in quos sapiente voluptates nam aperiam molestiae"})]})]}),e.jsx("div",{className:"w-full h-1/3 justify-self-end",children:e.jsx(as,{seller:s})})]})},as=({seller:s})=>{const[{error:r,loading:l,reviews:o},t]=d.useState({reviews:[],loading:!1,error:null});d.useEffect(()=>{async function i(){try{t(x=>({...x,loading:!0}));const n=U(F(H,"comments"),E("sellerId","==",s.reciverId)),a=await Y(n).then(({docs:x})=>x.map(c=>c.data()));t({loading:!1,error:null,reviews:a})}catch(n){console.log(n),t({loading:!1,error:n,reviews:[]})}}i()},[]);function f(i){return new Date(i).toLocaleDateString()}if(l)return e.jsx(ts,{});if(!l&&(o!=null&&o.length))return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("h4",{className:"text-lg font-bold z-10 bg-gray- 100",children:[o==null?void 0:o.length," Reviews"]}),e.jsx("div",{className:"lg:h-2/5 bg-gray-100 overflow-auto styled-scroll-bar pb-6 lg:pb-0",children:e.jsx("div",{className:"flex flex-col gap-y-4 py-2 px-1",children:o.map((i,n)=>e.jsxs("div",{className:"h-32 flex flex-col items-start py-1.5 cursor-pointer border-b border-gray-300 hover:border-none hover:bg-gray-200 rounded-md p-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-x-2",children:[e.jsx("div",{className:"size-8 rounded-full gradient-background bg-opacity-80",children:e.jsx("img",{src:i.authorProfile,alt:"author-profile",className:"size-full rounded-full"})}),e.jsx("h2",{className:"line-clamp-1 w-3/5 font-bold text-start",children:i.content.first_name}),e.jsx("p",{className:"",children:f(i.date)})]}),e.jsx("div",{className:"line-clamp-2 lg:line-clamp-3 mt-0.5 text-pretty py-1.5",children:i.content.review})]},n))})})]})};function rs(){return e.jsx("div",{className:"w-full h-2/5 px-2 py-1 overflow-auto styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-4",children:V(4).map((s,r)=>e.jsxs("div",{className:"w-full h-20 animate-pulse bg-gray-300 cursor-pointer rounded-md px-2 py-1 flex flex-col justify-evenly",children:[e.jsx("h4",{className:"w-full h-2 bg-gray-400 rounded-md"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"w-12 h-2 bg-gray-400 rounded-md"}),e.jsx("p",{className:"w-12 h-2 bg-gray-400 rounded-md"})]})]},r))})})}const ns=()=>{const[{loading:s,orders:r},l]=d.useState({orders:[],loading:!1}),{userId:o}=T(f=>f.userData),{selectedRoom:{reciver:t}}=k();return d.useEffect(()=>{async function f(){try{l(a=>({...a,loading:!0}));const i=ze(F(H,"Orders"),E("customerId","==",t.reciverId),E("sellers","array-contains",o)),n=await Y(i).then(({docs:a})=>a.map(x=>x.data()));l({loading:!1,orders:n})}catch(i){l({loading:!1,orders:[]}),console.log(i)}}f()},[]),e.jsxs("div",{className:"size-full flex-col flex gap-y-2",children:[e.jsxs("div",{className:"w-full h-1/5 flex items-center justify-start gap-x-4 px-4 py-2",children:[e.jsx("div",{className:"size-20 rounded-full",children:e.jsx("img",{src:t==null?void 0:t.profilePic,alt:"customer-avatar",className:"size-full rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-y-1 w-4/6",children:[e.jsx("h2",{className:"text-xl font-semibold line-clamp-1",children:(t==null?void 0:t.first_name)+" "+(t==null?void 0:t.last_name)}),e.jsx("p",{className:"text-gray-800",children:t==null?void 0:t.email}),e.jsx("p",{className:"text-gray-800",children:t==null?void 0:t.address})]})]}),e.jsx(os,{orders:r,loading:s}),e.jsx(is,{orders:r,loading:s})]})},os=({loading:s,orders:r})=>{const[l,o]=d.useState([]);return d.useEffect(()=>{const t=r.flatMap(i=>Object.values(i==null?void 0:i.orders).flatMap(({items:n})=>n)),f=Ie.map(({title:i})=>({title:i.split(" ")[0],profit:t.filter(({Category:n})=>n===i).reduce((n,a)=>n+Number(a.Price),0)}));o(f)},[r]),e.jsxs("div",{className:"w-full h-2/5",children:[e.jsx("h4",{className:"text-lg font-bold",children:"Orders of this customer:"}),e.jsx("div",{className:"size-full flex items-center justify-center",children:e.jsx(Ce,{width:"100%",height:"100%",className:`${s&&"animate-pulse"}`,children:e.jsxs(Se,{cx:"50%",cy:"50%",outerRadius:"80%",data:l,children:[e.jsx(ke,{}),e.jsx(Me,{dataKey:"title",className:"text-xs"}),e.jsx(Le,{dataKey:"profit",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6})]})})})]})},is=({loading:s,orders:r})=>{const{userId:l}=T(t=>t.userData);function o(t){return q.filter(t,(n,a)=>a===l).map(n=>n.items.reduce((a,x)=>a+x.Price*x.quantity,0)).reduce((n,a)=>n+a,0)}if(s)return e.jsx(rs,{});if(!s&&r.length)return e.jsxs("div",{className:"w-full h-2/5",children:[e.jsx("h4",{className:"text-lg font-bold",children:"Orders of this customer:"}),e.jsx("div",{className:"px-2 pb-12 lg:py-1 h-[75%] lg:h-auto overflow-auto styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-4",children:r.map((t,f)=>e.jsxs("div",{className:"w-full h-24 bg-gray-200 cursor-pointer rounded-md px-2 py-1 flex flex-col justify-evenly",children:[e.jsx("h4",{className:"line-clamp-1 break-words font-bold",children:t.orderId}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Total price:"})," $",o(t.orders)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Order Date:"}),te(t.createdAt,{})]})]})]},f))})})]})};function cs({modalShow:s,onCloseModal:r}){const[l,o]=d.useState(null),{selectedRoom:{reciver:t}}=k();if(d.useEffect(()=>{o((t==null?void 0:t.userType)==="customer"?"customer":"seller")},[t==null?void 0:t.userType]),l)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${s?"visible opacity-100 translate-x-0":"invisible opacity-0 translate-x-28"} w-full lg:w-96 fixed top-0 right-0 ease-in-out h-screen bg-gray-100 z-50 transition-all px-2.5 lg:px-4 py-2`,children:[e.jsx("button",{onClick:()=>r(),className:"absolute left-2 text-3xl lg:hidden z-50",children:e.jsx(G,{})}),e.jsxs("div",{className:`${t.userType==="both"?"block":"hidden"} w-full flex py-2 items-center justify-between`,children:[e.jsx("button",{onClick:()=>o("seller"),className:`${l==="seller"&&"text-gray-950"} px-4 hover:text-gray-700 rounded-md w-1/2`,children:"Seller Info"}),e.jsx("button",{onClick:()=>o("customer"),className:`${l==="customer"&&"text-gray-950"} px-4 text-gray-500 lg:hover:text-gray-700 rounded-md w-1/2`,children:"Customer Info"})]}),l==="customer"?e.jsx(ns,{}):e.jsx(ls,{})]}),e.jsx("div",{onClick:()=>r(),className:`${s?"visible opacity-100":"invisible opacity-0"} fixed inset-0 bg-gray-950/60 backdrop-blur-sm z-40 transition-all`})]})}function ds(s){return Q({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"},child:[]}]})(s)}function us({searchBar:s,setSearchBar:r,setShowAlert:l}){const[o,t]=d.useState(null),[f,i]=d.useState(!1),n=d.useRef();X(n,()=>i(()=>i(!1)));const{barIsShow:a}=s||{},{setSelectedRoom:x,selectedRoom:c,setSelectedMessage:h}=k(),{profilePic:u,status:m,first_name:p,last_name:v,business_name:y,userType:w,career_title:j,last_seen:g}=(c==null?void 0:c.reciver)||{},I=d.useRef("");d.useEffect(()=>{if(!g){I.current=w!=="customer"?j||y:v;return}const b=D(),C=K(z(b,".info/serverTimeOffset"),S=>{const L=Date.now()+S.val()-(g==null?void 0:g.date),A=Math.floor(L/1e3);I.current=A>=30?`last seen at ${N(g==null?void 0:g.date)}`:"online"});return()=>C()},[g]);function N(b){return new Date(b).toLocaleTimeString("en-us",{year:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}return e.jsxs("div",{onContextMenu:b=>{b.preventDefault(),i(!0)},className:"w-full bg-gray-100 p-2 lg:px-4 flex items-center justify-between z-30 transition-all relative",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>{x(null)},className:"text-2xl",children:e.jsx(G,{})}),e.jsx(e.Fragment,{children:u?e.jsx("img",{src:u,className:"size-14 rounded-full",alt:"user-profile"}):e.jsx("div",{className:"size-12 lg:size-16 flex items-center justify-center bg-gray-200 rounded-full",children:e.jsx(_,{className:"text-4xl lg:text-6xl mt-3 rounded-full"})})}),e.jsxs("div",{className:"flex flex-col ml-4 cursor-pointer",children:[e.jsxs("h4",{className:w==="customer"?"":"flex flex-col gap-y-1",children:[e.jsx("p",{className:"text-lg font-bold",children:w==="customer"?p:y}),e.jsx("p",{className:"-mt-1 text-sm line-clamp-1 break-words lg:text-base",children:I.current})]}),e.jsx("p",{children:m})]})]}),e.jsx("div",{ref:n,className:"flex items-center gap-x-2 px-0.5 pt-1.5",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>i(!f),className:"text-3xl",children:e.jsx(ds,{})}),e.jsxs("div",{className:`${f?"opacity-100 visible":"opacity-0 invisible"} absolute transition-all w-60 overflow-hidden bg-gray-50 z-50 right-0 shadow-2xl rounded-sm flex flex-col`,children:[e.jsxs("button",{onClick:()=>{i(!1),r(b=>({...b,barIsShow:!0}))},className:"px-4 py-4 text-lg hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(ne,{className:"text-2xl"})," Search bar"]}),e.jsxs("button",{onClick:()=>{i(!1),t(c)},className:"px-4 py-4 text-lg hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(Te,{className:"text-2xl"})," User info"]}),e.jsxs("button",{onClick:()=>{i(!1),x(null)},className:"px-4 py-4 text-lg hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(J,{className:"text-2xl"}),"Close chat"]}),e.jsxs("button",{onClick:()=>{l(!0),i(!1)},className:"px-4 py-4 text-lg text-red-600 hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(ce,{className:"text-2xl "}),"Delete chat"]})]})]})}),e.jsx(cs,{modalShow:o,onCloseModal:()=>t(null)}),e.jsxs("div",{className:`${a?"visible opacity-100 translate-y-0":"opacity-0 invisible translate-y-10"} absolute inset-0 bg-gray-100 transition-all flex items-center justify-center px-4`,children:[e.jsx("button",{onClick:()=>{r(b=>({...b,barIsShow:!1})),h(null)},className:"text-3xl",children:e.jsx(G,{})}),e.jsx("input",{onChange:b=>r(C=>({...C,searchQuery:b.target.value})),value:s.searchQuery,type:"text",placeholder:"search messages",className:"flex-1 px-4 py-2 bg-transparent outline-none text-lg"}),e.jsx("button",{className:"text-3xl",children:e.jsx(ne,{})})]})]})}function xs({message:s}){return e.jsxs("div",{className:" lg:w-72 h-20 border-l-4 relative border-gray-600 flex items-center gap-x-2.5 px-2 py-1",children:[e.jsx("div",{className:"size-16 lg:size-20 bg-gray-100 hover:bg-gray-100/90 transition-all overflow-hidden grid z-0 rounded-full grid-cols-2 grid-rows-2",children:s.order.thumbnails.map((r,l)=>l<3&&e.jsx("img",{className:"size-full object-cover -z-10",src:r},l))}),e.jsxs("div",{className:"w-4/6 flex flex-col gap-y-2.5",children:[e.jsxs("h4",{className:"line-clamp-1 break-words w-11/12 font-bold text-sm hover:underline",children:[s.order.orderId.slice(0,20),"..."]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs font-semibold",children:["$",s.order.totalPrice]}),e.jsxs("p",{className:"font-semibold text-xs",children:["date:  ",te(s.order.createdAt,{year:"numeric",month:"2-digit",day:"2-digit"})]})]})]})]})}function ms({message:s}){const[r,l]=d.useState(!1);return e.jsx("div",{className:"w-64 lg:min-w-96",children:e.jsxs("div",{className:`${r&&"fixed inset-0 !h-full z-40"} w-full h-80 lg:h-96 rounded-lg overflow-hidden`,children:[e.jsx("div",{onClick:()=>l(!0),className:"size-full",children:e.jsx(de,{defaultCenter:[s.location[0],s.location[1]],defaultZoom:11,mouseEvents:r,touchEvents:r,children:s.location&&e.jsx(ue,{color:"#1632e9",width:50,anchor:s.location})})}),r&&e.jsx("button",{onClick:()=>l(!1),className:"absolute top-2 right-2 p-2.5 bg-gray-50 rounded-full text-2xl z-50",children:e.jsx(J,{})})]})})}function fs({message:s}){return e.jsxs("div",{className:"h-72 lg:h-80 flex flex-col justify-evenly w-64 lg:w-96",children:[e.jsxs("div",{className:"w-full h-64 relative group rounded-md overflow-hidden",children:[e.jsx("img",{src:s.product.thumbnail,alt:"product-thumbnail",className:"size-full object-cover max-w-full "}),e.jsx("div",{className:"absolute inset-0 bg-gray-950/80 backdrop-blur flex items-center justify-center px-4 py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300",children:e.jsx("p",{className:"line-clamp-[10] text-gray-50 text-center",children:s.product.desc})})]}),e.jsxs("div",{className:"px-2 py-1",children:[e.jsx("h4",{className:"text-lg line-clamp-1 font-bold",children:s.product.name}),e.jsxs("p",{className:"font-semibold",children:["Price: $",s.product.price]})]})]})}function hs({message:s,setContextMenu:r,contextMenu:l,onDeleteMessage:o}){var j;const t=d.useRef(),f=d.useRef();X(f,()=>r(null));const[i,n]=d.useState({x:0,y:0}),[a,x]=d.useState(null),{selectedMessage:c,setSelectedMessage:h,setMode:u,selectedRoom:m}=k(),{userId:p}=T(g=>g.userData),v=g=>g===p;d.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),d.useEffect(()=>{var g;if(s!=null&&s.replyTo){const I=(g=m.messageList)==null?void 0:g.find(({uiid:N})=>N===s.replyTo);x(I)}},[s]),d.useEffect(()=>{if(c){const g=document.getElementById(`${c.uiid}`);t.current=g}t.current&&t.current.scrollIntoView({behavior:"smooth",block:"end"})},[c]);function y(g){return new Date(g).toLocaleDateString("en-US",{year:"numeric",hour:"2-digit",minute:"2-digit"}).split(",")[1]}const w=async()=>{try{const g=document.createElement("input");g.value=s.content,document.body.appendChild(g),g.select(),document.execCommand("copy"),B.success("copied to clipboard")}catch{B.remove(),B.error("Failed to copy message")}};return e.jsxs("div",{className:`${v(s.senderId)?"self-end bg-slate-200":"self-start bg-gray-50 items-end"} ${(c==null?void 0:c.uiid)===s.uiid&&"!bg-gray-900 text-gray-50 focused-message_shadow"} px-3 py-1.5 w-fit select-none rounded-md flex flex-col items-end gap-y-1 transition-all cursor-pointer max-w-[95%] lg:max-w-[60%]`,children:[e.jsxs("div",{ref:t,id:s.uiid,onContextMenu:g=>{n({x:g.clientX,y:g.clientY}),g.preventDefault(),r(s.uiid)},children:[e.jsxs("div",{onClick:()=>{h(a),setTimeout(()=>{h(null)},1500)},className:`${a&&"!flex"} hidden h-16 w-full bg-primary-100/50 flex-col mb-2 mt-1 justify-evenly text-gray-900 rounded-lg border-l-4 border-primary-400/50 px-2 py-1`,children:[e.jsx("h4",{className:"text-lg font-bold",children:"Reply To"}),e.jsx("p",{className:"line-clamp-1 text-sm",children:(a==null?void 0:a.type)==="text"?a==null?void 0:a.content.slice(0,((j=a==null?void 0:a.content)==null?void 0:j.length)*10):`${a==null?void 0:a.type} message`})]}),s.type==="text"?e.jsx("p",{className:"text-start w-full break-words max-w-96",children:s.content}):s.type==="order"?e.jsx(xs,{message:s}):s.type==="location"?e.jsx(ms,{message:s}):e.jsx(fs,{message:s}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 w-full",children:[e.jsx("p",{className:"text-xs opacity-80 order-2",children:y(s.createdAt)}),(s==null?void 0:s.isEdited)&&e.jsx("p",{className:"text-xs opacity-70",children:"Edited"})]})]}),e.jsxs("div",{ref:f,style:{top:v(s.senderId)?i.y-100:i.y,left:v(s.senderId)?i.x-100:i.x},className:`${l===s.uiid?"visible opacity-100":"invisible opacity-0"}
          w-28 h-fit fixed z-50 bg-gray-100 bottom-0 flex flex-col rounded-md transition-all`,children:[e.jsx("button",{onClick:()=>{h(s),u("reply")},className:"px-4 py-2 text-gray-950 bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all border-b border-b-gray-300",children:"reply"}),e.jsx("button",{disabled:(s==null?void 0:s.type)!=="text",onClick:()=>{w()},className:"disabled:hidden px-4 py-2 text-gray-950 bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all border-b border-b-gray-300",children:"copy"}),e.jsx("button",{onClick:()=>{h(s),u("edit")},className:"px-4 py-2 text-gray-950 disabled:hidden bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all border-b border-b-gray-300",disabled:!v(s.senderId)||s.type!=="text",children:"edit"}),e.jsx("button",{onClick:()=>o(s.uiid),className:"px-4 py-2 text-gray-950 bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all disabled:hidden",disabled:!v(s.senderId),children:"delete"})]})]})}const gs=()=>{var h,u;const[s,r]=d.useState(null),[l,o]=d.useState(null),[{alertIsShow:t,messageId:f},i]=d.useState({alertIsShow:"",messageId:null}),n=d.useRef(),{selectedRoom:a}=k(),{userId:x}=T(m=>m.userData);d.useEffect(()=>{n.current&&(l?n.current.style.overflow="hidden":n.current.style.overflow="auto")},[l]);function c(m){if(!t)i({messageId:m,alertIsShow:!0});else{const p=D(),v=z(p,`rooms/${a.roomId}`);$(v,{messageList:[...a.messageList.filter(({uiid:y})=>y!==f)]}),i({messageId:null,alertIsShow:!1})}}if(d.useEffect(()=>{a&&r(a)},[]),d.useEffect(()=>{if(!s)return;const m=D(),p=z(m,`rooms/${s.roomId}/${x}/last_seen`);if(a){$(p,{date:P()});const v=setInterval(()=>{$(p,{date:P()})},1e4);return()=>{$(p,{date:0}),clearInterval(v)}}return()=>{$(p,{date:P()})}},[s]),!((h=a==null?void 0:a.messageList)!=null&&h.length))return e.jsx("div",{className:"bg-gray-300 w-full flex justify-center items-center flex-1",children:e.jsx("h4",{className:"px-4 py-2 bg-gray-200 rounded-md font-semibold",children:"Nothing yet"})});if((u=a==null?void 0:a.messageList)!=null&&u.length)return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:n,onContextMenu:m=>m.preventDefault(),className:"flex relative flex-col gap-y-2 w-full overflow-auto px-2 pb-1 pt-2 bg-gray-300 flex-1 styled-scroll-bar",children:a.messageList.map((m,p)=>{var v;return((v=m==null?void 0:m.visibleTo)==null?void 0:v.includes(x))&&e.jsx(hs,{message:m,setContextMenu:o,contextMenu:l,onDeleteMessage:c},p)})}),e.jsxs("div",{className:`${t?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex justify-center items-center transition-all`,children:[e.jsx(le,{action:"Delete Message",closeModal:()=>i({messageId:null,alertIsShow:!1}),message:"Do you want to delete this message ?",submitCallBack:()=>c(),sureTitle:"Delete"}),e.jsx("div",{onClick:()=>i({alertIsShow:!1,messageId:null}),className:"absolute inset-0 bg-gray-950/50 backdrop-blur-sm -z-10"})]})]})};function ps(s){const[r,l]=d.useState({barIsShow:!1,searchQuery:""}),[{results:o,selectedIndex:t},f]=d.useState({selectedIndex:0,results:[]});return d.useEffect(()=>{if(r.barIsShow||l({barIsShow:!1,searchQuery:""}),r.searchQuery.length>0){const n=s==null?void 0:s.messageList.filter(({content:a,type:x})=>x==="text"&&a.toLowerCase().includes(r.searchQuery.toLowerCase()));f({selectedIndex:0,results:n.reverse()})}else f({selectedIndex:0,results:[]})},[r.searchQuery,r.barIsShow,s]),{searchBar:r,results:o,selectedIndex:t,updateSearchBar:l,scrollToMessage:n=>{f(a=>({...a,selectedIndex:n==="up"?a.selectedIndex+1:a.selectedIndex-1}))}}}function ys(){const[s,r]=d.useState(null);return d.useEffect(()=>{const l=()=>r(window.visualViewport.height);return window.addEventListener("resize",l),l(),()=>{window.removeEventListener("resize",l)}},[]),s}function bs(s,r,l,o){d.useEffect(()=>{const t=(n,a)=>{const x=a==="move"?n.touches[0]:n.changedTouches[0],c=x.screenY-x.pageY;if(a==="move"&&c<87){const h=(x.pageY-x.screenY)/50+1.5,u=Math.min(Math.max(h*85,0),180);l({opacity:h/3,rotate:u})}a==="end"&&(c<-20?r(null):c<87&&(o.current.scrollIntoView({block:"start",behavior:"smooth"}),l({rotate:0,opacity:0})))},f=n=>t(n,"move"),i=n=>t(n,"end");return window.addEventListener("touchmove",f),window.addEventListener("touchend",i),()=>{window.removeEventListener("touchmove",f),window.removeEventListener("touchend",i)}},[s,r,l,o])}function vs({deleteRoom:s}){var j,g,I,N;const r=d.useRef(),{selectedRoom:l,setSelectedMessage:o,messageMode:t,setSelectedRoom:f,rooms:i}=k(),{searchBar:n,results:a,selectedIndex:x,updateSearchBar:c,scrollToMessage:h}=ps(l),u=ys(),[{opacity:m,rotate:p},v]=d.useState({opacity:0,rotate:0});bs(l,f,v,r);const[y,w]=d.useState(!1);if(d.useEffect(()=>{c({searchQuery:"",barIsShow:!1})},[l]),d.useEffect(()=>{t&&c({barIsShow:!1,searchQuery:""})},[t]),d.useEffect(()=>{n.barIsShow&&o(a[x])},[x,a]),!l)return e.jsx("div",{className:"hidden w-3/4 bg-slate-200 lg:flex items-center justify-center relative",children:e.jsx("p",{className:"text-lg font-bold bg-gray-50/50 backdrop-blur-sm px-4 py-2 rounded-xl cursor-pointer",children:"Please Select A Chat First..."})});if(l)return e.jsxs("div",{style:{height:u},className:`${l?"w-full flex":"hid den"} lg:! flex flex-col lg:w-3/4 !w-full h-full bg-slate-200 items-center justify-center relative`,children:[e.jsx("div",{ref:r,className:"w-full",children:e.jsx(us,{searchBar:n,setSearchBar:c,deleteRoom:s,setShowAlert:w})}),e.jsx(gs,{}),n.barIsShow?e.jsxs("div",{className:"w-full h-16 bg-gray-50 flex items-center px-4 py-2 relative opacity-80 hover:opacity-100 transition-all lg:opacity-100",children:[e.jsx("h4",{className:"text-lg font-bold",children:(j=n.searchQuery)!=null&&j.length?x?`${x+1} of ${a==null?void 0:a.length}`:`${a==null?void 0:a.length} Messages Find`:`Search Between ${(g=l.messageList)!=null&&g.length?(I=l.messageList)==null?void 0:I.length:0} Messages`}),e.jsxs("div",{className:`${a.length<=0&&"hidden"} flex flex-col absolute bg-gray-50/40 rounded-3xl backdrop-blur-sm right-8 gap-y-2 -top-28`,children:[e.jsx("button",{disabled:x===a.length-1,onClick:()=>h("up"),className:"p-2.5 text-2xl rounded-full bg-gray-100 -rotate-90 disabled:opacity-50 transition-all",children:e.jsx(oe,{})}),e.jsx("button",{disabled:!x,onClick:()=>h("down"),className:"p-2.5 text-2xl rounded-full bg-gray-100 rotate-90 disabled:opacity-50 transition-all",children:e.jsx(oe,{})})]})]}):e.jsx(ss,{}),e.jsxs("div",{style:{opacity:m},className:"absolute w-full h-32 -bottom-32 z-50 transition-all flex items-center justify-center gap-x-2",children:[e.jsx("p",{style:{rotate:`${p}deg`},className:"transition-all text-3xl rotate-180 duration-700",children:e.jsx($e,{})}),e.jsx("h4",{className:"text-xl font-bold",children:"Return to Chats"})]}),e.jsxs("div",{className:`${y?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex justify-center items-center transition-all`,children:[e.jsx(le,{action:`Delete chat with ${(N=l==null?void 0:l.reciver)==null?void 0:N.first_name} ?`,closeModal:()=>w(!1),message:"Are You Sure You Want To Delete This Chat?, you cannot access messages again...",submitCallBack:()=>s(l.roomId,i)}),e.jsx("div",{onClick:()=>w(!1),className:"absolute inset-0 bg-gray-950/50 -z-10"})]})]})}function js({user:s,searchType:r,orders:l,onCloseModal:o}){const[t,f]=d.useState(null),{userType:i}=T(u=>u.userData),{personalInformation:n,businessInformation:a,userId:x}=s||{},c=W(),{createNewChatRoom:h}=k();return d.useEffect(()=>{if(r==="orders"){const u=l==null?void 0:l.filter(({customerId:p,sellers:v})=>i!=="customer"?p===x:v.includes(x)),m=u.reduce((p,v)=>v.createdAt.seconds>p.createdAt.seconds?v:p,u[0]);f(m)}},[r,l,s]),e.jsxs("div",{onClick:()=>{h(s),o()},className:"w-full h-28 flex items-center px-4 py-2 gap-x-4 cursor-pointer hover:bg-gray-200 transition-all rounded-xl",children:[n.profilePic?e.jsx("img",{src:n.profilePic,className:"size-20 bg-gray-100 rounded-full"}):e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(_,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-y-1.5",children:[e.jsx("h4",{className:"line-clamp-1 w-40 text-lg font-bold break-words",children:n.first_name+" "+n.last_name}),e.jsx("p",{className:"text-sm line-clamp-2 font-semibold",children:r==="orders"?e.jsxs("div",{onClick:()=>c(i==="customer"?`/EcoVibe/bag/orders/${t.orderId.replace("#","")}/${x}`:`/EcoVibe/Dashboard/orders/${t.orderId.replace("#","")}`),className:"hover:opacity-80 transition-all",children:["last order:",e.jsx("p",{className:"line-clamp-1 w-40 break-words",children:t==null?void 0:t.orderId})]}):e.jsx(e.Fragment,{children:(a==null?void 0:a.business_name)||(a==null?void 0:a.career_title)||"seller"})})]})]})}function Ns(){return e.jsxs("div",{className:"w-80 lg:w-96 h-[90vh] 2xl:h-[45rem] bg-gray-50 rounded-md z-10 p-2 flex flex-col",children:[e.jsx("div",{className:"flex bg-gray-200 rounded-md relative",children:e.jsx("input",{disabled:!0,type:"text",placeholder:"search contacts",className:"w-full px-4 py-2 bg-transparent placeholder:text-gray-600 outline-none rounded-md"})}),e.jsx("div",{className:"flex-1 overflow-auto h-[27rem] xl:h-[35rem] styled-scroll-bar my-2",children:e.jsx("div",{className:"inline-flex flex-col w-full gap-y-4 h-full",children:V(20).map((s,r)=>e.jsxs("div",{className:"w-full animate-pulse h-28 flex items-center px-4 py-2 gap-x-4 cursor-pointer hover:bg-gray-200 transition-all rounded-xl",children:[e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(_,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-y-2.5",children:[e.jsx("p",{className:"w-36 h-2 bg-gray-300 rounded-md"}),e.jsx("p",{className:"w-24 h-2 bg-gray-300 rounded-md"})]})]},r))})})]})}function ws({onCloseModal:s}){const[{menuIsShow:r,searchType:l},o]=d.useState({searchType:"all",menuIsShow:!1}),[t,f]=d.useState(""),[{loading:i,userList:n},a]=d.useState({userList:[],loading:!1}),[x,c]=d.useState([]),{userType:h,userId:u}=T(y=>y.userData),m=d.useRef();X(m,()=>o(y=>({...y,menuIsShow:!1})));async function p(){if(l==="orders")try{const y=U(F(H,"Orders"),h!=="customer"?E("sellers","array-contains",u):E("customerId","==",u)),w=await Y(y).then(({docs:g})=>g.map(I=>I.data()));c(w);const j=w.flatMap(({sellers:g,customerId:I})=>h!=="customer"?I:q.uniq(g));return h==="customer"?j:q.uniq(j)}catch(y){console.log(y)}}d.useEffect(()=>{async function y(){try{a(I=>({...I,loading:!0}));const w=await p(),j=U(F(H,"users"),l==="all"?E("userType","in",["seller","both"]):E("userId","in",w)),g=await Y(j).then(({docs:I})=>I.map(N=>N.data()).filter(N=>N.userId!==u));a({userList:g,loading:!1,error:null})}catch(w){a({userList:[],loading:!1,error:w}),console.log(w)}}y()},[l]);function v(y){let w=[];return w=n.filter(j=>{const{personalInformation:g,businessInformation:I}=j,{first_name:N,last_name:b}=g||{},{business_name:C}=I||{};if(N.toLowerCase().includes(y)||b!=null&&b.toLowerCase().includes(y)||C!=null&&C.toLowerCase().includes(t))return j}),y!==""?w:n}if(i)return e.jsx(Ns,{});if(!i)return e.jsxs("div",{className:"w-80 lg:w-96 h-[90vh] 2xl:h-[45rem] bg-gray-50 rounded-md z-10 p-2 flex flex-col",children:[e.jsxs("div",{className:"flex bg-gray-200 rounded-md relative",children:[e.jsx("input",{type:"text",value:t,onChange:({target:y})=>f(y.value.toLocaleLowerCase()),placeholder:"search contacts",className:"w-full px-4 py-2 bg-transparent placeholder:text-gray-600 outline-none rounded-md"}),e.jsxs("div",{ref:m,children:[e.jsx("button",{onClick:()=>o(y=>({...y,menuIsShow:!0})),className:"px-2 h-full text-2xl hover:text-gray-500 transition-all",children:e.jsx(De,{})}),e.jsxs("div",{className:`${r?"translate-y-0 opacity-100 visible":"-translate-y-10 opacity-0 invisible"} absolute top-14 transition-all right-0 w-48 h-24 bg-gray-100 justify-evenly px-2 py-1 rounded-md flex flex-col`,children:[e.jsx("div",{className:"tooltip absolute -top-1 right-8 bg-gray-200"}),e.jsx("button",{onClick:()=>o({menuIsShow:!1,searchType:"all"}),className:`${l==="all"&&"bg-gray-300"} px-4 py-2 rounded-md hover:bg-gray-200 transition-all`,children:"All Sellers"}),e.jsx("hr",{}),e.jsx("button",{onClick:()=>o({menuIsShow:!1,searchType:"orders"}),className:`${l==="orders"&&"bg-gray-300"} px-4 py-2 rounded-md hover:bg-gray-200 transition-all`,children:h==="customer"?"From my purchases":"My Customers"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto h-[27rem] xl:h-[35rem] styled-scroll-bar my-2",children:e.jsx("div",{className:"inline-flex flex-col w-full gap-y-4 h-full",children:n.length?v(t).map((y,w)=>e.jsx(js,{user:y,searchType:l,orders:x,onCloseModal:s},w)):e.jsxs("h4",{className:"text-xl font-bold text-center flex-1 flex items-center justify-center",children:["You have no  ",h==="customer"?"order yet...":"customer yet",", you can change filter to all sellers"]})})})]})}function Ts(){const[s,r]=d.useState(!1),[l,o]=d.useState(!1),{userId:t}=T(i=>i.userData);function f(i,n){var u,m;const a=n.findIndex(p=>p.roomId===i),x={...n[a]},c=D(),h=z(c,`rooms/${x.roomId}`);((u=x.members)==null?void 0:u.length)<2?Pe(h):($(h,{members:x.members.filter(p=>p!==t),messageList:((m=x.messageList)==null?void 0:m.map(p=>({...p,visibleTo:p.visibleTo.filter(v=>v!==t)})))||[]}),B.success("Room Is Deleted Successfully"))}return e.jsx(Ve,{children:e.jsx("div",{className:"mx-auto 2xl:max-w-screen-2xl fixed inset-0 z-50",children:e.jsxs("div",{className:"lg:flex justify-between h-full",children:[e.jsx(He,{onCloseNav:()=>r(!1),navIsShow:s,openContacts:()=>o(!0)}),e.jsxs("div",{className:"flex-1 flex h-full",children:[e.jsx(Fe,{openSideNav:()=>r(!0),deleteRoom:f}),e.jsx(vs,{deleteRoom:f}),e.jsxs("div",{className:`${l?"opacity-100 visible":"opacity-0 invisible"} inset-0 fixed flex items-center justify-center z-50 transition-all`,children:[e.jsx(ws,{onCloseModal:()=>o(!1)}),e.jsx("div",{onClick:()=>o(!1),className:"absolute inset-0 bg-gray-950/85 backdrop-blur-sm"})]})]})]})})})}export{Ts as default};
