import{bt as D,bu as O,bv as $,bw as B,r as u,b as y,j as e,aN as T,n as M,O as E,bx as H,by as _,bz as F,bA as X,_ as w,ar as U,aK as V,bB as q,bC as K,bD as W,P as I,t as Q,u as G,aH as z,aP as P,m as J,a8 as Y,a9 as Z}from"./index-B95hrIzf.js";import{g as C,r as k,u as R,s as L}from"./index.esm2017-DfI6XFI6.js";import{C as ee}from"./ContentSwitcher-DUh862RD.js";import{b as te}from"./index-zR1qXVO_.js";import{c as se}from"./index-ChuY50QQ.js";import{a as le}from"./useGetStories-BFA9I0ii.js";function ae(t){t.values.forEach(i=>i.stop())}function ne(){const t=new Set,i={subscribe(s){return t.add(s),()=>void t.delete(s)},start(s,a){const n=[];return t.forEach(r=>{n.push(D(r,s,{transitionOverride:a}))}),Promise.all(n)},set(s){return t.forEach(a=>{O(a,s)})},stop(){t.forEach(s=>{ae(s)})},mount(){return()=>{i.stop()}}};return i}function ie(){const t=$(ne);return B(t.mount,[]),t}const re=ie;function ce(t,i){const[s,a]=u.useState(t),[n,r]=u.useState(!0),c=u.useRef(),o=u.useRef(),[d,l]=u.useState(null);u.useEffect(()=>{if(!n)return o.current=Date.now(),c.current=setTimeout(()=>{i()},s),()=>clearTimeout(c.current)},[s,n,i]);const m=x=>{r(f=>x||!f)};return u.useEffect(()=>{if(d!=null&&d.startsWith("image/")&&n){const x=Date.now()-o.current,f=Math.max(s-x,0);f>0&&a(f)}},[d,n]),{setType:l,startTimeRef:o,remainingTime:s,pause:n,handlePause:m,setRemainingTime:a,setPause:r}}function oe({setType:t,setRemainingTime:i,loading:s,changeStoryHandler:a,pause:n,handlePause:r,contextMenuShow:c}){const{story:o,slideindex:d,currentSlideIndex:l}=S(),[m,x]=u.useState(!1),{userId:f}=y(v=>v.userData);u.useEffect(()=>{t(o.type)},[l]);function p(){var b;x(!0),r();const v=C(),g=k(v,`stories/${o.id}`),h=(b=o==null?void 0:o.seenBy)==null?void 0:b.filter(j=>j!==f);R(g,{seenBy:[...h||[],f]})}return e.jsxs("div",{className:"size-full relative z-40 overflow-hidden flex items-center justify-center p-6",children:[!m&&e.jsx(T,{style:{position:"absolute"}}),e.jsx(ee,{pause:n,loadingCallBack:p,contentUrl:o.contentUrl,contentType:o.type,autoPlayCondition:l===d,setRemainingTime:i}),s&&e.jsxs("div",{className:"absolute z-50 inset-0 flex flex-col text-gray-200 gap-y-4 font-medium bg-gray-900/80 rounded-xl items-center justify-center",children:[e.jsx(T,{}),e.jsx("p",{children:"Deleting story, please dont refresh page"})]}),e.jsxs("div",{onTouchStart:()=>r(!0),onTouchEnd:()=>r(!1),className:"absolute z-40 inset-0 flex lg:hidden",children:[e.jsx("div",{onClick:()=>!c&&!s&&a("prev"),className:"h-full w-2/5"}),e.jsx("div",{onClick:()=>!c&&!s&&a("next"),className:"h-full w-3/5"})]})]})}function de({remainingTime:t,pause:i}){const s=re(),{list:a,currentSlideIndex:n}=S();return u.useEffect(()=>{i?s.stop():s.start({translateX:"0%",transition:{duration:t/1e3,ease:"linear"}})},[i,t]),e.jsx("div",{className:"flex gap-2 p-2",children:a.map((r,c)=>e.jsx("p",{className:`${c===n?"bg-gray-50":"bg-gray-400"} w-full h-1 rounded-xl overflow-hidden relative`,children:c===n&&e.jsx(M.div,{className:"bg-primary-300 h-1 absolute left-0 top-0 w-full",initial:{translateX:"-100%"},animate:s,transition:{duration:t/1e3,ease:"linear"}})},c))})}function ue({onRemoveHighlight:t,pause:i,handlePause:s,onDeleteSlide:a,loading:n,contextMenuShow:r,setContextMenu:c}){const{changeStoryHandler:o,story:d}=S(),l=u.useRef();E(l,x,!r);const{userId:m}=y(p=>p.userData);function x(){s(),c(!1)}async function f(){try{s(!0),await a(d,()=>o("close")),w.success("story removed successfully"),s(!1)}catch(p){w.remove(),w.error("There was an error on delete story, please try again later"),s(!1),console.log(p)}}return e.jsxs("div",{ref:l,className:"flex items-center gap-x-2 relative",children:[e.jsx("button",{onClick:()=>s(),className:"text-gray-50",children:i?e.jsx(H,{className:"text-xl"}):e.jsx(te,{className:"text-2xl"})}),e.jsx("button",{onClick:()=>{s(!0),c(!0)},className:"text-3xl text-gray-50",children:e.jsx(_,{className:"rotate-90"})}),e.jsxs("div",{className:`${r?"opacity-100 visible":"opacity-0 invisible"} ${n&&"hidden"} text-base flex top-8 p-1 flex-col bg-gray-50 text-gray-950 absolute right-0 rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>{t(d),c(!1)},disabled:!(d!=null&&d.highlightRef)||d.authorId!==m,className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(se,{className:"text-xl"}),e.jsx("p",{children:"Remove highlight"})]}),e.jsxs("button",{disabled:d.authorId!==m,onClick:()=>{f(),c(!1)},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx("p",{children:e.jsx(F,{})}),e.jsx("p",{children:"Delete story"})]}),e.jsxs("button",{onClick:()=>{o("close")},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all text-red-500 items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(X,{className:"rotate-45 text-xl"}),e.jsx("p",{children:"Close"})]})]})]})}function xe({story:t,showComments:i}){var o,d;const{personalInformation:s,userId:a}=y(l=>l.userData),[n,r]=u.useState("");function c(){const l=C(),m=k(l,`stories/${t.id}`);R(m,{comments:[...(t==null?void 0:t.comments)||[],{createdAt:L(),authorId:a,content:n,authorProfile:s==null?void 0:s.profilePic,authorName:(s==null?void 0:s.first_name)+" "+(s==null?void 0:s.last_name)}]}),r("")}return e.jsxs("div",{className:`${i?"opacity-100 visible translate-y-0":"opacity-0 invisible translate-y-10"} absolute bottom-0 grid grid-rows-8 transition-all rounded-t-3xl px-2 pb-1 pt-3 overflow-hidden h-[25rem] w-screen md:w-full right-0 bg-gray-900/85 backdrop-blur-xl`,children:[e.jsx("div",{className:"w-full row-span-7 overflow-auto styled-scroll-bar flex flex-col gap-y-4",children:(o=t==null?void 0:t.comments)!=null&&o.length?(d=t==null?void 0:t.comments)==null?void 0:d.map((l,m)=>e.jsxs("div",{className:"w-full flex items-start",children:[e.jsx("div",{className:"size-14 rounded-full overflow-hidden flex items-center justify-center",children:l!=null&&l.authorProfile?e.jsx("img",{className:"mt-1",src:l==null?void 0:l.authorProfile}):e.jsx(U,{className:"text-4xl text-gray-400"})}),e.jsxs("div",{className:"flex-col p-1 w-11/12",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-300 line-clamp-1",children:l.authorName}),e.jsx("p",{className:"text-gray-400 text-sm line-clamp-6",children:l.content})]})]},m)):e.jsx("h2",{className:"my-auto w-full text-center text-gray-300",children:"no comments yet..."})}),e.jsxs("div",{className:"flex items-center border border-gray-400 rounded-2xl pl-1 pr-2",children:[e.jsx("input",{onKeyDown:l=>{l.key==="Enter"&&n.length>0&&(l.preventDefault(),c())},type:"text",onChange:({target:l})=>r(l.value),value:n,className:"bg-transparent w-full outline-none border-transparent flex-1 px-2 py-2 text-gray-300",placeholder:"comment something"}),e.jsx("button",{onClick:()=>c(),disabled:n.length<=0,className:"text-gray-300 disabled:opacity-0 transition-all text-3xl opacity-80 hover:opacity-100",children:e.jsx(V,{})})]})]})}function fe({story:t,handlePause:i,changeStoryHandler:s}){var x,f;const{userId:a,auth_status:n}=y(p=>p.userData),[r,c]=u.useState(!1),[o,d]=u.useState(null),l=u.useRef();E(l,()=>{d(!1),o!==null&&i()},o===null),u.useEffect(()=>{var p;c((p=t==null?void 0:t.likes)==null?void 0:p.includes(a))},[t]);function m(){const p=C(),v=k(p,`stories/${t.id}`);R(v,{likes:Q(t==null?void 0:t.likes,a)})}return e.jsxs("div",{ref:l,className:"absolute w-fit md:w-full bottom-0 right-0 gap-y-3 pb-4 gap-x-2 z-50 p-2",children:[e.jsxs("div",{className:"flex flex-col items-end px-1 py-0.5",children:[e.jsxs("button",{onClick:m,className:"text-gray-400 text-3xl",children:[r?e.jsx(q,{className:"text-red-500"}):e.jsx(K,{className:"text-gray-400"}),e.jsx("p",{className:"text-lg",children:((x=t==null?void 0:t.likes)==null?void 0:x.length)||0})]}),e.jsxs("button",{disabled:n!==200,onClick:()=>{i(!0),d(!0)},className:"text-gray-400 text-3xl",children:[e.jsx(W,{}),e.jsx("p",{className:"text-lg",children:((f=t==null?void 0:t.comments)==null?void 0:f.length)||0})]}),e.jsxs("button",{onClick:()=>{s("close")},className:"text-gray-400 text-3xl text-center",children:[e.jsx(I,{}),e.jsx("p",{className:"text-xs",children:"close"})]})]}),e.jsx(xe,{story:t,showComments:o})]})}function me(){const{changeStoryHandler:t,listIndex:i,currentListIndex:s,story:a}=S(),{remainingTime:n,pause:r,handlePause:c,setRemainingTime:o,setType:d}=ce(5e3,()=>t("next")),[l,m]=u.useState(!1),{onDeleteSlide:x,loading:f,onRemoveHighlight:p}=le(c),v=G();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"size-full relative z-50 bg-gray-950 lg:rounded-xl flex items-center",children:[e.jsx("div",{className:"z-50 absolute -left-4 h-1/2 hidden xl:flex items-center",children:e.jsx("button",{disabled:f,onClick:()=>t("prev"),className:"text-2xl disabled:hidden rounded-full p-1.5 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2 rotate-180",children:e.jsx(z,{})})}),e.jsxs("div",{className:`${i===s?"block":"hidden"} absolute z-50 top-0 w-full p-1`,children:[e.jsx(de,{pause:r,remainingTime:n}),e.jsxs("div",{className:"w-full flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-10 bg-gray-50/20 rounded-full overflow-hidden flex items-center justify-center",children:a!=null&&a.authorProfilePic?e.jsx("img",{src:a==null?void 0:a.authorProfilePic,className:"object-cover"}):e.jsx(P,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h6",{onClick:()=>v(`/EcoVibe/seller/${a==null?void 0:a.authorId}`),className:"text-gray-50 text-lg cursor-pointer",children:a.author.first_name})]}),e.jsx(ue,{pause:r,onRemoveHighlight:p,handlePause:c,onDeleteSlide:x,loading:f,contextMenuShow:l,setContextMenu:m})]})]}),e.jsx(oe,{setType:d,setRemainingTime:o,loading:f,changeStoryHandler:t,handlePause:c,pause:r,contextMenuShow:l}),e.jsx(fe,{story:a,handlePause:c,changeStoryHandler:t}),e.jsx("div",{className:`${i!==s&&"!hidden"} absolute -right-4 h-1/2 hidden xl:flex items-center`,children:e.jsx("button",{disabled:f,onClick:()=>t("next"),className:"text-2xl disabled:hidden disabled:bg-gray-500 disabled:opacity-50 rounded-full p-1.5 z-40 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2",children:e.jsx(z,{})})})]}),f&&e.jsx("div",{className:"fixed inset-0 z-40"})]})}const he=(t,i,s)=>{const[a,n]=u.useState(0),r=u.useRef(),c=J({maxWidth:768}),[o,d]=u.useState(null),[l,m]=u.useState(!1);Y(780,!1);const x=Z();return u.useEffect(()=>{var h,b;const g=(b=(h=s[t])==null?void 0:h.slides)==null?void 0:b.findIndex(({isSeen:j})=>!j);n(g>=0?g:0)},[t]),u.useEffect(()=>{const g=document.querySelector(".currentSlide"),h=new IntersectionObserver(([b])=>{if(!b.isIntersecting&&o!==null){const j=o==="next"?t<s.length-1?t+1:null:t-1;m(!0),i(j),n(0),d(null)}},{threshold:.05});return g&&h.observe(g),()=>h.disconnect()},[o,t]),u.useEffect(()=>{if(l){const g=setTimeout(()=>m(!1),500);return()=>clearTimeout(g)}},[l]),u.useEffect(()=>{(()=>{if(!r.current)return;const h=document.querySelector(".currentSlide");if(!h)return;const b=h.getBoundingClientRect(),j=r.current.getBoundingClientRect(),N=b.left+b.width/2-(j.left+j.width/2);r.current.scrollLeft+=N})()},[t,c,l]),{containerRef:r,isChangingSlide:l,changeStory:g=>{const h=s[t],b=g==="next";if(g==="close"){i(null),n(0);return}else{let j=a+(b?1:-1);const N=t+(b?1:-1);(j<0||j>=h.slides.length)&&(i(N>=0&&N<s.length?N:null),j=0),n(j)}},handleTouch:(g,h)=>{if(h==="start")d(null),r.current.dataset.touchStart=g.touches[0].clientX;else if(h==="move"){const b=g.touches[0].clientX-r.current.dataset.touchStart;d(b>20?"prev":"next")}},getPaginatedLists:()=>x!=null&&x.id?s:s.map((g,h)=>({...g,listIndex:h})).filter((g,h)=>h===t-1||h===t||h===t+1),currentSlideIndex:a}},A=u.createContext();function ye({currentListIndex:t,setList:i,storiesList:s}){const{containerRef:a,isChangingSlide:n,changeStory:r,handleTouch:c,getPaginatedLists:o,currentSlideIndex:d}=he(t,i,s);return e.jsx("div",{ref:a,className:`${n?"overflow-hidden":"overflow-auto"} fixed bg-gray-950/80 hidden-scroll-bar inset-0 z-50 lg:flex items-center justify-center snap-x snap-mandatory lg:snap-none`,children:e.jsxs("div",{onTouchMove:l=>c(l,"move"),onTouchStart:l=>c(l,"start"),className:"inline-flex items-center lg:gap-x-8 size-full lg:px-[500vw]",children:[o().map(({slides:l,listIndex:m})=>{if(l)return e.jsx("div",{className:`${m===t?"lg:h-[95vh] currentSlide opacity-100":"lg:h-[80vh] opacity-90"} flex-none h-full select-none w-full lg:relative lg:w-96 transition-all duration-500 z-40 snap-end`,children:l.map((x,f)=>{var p;return t===m?d===f&&e.jsx(A.Provider,{value:{changeStoryHandler:r,listIndex:m,currentListIndex:t,list:l,currentSlideIndex:d,slideindex:f,story:x},children:e.jsx(me,{},f)}):e.jsx("div",{className:"size-full first-of-type:flex hidden relative bg-gray-950 lg:rounded-xl items-center",children:e.jsxs("div",{onClick:()=>i(m),className:"size-full select-none flex flex-col gap-y-2 items-center justify-center",children:[e.jsx("div",{className:"size-28 bg-gray-50/20 overflow-hidden rounded-full",children:x!=null&&x.authorProfilePic?e.jsx("img",{src:x==null?void 0:x.authorProfilePic,className:"object-cover"}):e.jsx(P,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h4",{className:"text-gray-50",children:(p=x.author)==null?void 0:p.first_name})]})},f)})},m)}),e.jsx("div",{className:`${n?"opacity-100 visible":"invisible opacity-0"} fixed inset-0 z-50 transition-all`}),e.jsx("div",{onClick:()=>i(null),id:"list-background",className:"fixed inset-0 bg-gray-950/80 hidden lg:block"})]})})}const S=()=>u.useContext(A);export{ye as S};
