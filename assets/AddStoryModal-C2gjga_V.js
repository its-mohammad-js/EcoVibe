import{r as p,a as v,j as e,N,D as S,y as U,z as C,A,B as k,_ as i,P,Q as R,g as m,S as _,U as z}from"./index-BktEY0AR.js";import{f as L}from"./index-CQhbJd4H.js";import{e as T}from"./index-7ZH8PQa-.js";import{G as $,g as D,v as F,r as B,s as O}from"./index.esm2017-k721lsQk.js";import{C as E}from"./ContentSwitcher-DOKLWGZP.js";function I({onModalChange:c}){const[r,d]=p.useState(null),[{error:G,isUploaded:x,loading:a},n]=p.useState({loading:!1,isUploaded:!1,error:null}),{userId:u,businessInformation:l,personalInformation:s}=v(t=>t.userData);async function y(){try{n({loading:!0,isUploaded:!1,error:null});const t=S(U(C,"Stories"),A("authorId","==",u));if(await k(t).then(({docs:w})=>w.length)>=10){i.error("You can upload a maximum of 10 slides every 10 hours. 📊⏳"),c(null);return}const g=P(R,`Story Images/${m()}`),h=await _(g,r),j=await z(h.ref);await f(j),n({loading:!1,isUploaded:!0,error:null}),c(null)}catch(t){i.error("there was an error on add story, please try again later"),console.log(t),n({loading:!1,isUploaded:!1,error:t})}}async function f(t){try{let o=m(u).replace(".","&");const g=D();await F(B(g,`stories/${o}`),{contentUrl:t,id:o,author:{first_name:(l==null?void 0:l.businessName)||(s==null?void 0:s.first_name)||(s==null?void 0:s.email),last_name:(l==null?void 0:l.career_title)||(s==null?void 0:s.last_name)},createdAt:O(),authorId:u,type:r==null?void 0:r.type,authorProfilePic:s.profilePic}),d(null),i.success("story created successfully")}catch(o){console.log(o)}}function b(t){if(t.size>20*1024*1024){i.error("File size exceeds 20MB limit.");return}if(["image/jpeg","image/webp","image/png","image/gif","video/mp4","video/webm","video/ogg"].includes(t.type))d(t);else{i.error("Only image, GIF, and video files are allowed.");return}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 z-20 bg-gray-50 py-2 lg:px-6 lg:py-4 w-[95vw] lg:w-[50vw] xl:w-[40vw] h-5/6 lg:h-[80vh] mx-auto lg:border border-gray-200 lg:shadow hover:shadow-2xl transition-all duration-300 rounded-md flex flex-col",children:[e.jsx("h4",{className:"text-2xl font-bold mb-2",children:"Add New Story"}),r?e.jsxs("div",{className:"w-full h-5/6 relative flex flex-col items-center justify-center gap-y-4 py-3",children:[e.jsx("button",{disabled:a||x,onClick:()=>d(null),className:"absolute disabled:hidden z-50 -top-3 -right-3 p-2 text-red-500 bg-gray-50 text-2xl rounded-full border border-gray-200",children:e.jsx(T,{})}),e.jsx(E,{loading:a,contentType:r==null?void 0:r.type,contentUrl:URL.createObjectURL(r),controls:!0}),e.jsxs("div",{className:`${a?"opacity-100 visible":"opacity-0 invisible"} absolute w-full h-[95%] rounded-md gap-y-6 px-4 bg-gray-800/80 transition-all backdrop-blur flex flex-col items-center justify-center`,children:[e.jsx(N,{}),e.jsx("h4",{className:"text-gray-50 text-center text-xl font-bold bg-gray-950/50 px-4 py-1 rounded-md",children:"Please do not refresh the page while adding story."})]}),e.jsxs("div",{className:`${x?"opacity-100 visible":"opacity-0 invisible"} absolute w-full h-[96%] rounded-md  bg-gray-800/80 transition-all backdrop-blur flex flex-col items-center justify-center`,children:[e.jsx("p",{className:"text-9xl text-green-600",children:e.jsx($,{})}),e.jsx("h4",{className:"text-gray-50 text-xl font-bold bg-gray-950/50 px-4 py-1 rounded-md",children:"Added to your stories"})]})]}):e.jsxs("div",{className:"w-full h-full relative flex flex-col items-center justify-center gap-y-4",children:[e.jsx("input",{className:"opacity-0 absolute inset-0 z-50 bg-red-300",accept:"image/jpeg, image/webp, image/png, image/gif, video/mp4, video/webm, video/ogg",type:"file",onChange:t=>b(t.target.files[0])}),e.jsx(L,{className:"text-7xl text-primary-500"}),e.jsx("h6",{className:"text-xl font-bold",children:"Add media"})]}),e.jsxs("div",{className:"w-full h-1/6 flex items-center justify-end gap-2",children:[e.jsx("button",{disabled:a,onClick:()=>{d(null),c(null)},className:"px-4 py-2 disabled:hidden bg-gray-50 rounded-md text-primary-500 border-2 border-primary-500",children:"Cancel"}),e.jsx("button",{disabled:!r||a,onClick:y,className:"px-4 py-2 bg-primary-500 rounded-md text-gray-50 border-2 border-primary-500 disabled:opacity-50",children:"Upload"})]})]}),e.jsx("div",{className:`${a?"block":"hidden"} fixed inset-0`})]})}export{I as A};
