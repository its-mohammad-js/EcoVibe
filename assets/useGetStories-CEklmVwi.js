import{g as S,r as g,h as x,u as B,a as T,b as j,c as $,q as w,e as A,d as G}from"./index.esm2017-CfrAC03N.js";import{r as f,ba as H,bb as k,cy as Q,_ as m,b as U}from"./index-Bkyzi3h6.js";import{l as D}from"./lodash-Bo2seEl7.js";function F(c){const[d,o]=f.useState(!1);return{loading:d,onDeleteSlide:async(i,e=()=>{})=>{try{const a=S();o(!0);const y=H(k,i.contentUrl);await Q(y);const l=g(a,`stories/${i.id}`);x(l),o(!1),e()}catch(a){m.error("There was an error on delete story, please try again later"),o(!1),e(),console.log(a)}},onRemoveHighlight:async i=>{try{o(!0),c(!1);const e=S(),a=g(e,`stories/${i.id}`);B(a,{highlightRef:null,title:null}),m.success("highlight removed successfully"),o(!1),c(!0)}catch(e){m.error("There was an error on remove highlight, please try again later"),o(!1),c(!1),console.log(e)}}}}const I=(c,d)=>{const[o,h]=f.useState(!1),[b,i]=f.useState([]),e=S(),{userId:a,loading:y}=U(n=>n.userData),l=f.useRef(),E=()=>{const n=g(e,"stories"),t=c?w(n,G("authorId"),A(c)):n;j(t,p=>{const r=Object.values(p.val()||{});i(r)})},L=n=>{const t=D.groupBy(n,"authorId");Object.keys(t).forEach(r=>{t[r]=t[r].map(s=>{var u;return{...s,isSeen:(u=s.seenBy)==null?void 0:u.includes(a)}})});const p=D.sortBy(Object.keys(t),r=>t[r].every(s=>s.isSeen));return l.current=d?l.current:p,l.current.map(r=>{var u,v,R,_,O;const s=t[r];return{authorId:r,first_name:(v=(u=s[0])==null?void 0:u.author)==null?void 0:v.first_name,last_name:(_=(R=s[0])==null?void 0:R.author)==null?void 0:_.last_name,profile_pic:(O=s[0])==null?void 0:O.authorProfilePic,slides:s,isSeen:s.every(({isSeen:q})=>q)}})};return f.useEffect(()=>{T(e);const n=g(e,".info/connected");return j(n,t=>{t.val()===!0&&!y?(E(),h(!1)):h(!0)}),()=>{$(e)}},[a]),{loading:o,groupedStories:L(b)}};export{F as a,I as u};
