import{r as f,a as y,j as e,Z as T,I as w,K as k,X as R,_ as C,M as A,g as $,t as M,u as O,v as B}from"./index-CX6rozT2.js";import{h as E}from"./index-mst5UTbG.js";import{n as H,o as _,a as F,l as X,p as U,q as I,k as z}from"./index-CIm1wt-3.js";import{u as q}from"./useMediaQuery-D_Ao6Dot.js";import{u as V}from"./UseDisableScroll-BPYT-uc3.js";import{C as K}from"./ContentSwitcher-CtEKDgpH.js";import{a as W,s as Q,u as Z,b as G,m as J}from"./motion-Bdxi8lcP.js";import{d as Y}from"./index-DX2xIFS5.js";import{D as L}from"./index-G8FWvDsG.js";import{b as ee}from"./index-f6uvkaTT.js";import{u as P}from"./UseOutsideClick-DzjMGR-D.js";import{c as te}from"./index-B02Vr8le.js";import{a as se}from"./useGetStories-DvbRau8-.js";import{e as le,M as ae}from"./index-8ulpejEq.js";function ne(t){t.values.forEach(i=>i.stop())}function ie(){const t=new Set,i={subscribe(s){return t.add(s),()=>void t.delete(s)},start(s,l){const r=[];return t.forEach(n=>{r.push(W(n,s,{transitionOverride:l}))}),Promise.all(r)},set(s){return t.forEach(l=>{Q(l,s)})},stop(){t.forEach(s=>{ne(s)})},mount(){return()=>{i.stop()}}};return i}function re(){const t=Z(ie);return G(t.mount,[]),t}const ce=re;function oe(t,i){const[s,l]=f.useState(t),[r,n]=f.useState(!0),d=f.useRef(),u=f.useRef(),[c,x]=f.useState(null);f.useEffect(()=>{if(!r)return u.current=Date.now(),d.current=setTimeout(()=>{i()},s),()=>clearTimeout(d.current)},[s,r,i]);const a=o=>{n(m=>o||!m)};return f.useEffect(()=>{if(c!=null&&c.startsWith("image/")&&r){const o=Date.now()-u.current,m=Math.max(s-o,0);m>0&&l(m)}},[c,r]),{setType:x,startTimeRef:u,remainingTime:s,pause:r,handlePause:a,setRemainingTime:l,setPause:n}}function de({setType:t,setRemainingTime:i,loading:s,changeStoryHandler:l,pause:r,handlePause:n,contextMenuShow:d}){const{story:u,slideindex:c,currentSlideIndex:x}=S(),[a,o]=f.useState(!1),{userId:m}=y(v=>v.userData);f.useEffect(()=>{t(u.type)},[x]);function p(){var j;o(!0),n();const v=w(),g=k(v,`stories/${u.id}`),h=(j=u==null?void 0:u.seenBy)==null?void 0:j.filter(b=>b!==m);R(g,{seenBy:[...h||[],m]})}return e.jsxs("div",{className:"size-full relative z-40 overflow-hidden flex items-center justify-center p-6",children:[!a&&e.jsx(T,{style:{position:"absolute"}}),e.jsx(K,{pause:r,loadingCallBack:p,contentUrl:u.contentUrl,contentType:u.type,autoPlayCondition:x===c,setRemainingTime:i}),s&&e.jsxs("div",{className:"absolute z-50 inset-0 flex flex-col text-gray-200 gap-y-4 font-medium bg-gray-900/80 rounded-xl items-center justify-center",children:[e.jsx(T,{}),e.jsx("p",{children:"Deleting story, please dont refresh page"})]}),e.jsxs("div",{onTouchStart:()=>n(!0),onTouchEnd:()=>n(!1),className:"absolute z-40 inset-0 flex lg:hidden",children:[e.jsx("div",{onClick:()=>!d&&!s&&l("prev"),className:"h-full w-2/5"}),e.jsx("div",{onClick:()=>!d&&!s&&l("next"),className:"h-full w-3/5"})]})]})}function ue({remainingTime:t,pause:i}){const s=ce(),{list:l,currentSlideIndex:r}=S();return f.useEffect(()=>{i?s.stop():s.start({translateX:"0%",transition:{duration:t/1e3,ease:"linear"}})},[i,t]),e.jsx("div",{className:"flex gap-2 p-2",children:l.map((n,d)=>e.jsx("p",{className:`${d===r?"bg-gray-50":"bg-gray-400"} w-full h-1 rounded-xl overflow-hidden relative`,children:d===r&&e.jsx(J.div,{className:"bg-primary-300 h-1 absolute left-0 top-0 w-full",initial:{translateX:"-100%"},animate:s,transition:{duration:t/1e3,ease:"linear"}})},d))})}function xe({onRemoveHighlight:t,pause:i,handlePause:s,onDeleteSlide:l,loading:r,contextMenuShow:n,setContextMenu:d}){const{changeStoryHandler:u,story:c}=S(),x=f.useRef();P(x,o,!n);const{userId:a}=y(p=>p.userData);function o(){s(),d(!1)}async function m(){try{s(!0),await l(c,()=>u("close")),C.success("story removed successfully"),s(!1)}catch(p){C.remove(),C.error("There was an error on delete story, please try again later"),s(!1),console.log(p)}}return e.jsxs("div",{ref:x,className:"flex items-center gap-x-2 relative",children:[e.jsx("button",{onClick:()=>s(),className:"text-gray-50",children:i?e.jsx(L,{className:"text-xl"}):e.jsx(ee,{className:"text-2xl"})}),e.jsx("button",{onClick:()=>{s(!0),d(!0)},className:"text-3xl text-gray-50",children:e.jsx(H,{className:"rotate-90"})}),e.jsxs("div",{className:`${n?"opacity-100 visible":"opacity-0 invisible"} ${r&&"hidden"} text-base flex top-8 p-1 flex-col bg-gray-50 text-gray-950 absolute right-0 rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>{t(c),d(!1)},disabled:!(c!=null&&c.highlightRef)||c.authorId!==a,className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(te,{className:"text-xl"}),e.jsx("p",{children:"Remove highlight"})]}),e.jsxs("button",{disabled:c.authorId!==a,onClick:()=>{m(),d(!1)},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx("p",{children:e.jsx(Y,{})}),e.jsx("p",{children:"Delete story"})]}),e.jsxs("button",{onClick:()=>{u("close")},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all text-red-500 items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(_,{className:"rotate-45 text-xl"}),e.jsx("p",{children:"Close"})]})]})]})}function fe({story:t,showComments:i,setShowComments:s}){var c,x;const{personalInformation:l,userId:r}=y(a=>a.userData),[n,d]=f.useState("");function u(){const a=w(),o=k(a,`stories/${t.id}`);R(o,{comments:[...(t==null?void 0:t.comments)||[],{createdAt:A(),authorId:r,content:n,authorProfile:l==null?void 0:l.profilePic,authorName:(l==null?void 0:l.first_name)+" "+(l==null?void 0:l.last_name),createdByUser:!0,commentId:$(r)}]}),d("")}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${i?"opacity-100 visible translate-y-0":"opacity-0 invisible translate-y-10"} absolute bottom-0 grid z-50 grid-rows-8 transition-all rounded-t-3xl px-2 pb-1 pt-3 overflow-hidden h-[25rem] w-screen md:w-full right-0 bg-gray-900/85 backdrop-blur-xl`,children:[e.jsx("div",{className:"w-full row-span-7 overflow-auto styled-scroll-bar flex flex-col gap-y-4",children:(c=t==null?void 0:t.comments)!=null&&c.length?(x=t==null?void 0:t.comments)==null?void 0:x.map((a,o)=>e.jsxs("div",{className:"w-full flex items-start",children:[e.jsx("div",{className:"size-14 rounded-full overflow-hidden flex items-center justify-center",children:a!=null&&a.authorProfile?e.jsx("img",{className:"mt-1",src:a==null?void 0:a.authorProfile}):e.jsx(F,{className:"text-4xl text-gray-400"})}),e.jsxs("div",{className:"flex-col p-1 w-11/12",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-300 line-clamp-1",children:a.authorName}),e.jsx("p",{className:"text-gray-400 text-sm line-clamp-6",children:a.content})]})]},o)):e.jsx("h2",{className:"my-auto w-full text-center text-gray-300",children:"no comments yet..."})}),e.jsxs("div",{className:"flex items-center border border-gray-400 rounded-2xl pl-1 pr-2",children:[e.jsx("input",{onKeyDown:a=>{a.key==="Enter"&&n.length>0&&(a.preventDefault(),u())},type:"text",onChange:({target:a})=>d(a.value),value:n,className:"bg-transparent w-full outline-none border-transparent flex-1 px-2 py-2 text-gray-300",placeholder:"comment something"}),e.jsx("button",{onClick:()=>u(),disabled:n.length<=0,className:"text-gray-300 disabled:opacity-0 transition-all text-3xl opacity-80 hover:opacity-100",children:e.jsx(X,{})})]})]}),i&&e.jsx("div",{onClick:()=>s(!1),className:"fixed inset-0 -z-10 md:hidden"})]})}function me({story:t,handlePause:i,changeStoryHandler:s}){var o,m;const{userId:l,auth_status:r}=y(p=>p.userData),[n,d]=f.useState(!1),[u,c]=f.useState(null),x=f.useRef();P(x,()=>{c(!1),u!==null&&i()},u===null),f.useEffect(()=>{var p;d((p=t==null?void 0:t.likes)==null?void 0:p.includes(l))},[t]);function a(){const p=w(),v=k(p,`stories/${t.id}`);R(v,{likes:M(t==null?void 0:t.likes,l)})}return e.jsxs("div",{ref:x,className:"absolute w-fit md:w-full bottom-0 right-0 gap-y-3 pb-4 gap-x-2 z-50 p-2",children:[e.jsxs("div",{className:"flex flex-col items-end px-1 py-0.5",children:[e.jsxs("button",{onClick:a,className:"text-gray-400 text-3xl",children:[n?e.jsx(U,{className:"text-red-500"}):e.jsx(I,{className:"text-gray-400"}),e.jsx("p",{className:"text-lg",children:((o=t==null?void 0:t.likes)==null?void 0:o.length)||0})]}),e.jsxs("button",{disabled:r!==200,onClick:()=>{i(!0),c(!0)},className:"text-gray-400 text-3xl disabled:hidden",children:[e.jsx(le,{}),e.jsx("p",{className:"text-lg",children:((m=t==null?void 0:t.comments)==null?void 0:m.length)||0})]}),e.jsxs("button",{onClick:()=>{s("close")},className:"text-gray-400 text-3xl text-center",children:[e.jsx(ae,{}),e.jsx("p",{className:"text-xs",children:"close"})]})]}),e.jsx(fe,{story:t,showComments:u,setShowComments:c})]})}function he(){const{changeStoryHandler:t,listIndex:i,currentListIndex:s,story:l}=S(),{remainingTime:r,pause:n,handlePause:d,setRemainingTime:u,setType:c}=oe(5e3,()=>t("next")),[x,a]=f.useState(!1),{onDeleteSlide:o,loading:m,onRemoveHighlight:p}=se(()=>{d(),location.pathname.includes("seller")&&t("close")}),v=O();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"size-full relative z-50 bg-gray-950 lg:rounded-xl flex items-center",children:[e.jsx("div",{className:"z-50 absolute -left-4 h-1/2 hidden xl:flex items-center",children:e.jsx("button",{disabled:m,onClick:()=>t("prev"),className:"text-2xl disabled:hidden rounded-full p-1.5 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2 rotate-180",children:e.jsx(z,{})})}),e.jsxs("div",{className:`${i===s?"block":"hidden"} absolute z-50 top-0 w-full p-1`,children:[e.jsx(ue,{pause:n,remainingTime:r}),e.jsxs("div",{className:"w-full flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-10 bg-gray-50/20 rounded-full overflow-hidden flex items-center justify-center",children:l!=null&&l.authorProfilePic?e.jsx("img",{src:l==null?void 0:l.authorProfilePic,className:"object-cover"}):e.jsx(E,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h6",{onClick:()=>v(`/EcoVibe/seller/${l==null?void 0:l.authorId}`),className:"text-gray-50 text-lg cursor-pointer",children:l.author.first_name})]}),e.jsx(xe,{pause:n,onRemoveHighlight:p,handlePause:d,onDeleteSlide:o,loading:m,contextMenuShow:x,setContextMenu:a})]})]}),e.jsx(de,{setType:c,setRemainingTime:u,loading:m,changeStoryHandler:t,handlePause:d,pause:n,contextMenuShow:x}),e.jsx(me,{story:l,handlePause:d,changeStoryHandler:t}),e.jsx("div",{className:`${i!==s&&"!hidden"} absolute -right-4 h-1/2 hidden xl:flex items-center`,children:e.jsx("button",{disabled:m,onClick:()=>t("next"),className:"text-2xl disabled:hidden disabled:bg-gray-500 disabled:opacity-50 rounded-full p-1.5 z-40 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2",children:e.jsx(z,{})})})]}),m&&e.jsx("div",{className:"fixed inset-0 z-40"})]})}const ge=(t,i,s)=>{const[l,r]=f.useState(0),n=f.useRef(),d=q({maxWidth:768}),[u,c]=f.useState(null),[x,a]=f.useState(!1);V(780,!1);const o=B();return f.useEffect(()=>{var h,j;const g=(j=(h=s[t])==null?void 0:h.slides)==null?void 0:j.findIndex(({isSeen:b})=>!b);r(g>=0?g:0)},[t]),f.useEffect(()=>{const g=document.querySelector(".currentSlide"),h=new IntersectionObserver(([j])=>{if(!j.isIntersecting&&u!==null){const b=u==="next"?t<s.length-1?t+1:null:t-1;a(!0),i(b),r(0),c(null)}},{threshold:.05});return g&&h.observe(g),()=>h.disconnect()},[u,t]),f.useEffect(()=>{if(x){const g=setTimeout(()=>a(!1),500);return()=>clearTimeout(g)}},[x]),f.useEffect(()=>{(()=>{if(!n.current)return;const h=document.querySelector(".currentSlide");if(!h)return;const j=h.getBoundingClientRect(),b=n.current.getBoundingClientRect(),N=j.left+j.width/2-(b.left+b.width/2);n.current.scrollLeft+=N})()},[t,d,x]),{containerRef:n,isChangingSlide:x,changeStory:g=>{const h=s[t],j=g==="next";if(g==="close"){i(null),r(0);return}else{let b=l+(j?1:-1);const N=t+(j?1:-1);(b<0||b>=h.slides.length)&&(i(N>=0&&N<s.length?N:null),b=0),r(b)}},handleTouch:(g,h)=>{if(h==="start")c(null),n.current.dataset.touchStart=g.touches[0].clientX;else if(h==="move"){const j=g.touches[0].clientX-n.current.dataset.touchStart;c(j>20?"prev":"next")}},getPaginatedLists:()=>o!=null&&o.id?s:s.map((g,h)=>({...g,listIndex:h})).filter((g,h)=>h===t-1||h===t||h===t+1),currentSlideIndex:l}},D=f.createContext();function Pe({currentListIndex:t,setList:i,storiesList:s}){const{containerRef:l,isChangingSlide:r,changeStory:n,handleTouch:d,getPaginatedLists:u,currentSlideIndex:c}=ge(t,i,s);return e.jsx("div",{ref:l,className:`${r?"overflow-hidden":"overflow-auto"} fixed bg-gray-950/80 hidden-scroll-bar inset-0 z-50 lg:flex items-center justify-center snap-x snap-mandatory lg:snap-none`,children:e.jsxs("div",{onTouchMove:x=>d(x,"move"),onTouchStart:x=>d(x,"start"),className:"inline-flex items-center lg:gap-x-8 size-full lg:px-[500vw]",children:[u().map(({slides:x,listIndex:a})=>{if(x)return e.jsx("div",{className:`${a===t?"lg:h-[95vh] currentSlide opacity-100":"lg:h-[80vh] opacity-90"} flex-none h-full select-none w-full lg:relative lg:w-96 transition-all duration-500 z-40 snap-end`,children:x.map((o,m)=>{var p;return t===a?c===m&&e.jsx(D.Provider,{value:{changeStoryHandler:n,listIndex:a,currentListIndex:t,list:x,currentSlideIndex:c,slideindex:m,story:o},children:e.jsx(he,{},m)}):e.jsx("div",{className:"size-full first-of-type:flex hidden relative bg-gray-950 lg:rounded-xl items-center",children:e.jsxs("div",{onClick:()=>i(a),className:"size-full select-none flex flex-col gap-y-2 items-center justify-center",children:[e.jsx("div",{className:"size-28 bg-gray-50/20 overflow-hidden rounded-full",children:o!=null&&o.authorProfilePic?e.jsx("img",{src:o==null?void 0:o.authorProfilePic,className:"object-cover"}):e.jsx(E,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h4",{className:"text-gray-50",children:(p=o.author)==null?void 0:p.first_name})]})},m)})},a)}),e.jsx("div",{className:`${r?"opacity-100 visible":"invisible opacity-0"} fixed inset-0 z-50 transition-all`}),e.jsx("div",{onClick:()=>i(null),id:"list-background",className:"fixed inset-0 bg-gray-950/80 hidden lg:block"})]})})}const S=()=>f.useContext(D);export{Pe as S};
