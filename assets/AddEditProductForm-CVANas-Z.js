import{ar as K,r as h,j as e,bv as U,df as F,i as I,bd as J,be as q,bf as Y,bg as X,cF as Z,b2 as M,W as D,b3 as B,aa as W,y as _,a1 as H,t as Q,b6 as E,p as V,V as ee,X as te,_ as S,b as se,u as ae,ad as le,aK as re}from"./index-CtgxsC2Z.js";import{c as ie}from"./index-CWZHlTd0.js";import{S as T}from"./react-select.esm-xaeEi6z6.js";import{u as oe}from"./index.esm-DSy5QFvK.js";function ne(o){return K({tag:"svg",attr:{version:"1.1",viewBox:"0 0 18 16"},child:[{tag:"path",attr:{d:"M17 2h-1v-1c0-0.55-0.45-1-1-1h-14c-0.55 0-1 0.45-1 1v12c0 0.55 0.45 1 1 1h1v1c0 0.55 0.45 1 1 1h14c0.55 0 1-0.45 1-1v-12c0-0.55-0.45-1-1-1zM2 3v10h-0.998c-0.001-0.001-0.001-0.001-0.002-0.002v-11.996c0.001-0.001 0.001-0.001 0.002-0.002h13.996c0.001 0.001 0.001 0.001 0.002 0.002v0.998h-12c-0.55 0-1 0.45-1 1v0zM17 14.998c-0.001 0.001-0.001 0.001-0.002 0.002h-13.996c-0.001-0.001-0.001-0.001-0.002-0.002v-11.996c0.001-0.001 0.001-0.001 0.002-0.002h13.996c0.001 0.001 0.001 0.001 0.002 0.002v11.996z"},child:[]},{tag:"path",attr:{d:"M15 5.5c0 0.828-0.672 1.5-1.5 1.5s-1.5-0.672-1.5-1.5 0.672-1.5 1.5-1.5 1.5 0.672 1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M16 14h-12v-2l3.5-6 4 5h1l3.5-3z"},child:[]}]})(o)}function ce({getValues:o,setValue:c,isEdit:g}){const[a,i]=h.useState([]),[m,N]=h.useState([]),[{uploading:v,uploadedImages:x,failed:b},y]=h.useState({uploading:!1,uploadedImages:[],failed:[]});function O(t){const s=t.map((l,d)=>({id:W(d),file:l}));N([...m,...s])}async function j(t,s,l=0){try{y(u=>({...u,uploading:!0}));const d=J(q,`Products Images/${o().Category}/${o().Name}${s}`);await Y(d,t);const p=await X(d);l+1,y(u=>({...u,uploading:!1,uploadedImages:[...u.uploadedImages,{url:p,id:s}]}))}catch{console.log("error on upload this id :",s),y(p=>({...p,uploading:!1,failed:[...p.failed,s]}))}}function n(){let t=0;m.forEach(async({file:s,id:l},d)=>{if(t===m.length){y(p=>({...p,error:null,uploading:!1}));return}await j(s,l,t)})}h.useEffect(()=>{var t;g&&!(a!=null&&a.length)&&i((t=o())==null?void 0:t.Images)},[g,a]),h.useEffect(()=>{const t=x.map(({url:l})=>l),s=g?[...t,...a]:JSON.stringify(t);c("Images",s)},[x]);async function w(t,s,l){var p;if(console.log("ok"),[...x,...a].find(u=>u.id===s)||t)try{y(r=>({...r,uploading:!0}));const u=J(q,t);await Z(u),l?i(a.filter(r=>r!==t)):N(m.filter(r=>r.id!==s))}catch(u){if(u.code==="storage/object-not-found"){const r=M(D,"Products",(p=o())==null?void 0:p.id);await B(r,{...o(),Images:o().Images.filter(f=>f!==t)||[],Thumbnail:o().Images.filter(f=>f!==t)[0]||""}),i(a.filter(f=>f!==t)),c("Images",o().Images.filter(f=>f!==t))}}finally{y(u=>({...u,uploading:!1}))}else N(m.filter(u=>u.id!==s))}return e.jsxs("div",{className:"lg:h-96 relative flex flex-col gap-3 lg:justify-between",children:[e.jsx("h4",{className:"text-xl font-bold",children:"Select Images : "}),e.jsxs("div",{className:"w-full relative h-60 lg:flex-1 flex flex-col items-center justify-center border-2 border-dotted border-primary-300 rounded-md gap-y-2",children:[e.jsx("input",{multiple:!0,onChange:t=>O([...t.target.files]),accept:"image/webp",type:"file",className:"absolute inset-0 bg-red-500 opacity-0"}),e.jsx("p",{className:"text-4xl text-primary-400",children:e.jsx(ne,{})}),e.jsx("h6",{className:"text-lg text-primary-400",children:"Add New Image"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Supports Only ",e.jsx("span",{className:"font-semibold",children:"WEBP"})]})]}),e.jsx("div",{className:"overflow-x-auto overflow-y-hidden styled-scroll-bar w-60",children:e.jsxs("div",{className:"inline-flex items-center gap-x-4",children:[g&&(a==null?void 0:a.length)>0&&(a==null?void 0:a.length)&&a.map((t,s)=>e.jsxs("div",{className:"relative my-4 size-16 lg:size-20 xl:size-24",children:[e.jsx("button",{type:"button",onClick:()=>w(t,"",!0),className:"absolute p-1 z-10 -top-2 -right-2 bg-gray-50 text-2xl text-red-500 rounded-full",children:e.jsx(U,{})}),e.jsx("img",{className:`${v&&"animate-pulse"} size-full border border-gray-300 rounded-md object-cover`,src:t}),e.jsx("div",{className:"absolute inset-0 bg-primary-600/10 backdrop-blur-sm rounded-md flex items-center justify-center text-9xl text-primary-500",children:e.jsx(F,{})})]},s)),m.length>0&&m.map(({file:t,id:s},l)=>e.jsxs("div",{className:"relative my-4 size-16 lg:size-20 xl:size-24",children:[e.jsxs("div",{className:"absolute -top-2 -right-2 z-10 transition-all",children:[e.jsx("button",{disabled:I(b,s),type:"button",onClick:()=>w("",s),className:"p-1 z-10 -top-2 -right-2 bg-gray-50 text-2xl text-red-500 rounded-full disabled:hidden",children:e.jsx(U,{})}),e.jsx("button",{type:"button",onClick:()=>j(t,s),className:`${I(b,s)?"block":"hidden"} p-1 text-lg border border-gray-400 bg-gray-50 rounded-full text-gray-800`,children:e.jsx(ie,{})})]}),e.jsx("img",{src:URL.createObjectURL(t),className:`${v&&"animate-pulse"} size-full lg:size-24 border border-gray-300 rounded-md object-cover`}),I(x.map(({id:d})=>d),s)&&e.jsx("div",{className:"absolute inset-0 bg-primary-600/10 backdrop-blur-sm rounded-md flex items-center justify-center text-9xl text-primary-500",children:e.jsx(F,{})}),I(b,s)&&e.jsx("div",{className:"absolute inset-0 bg-primary-600/10 backdrop-blur-sm rounded-md flex items-center justify-center text-5xl text-red-500",children:e.jsx("p",{children:"!"})})]},l))]})}),e.jsx("div",{className:"flex justify-end gap-x-2",children:e.jsx("button",{disabled:!m.length,type:"button",onClick:()=>n(),className:"px-4 py-2 bg-primary-500 border-2 border-gray-50 text-gray-50 rounded-md disabled:bg-gray-600 transition-all",children:"Upload"})})]})}const de=_.map(({title:o})=>({label:o,value:o})),P={Name:{required:"Please choose a name",minLength:{value:3,message:"Min length is 3 characters"},pattern:{value:/^[a-zA-Z0-9 ]+$/,message:"Name can only contain letters and numbers"}},Category:{required:"Select Cateogry"},Type:{required:"Choose Product Type"},Description:{required:"This field is reqired"},Price:{required:"This field is reqired",max:{value:1e3,message:"Max price is $1000"},min:{value:1,message:"Max price is $1"},pattern:{value:/^(?!0\d)(\d+(\.\d{1,2})?)$/,message:"Invalid number, please enter price in N.NN format"}}},L=(o,c)=>{var g,a;return(a=(g=_.find(({title:i})=>i===o))==null?void 0:g[c])==null?void 0:a.filter(({used:i})=>!i).map(({title:i})=>({label:i,value:i}))};function pe({register:o,setValue:c,getValues:g,errors:a,isEdit:i}){var v,x,b,y,O,j,n,w,t,s;const[m,N]=h.useState([]);return h.useEffect(()=>{c("Tags",JSON.stringify(m))},[m]),e.jsxs("div",{className:"flex flex-col gap-y-2 mb-6 lg:basis-2/5",children:[e.jsxs("div",{className:"grid grid-rows-4 lg:grid-cols-2 lg:grid-rows-2 gap-2 lg:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Product Name :"}),e.jsx("input",{autoFocus:i,type:"text",...o("Name",{...P.Name}),className:"px-3 py-2 border border-gray-300 rounded-md w-full outline-none focus:border-primary-400/50 transition-all",placeholder:"Enter Your Product Title"}),e.jsx("p",{className:"text-red-500 px-1",children:(v=a==null?void 0:a.Name)==null?void 0:v.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Category :"}),e.jsx(T,{menuShouldScrollIntoView:!1,options:de,...o("Category",{...P.Category}),onChange:({value:l})=>c("Category",l),placeholder:i?(x=g())==null?void 0:x.Category:"Add Category",isDisabled:i}),e.jsx("p",{className:"text-red-500 px-1",children:(b=a==null?void 0:a.Category)==null?void 0:b.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Product Type :"}),e.jsx(T,{menuShouldScrollIntoView:!1,...o("Type",{...P.Type}),onChange:({value:l})=>c("Type",l),options:L((y=g())==null?void 0:y.Category,"productTypes"),placeholder:i?(O=g())==null?void 0:O.Type:"Select Product Type",isDisabled:i}),e.jsx("p",{className:"text-red-500 px-1",children:(j=a==null?void 0:a.Type)==null?void 0:j.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Collection :"}),e.jsx(T,{menuShouldScrollIntoView:!1,...o("Collection"),onChange:({value:l})=>c("Collection",l),options:L((n=g())==null?void 0:n.Category,"collections"),placeholder:i?(w=g())==null?void 0:w.Collection:"Add Collection"})]})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Tags :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(({title:l},d)=>e.jsxs("button",{type:"button",onClick:()=>N(Q(m,l)),className:`${I(m,l)?"bg-primary-500 text-gray-50 border-gray-50 [&>span]:inline":"border-primary-300 bg-gray-50 text-primary-500 [&>span]:hidden"} flex items-center gap-1 px-2 py-1 rounded-md border transition-all`,children:[e.jsx("p",{children:l}),e.jsx("span",{children:e.jsx(E,{})})]},d))})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Description :"}),e.jsx("textarea",{type:"text",rows:8,...o("Description",{...P.Description}),className:"px-3 py-2 border border-gray-300 rounded-md w-full outline-none focus:border-primary-400/50 transition-all resize-none",placeholder:"Write About Your Product"}),e.jsx("p",{className:"text-red-500 px-1",children:(t=a==null?void 0:a.Description)==null?void 0:t.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Price :"}),e.jsx("input",{type:"number",step:"0.01",rows:8,...o("Price",{...P.Price}),className:"px-3 py-2 border border-gray-300 rounded-md w-full outline-none focus:border-primary-400/50 transition-all resize-none",placeholder:"Add Product Price"}),e.jsx("p",{className:"text-red-500 px-1",children:(s=a==null?void 0:a.Price)==null?void 0:s.message})]})]})}function me({getValues:o,setValue:c,isEdit:g}){var n,w;const[a,i]=h.useState([]),[{optionsList:m,loading:N,error:v},x]=h.useState({loading:!1,optionsList:[],error:null}),{Type:b}=o(),y=h.useRef();async function O(){var t;try{x(p=>({...p,loading:!0}));const s=ee(D,"ProductsOptions"),l=(t=await te(s))==null?void 0:t.docs.map(p=>p.data());localStorage.setItem("productsOptions",JSON.stringify(l));const d=l[0].OptionData.find(p=>p.productType===b).productOptions;x({optionsList:d||[],loading:!1,error:null})}catch(s){S.error(s==null?void 0:s.message),x(l=>({...l,error:s==null?void 0:s.message,loading:!1}))}}h.useEffect(()=>{var s;if(!b)return;const t=JSON.parse(localStorage.getItem("productsOptions"));if(t!=null&&t.length){const l=(s=t[0].OptionData.find(d=>d.productType===b))==null?void 0:s.productOptions;x(d=>({...d,optionsList:l}))}else O()},[b]);function j(t,s){const l={title:t,options:s.map(({value:p})=>p)},d=a.filter(p=>p.title!==t);i(()=>s.length?[...d,l]:d)}if(h.useEffect(()=>{c("Options",g?a:JSON.stringify(a))},[a]),h.useEffect(()=>{var t,s,l;g&&((s=(t=o())==null?void 0:t.Options)!=null&&s.length)&&i((l=o())==null?void 0:l.Options)},[(w=(n=o())==null?void 0:n.Options)==null?void 0:w.length]),v&&!m.length)return e.jsxs("div",{className:"h-80 flex flex-col items-center justify-center gap-y-4",children:[e.jsx("h6",{className:"text-2xl font-bold",children:"Failed To Get Product Options..."}),e.jsx("button",{onClick:()=>O(),className:"px-4 py-2 rounded-md bg-primary-500 text-gray-50",children:"Try Again"})]});if(N)return e.jsxs("div",{className:"w-full h-80 animate-pulse",children:[e.jsx("h6",{className:"text-center text-3xl font-bold text-primary-300",children:"Load Options..."}),e.jsx("div",{className:"flex flex-col gap-y-4 my-4",children:V(4).map((t,s)=>e.jsx(T,{isDisabled:!0},s))})]});if(!N&&(m!=null&&m.length))return e.jsxs("div",{children:[e.jsxs("div",{className:"text-center my-2",children:[e.jsx("h4",{className:"text-3xl font-bold",children:"Select Options"}),e.jsxs("p",{className:"leading-6 text-sm",children:["This user-friendly interface allows admins to quickly add new products or update existing ones with ease âœï¸. Key fields like product name, price, description, and category are neatly organized ðŸ›ï¸.",e.jsx("span",{className:"hidden lg:inline",children:"Â  Admins can upload product images ðŸ“¸ and set stock availability directly from the modal. Validation ensures correct data entry âœ…, while real-time previews offer clarity ðŸ‘€. Whether launching a new item or tweaking details, the modal streamlines operations for a smooth e-commerce experience ðŸ’¼."})]})]}),e.jsxs("div",{className:"",children:[e.jsx("h6",{className:"text-xl font-bold",children:"Options List :"}),e.jsx("div",{ref:y,className:"flex flex-col gap-y-4 my-2",children:m.map(({title:t,options:s,once:l},d)=>{var p,u;return e.jsx("div",{className:"option",children:e.jsx(T,{onChange:r=>j(t,l?[r]:r),value:(u=(p=a.filter(({title:r})=>r===t)[0])==null?void 0:p.options)==null?void 0:u.map(r=>({label:r,value:r})),isMulti:!l,options:s.map(r=>({label:r,value:r})),placeholder:`Choose ${t}`})},d)})})]})]})}const xe=[{step:1,title:"General Info"},{step:2,title:"Options"},{step:3,title:"Images"}];function ye({onModalChange:o,isEdit:c,selectedProduct:g,getProducts:a}){const[i,m]=h.useState(1),{userId:N,businessInformation:v,personalInformation:x}=se(r=>r.userData),[b,y]=h.useState(!1),{register:O,setValue:j,getValues:n,formState:{errors:w,isValid:t},handleSubmit:s,watch:l}=oe(),d=ae();le(),h.useEffect(()=>{c&&Object.entries(g).forEach(([r,f])=>{j(r,f)})},[]);async function p(){var C,z,k,$,A,R;const r=c?n().Images:JSON.parse(n().Images),f=c?n().id:W(N);if(r.length>0)try{y(!0),await B(M(D,"Products",f),{Category:n().Category,Collection:n().Collection||"",Description:n().Description,Images:r,Name:n().Name,Options:c?(z=n())==null?void 0:z.Options:JSON.parse((C=n())==null?void 0:C.Options),Price:n().Price,Tags:($=(k=n())==null?void 0:k.Tags)!=null&&$.length?c?(R=n())==null?void 0:R.Tags:JSON.parse((A=n())==null?void 0:A.Tags):[],Thumbnail:r[0]||"",Type:n().Type,SellerId:N,SellerName:(v==null?void 0:v.business_name)||(x==null?void 0:x.fisrt_name)||"",SellerEmail:"test mail",SellerProfile:(x==null?void 0:x.profilePic)||""}),c?(S.success("your changes sumbitted"),a(),o()):(S.success("Product Uploaded Succesfully !"),d(`/EcoVibe/Products/${f}`)),y(!1)}catch(G){y(!1),console.log(G)}else S.error("add one image at least")}function u(){if(!t)return;const{Name:r,Type:f,Category:C,Price:z}=n(),k=c?n().Options:JSON.parse(n().Options);if(i===3){p();return}if(i===1&&(!(r!=null&&r.length)||!f||!C||!C||!z)){S.error("Please complete the product information form");return}else if(i===2&&!k.length){S("Add at least one option");return}else if(i!==3){m($=>$+1);return}}return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:s(()=>u()),className:"px-4 bg-gray-50 relative py-2 lg:px-6 lg:py-4 flex flex-col lg:gap-4 w-[95vw] lg:w-[50vw] xl:w-[40vw] h-5/6 lg:h-auto mx-auto lg:border border-gray-200 lg:shadow hover:shadow-2xl transition-all duration-300 rounded-md",children:[e.jsx("div",{className:"flex items-center justify-evenly lg:justify-center lg:gap-x-6 my-4",children:xe.map(({step:r,title:f},C)=>e.jsxs("div",{className:"flex flex-col items-center justify-center text-center gap-2 transition-all",children:[e.jsxs("p",{className:`${i===r?"bg-primary-500 text-gray-50":"border border-primary-500 text-primary-500 bg-gray-50"} size-14 rounded-full flex items-center justify-center text-2xl relative`,children:[r,r<3&&e.jsx("p",{className:`${r===i?"bg-primary-500":"bg-gray-300"} absolute -right-9 -z-10 w-10 h-1`})]}),e.jsx("span",{className:`${i===r?"text-primary-500 font-bold":"text-primary-400"} text-sm`,children:f})]},C))}),b&&e.jsxs("div",{className:"absolute inset-0 bg-gray-50 z-50 flex items-center gap-4 justify-center flex-col",children:[e.jsx(re,{className:"size-24"}),e.jsxs("h4",{className:"text-2xl font-bold text-center",children:[c?"Update product info, please dont refresh page":"Add new product, please dont refresh page","..."]})]}),e.jsxs("div",{className:"max-h-96 lg:max-h-[55vh] overflow-y-auto overflow-x-hidden styled-scroll-bar scroll-smooth px-2 py-1.5 relative",children:[e.jsx("div",{className:`${i===1?"visible opacity-100 static translate-x-0":"invisible opacity-0 absolute -top-96 -translate-y-96 -translate-x-96"} transition-all duration-500`,children:e.jsx(pe,{register:O,setValue:j,getValues:l,errors:w,isEdit:c})}),e.jsx("div",{className:`${i===2?"visible opacity-100 static translate-x-0":"invisible opacity-0 absolute -top-96 -translate-y-96 -translate-x-96"} transition-all duration-500`,children:e.jsx(me,{getValues:n,setValue:j,isEdit:c})}),e.jsx("div",{className:`${i===3?"visible opacity-100 static translate-x-0":"invisible opacity-0 absolute -top-96 -translate-y-96 -translate-x-96"} transition-all duration-500`,children:e.jsx(ce,{getValues:n,setValue:j,isEdit:c})})]}),e.jsxs("div",{className:"flex items-center justify-end my-2 gap-x-2",children:[e.jsx("button",{type:"button",disabled:c&&i===3||i===3&&n().Images!=="[]",onClick:()=>{i===1?o(null):m(r=>r-1)},className:"px-4 py-2 lg:w-1/6 border-2 rounded-md border-gray-600 text-gray-900 hover:border-primary-800 hover:text-primary-800 transition-all disabled:invisible",children:i===1?"Close":"Back"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-gray-50 rounded-md border-2 border-primary-500 hover:bg-gray-50 hover:text-primary-500 transition-all lg:w-1/5",children:i!==3?"Next":"Submit"})]})]}),e.jsx("div",{onClick:()=>{if(c)if(i!==3)o();else{S.remove(),S.error("Plase submit your changes...");return}else if(n().Images!=="[]"){S.remove(),S.error("Plase submit your product, you can remove it later...");return}o()},className:"absolute inset-0 bg-gray-950/70 backdrop-blur cursor-pointer -z-10"})]})}export{ye as A};
