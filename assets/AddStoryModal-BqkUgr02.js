import{r as p,b as v,j as e,bE as N,ad as S,ba as U,bF as C,aA as A,aq as k,ar as R,as as _,at as L,_ as i,bb as P,bc as T,g as y,bd as $,be as z}from"./index-C-z8IuQm.js";import{g as F,f as D,r as E,s as O}from"./index.esm2017-B1P96Ld3.js";import{C as q}from"./ContentSwitcher-CJw22vgF.js";function H({onModalChange:c}){const[t,o]=p.useState(null),[{error:B,isUploaded:x,loading:r},n]=p.useState({loading:!1,isUploaded:!1,error:null}),{userId:u,businessInformation:l,personalInformation:s}=v(a=>a.userData);async function m(){try{n({loading:!0,isUploaded:!1,error:null});const a=A(k(R,"Stories"),_("authorId","==",u));if(await L(a).then(({docs:w})=>w.length)>=10){i.error("You can upload a maximum of 10 slides every 10 hours. 📊⏳"),c(null);return}const g=P(T,`Story Images/${y()}`),f=await $(g,t),j=await z(f.ref);await b(j),n({loading:!1,isUploaded:!0,error:null}),c(null)}catch(a){i.error("there was an error on add story, please try again later"),console.log(a),n({loading:!1,isUploaded:!1,error:a})}}async function b(a){try{let d=y(u).replace(".","&");const g=F();await D(E(g,`stories/${d}`),{contentUrl:a,id:d,author:{first_name:(l==null?void 0:l.businessName)||(s==null?void 0:s.first_name)||(s==null?void 0:s.email),last_name:(l==null?void 0:l.career_title)||(s==null?void 0:s.last_name)},createdAt:O(),authorId:u,type:t==null?void 0:t.type,authorProfilePic:s.profilePic}),o(null),i.success("story created successfully")}catch(d){console.log(d)}}function h(a){if(a.size>20*1024*1024){i.error("File size exceeds 20MB limit.");return}if(["image/jpeg","image/webp","image/png","image/gif","video/mp4","video/webm","video/ogg"].includes(a.type))o(a);else{i.error("Only image, GIF, and video files are allowed.");return}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 z-20 bg-gray-50 py-2 lg:px-6 lg:py-4 w-[95vw] lg:w-[50vw] xl:w-[40vw] h-5/6 lg:h-[80vh] mx-auto lg:border border-gray-200 lg:shadow hover:shadow-2xl transition-all duration-300 rounded-md flex flex-col",children:[e.jsx("h4",{className:"text-2xl font-bold mb-2",children:"Add New Story"}),t?e.jsxs("div",{className:"w-full h-5/6 relative flex flex-col items-center justify-center gap-y-4 py-3",children:[e.jsx("button",{disabled:r||x,onClick:()=>o(null),className:"absolute disabled:hidden z-50 -top-3 -right-3 p-2 text-red-500 bg-gray-50 text-2xl rounded-full border border-gray-200",children:e.jsx(S,{})}),e.jsx(q,{loading:r,contentType:t==null?void 0:t.type,contentUrl:URL.createObjectURL(t),controls:!0}),e.jsxs("div",{className:`${r?"opacity-100 visible":"opacity-0 invisible"} absolute w-full h-[95%] rounded-md gap-y-6 px-4 bg-gray-800/80 transition-all backdrop-blur flex flex-col items-center justify-center`,children:[e.jsx(U,{}),e.jsx("h4",{className:"text-gray-50 text-center text-xl font-bold bg-gray-950/50 px-4 py-1 rounded-md",children:"Please do not refresh the page while adding story."})]}),e.jsxs("div",{className:`${x?"opacity-100 visible":"opacity-0 invisible"} absolute w-full h-[96%] rounded-md  bg-gray-800/80 transition-all backdrop-blur flex flex-col items-center justify-center`,children:[e.jsx("p",{className:"text-9xl text-green-600",children:e.jsx(C,{})}),e.jsx("h4",{className:"text-gray-50 text-xl font-bold bg-gray-950/50 px-4 py-1 rounded-md",children:"Added to your stories"})]})]}):e.jsxs("div",{className:"w-full h-full relative flex flex-col items-center justify-center gap-y-4",children:[e.jsx("input",{className:"opacity-0 absolute inset-0 z-50 bg-red-300",accept:"image/jpeg, image/webp, image/png, image/gif, video/mp4, video/webm, video/ogg",type:"file",onChange:a=>h(a.target.files[0])}),e.jsx(N,{className:"text-7xl text-primary-500"}),e.jsx("h6",{className:"text-xl font-bold",children:"Add media"})]}),e.jsxs("div",{className:"w-full h-1/6 flex items-center justify-end gap-2",children:[e.jsx("button",{disabled:r,onClick:()=>{o(null),c(null)},className:"px-4 py-2 disabled:hidden bg-gray-50 rounded-md text-primary-500 border-2 border-primary-500",children:"Cancel"}),e.jsx("button",{disabled:!t||r,onClick:m,className:"px-4 py-2 bg-primary-500 rounded-md text-gray-50 border-2 border-primary-500 disabled:opacity-50",children:"Upload"})]})]}),e.jsx("div",{className:`${r?"block":"hidden"} fixed inset-0`})]})}export{H as A};
