import{bz as B,bA as O,bB as M,bC as A,r as d,b as R,j as e,aK as T,bD as _,m as F,K as H,bE as U,bF as X,bG as V,bH as q,bd as G,be as I,bI as K,_ as N,aH as k,aM as E,l as W,ad as Q,ae as J}from"./index-veOntxnb.js";import{g as C,r as w,u as P,e as Y}from"./index.esm2017-D7M1-K4u.js";import{a as Z}from"./index-Bui8Ltk6.js";import{b as L}from"./index-DvHBSD3l.js";function ee(t){t.values.forEach(a=>a.stop())}function te(){const t=new Set,a={subscribe(s){return t.add(s),()=>void t.delete(s)},start(s,r){const n=[];return t.forEach(i=>{n.push(B(i,s,{transitionOverride:r}))}),Promise.all(n)},set(s){return t.forEach(r=>{O(r,s)})},stop(){t.forEach(s=>{ee(s)})},mount(){return()=>{a.stop()}}};return a}function se(){const t=M(te);return A(t.mount,[]),t}const ae=se;function ne(t,a){const[s,r]=d.useState(t),[n,i]=d.useState(!0),o=d.useRef(),c=d.useRef();return d.useEffect(()=>{if(!n)return c.current=Date.now(),o.current=setTimeout(()=>{a()},s),()=>clearTimeout(o.current)},[s,n,a]),{remainingTime:s,pause:n,handlePause:l=>{i(x=>l||!x)},setRemainingTime:r,setPause:i}}function le({setRemainingTime:t,loading:a,changeStoryHandler:s,pause:r,handlePause:n,contextMenuShow:i}){var h;const{story:o,slideindex:c,currentSlideIndex:m}=S(),l=d.useRef(),[x,f]=d.useState(!1),{auth_status:v,userId:g}=R(u=>u.userData);function j(){var z;f(!0),n();const u=C(),b=w(u,`stories/${o.id}`),p=v===401?_():g,y=(z=o==null?void 0:o.seenBy)==null?void 0:z.filter(D=>D!==p);P(b,{seenBy:[...y||[],p]})}return d.useEffect(()=>{l.current&&(r?l.current.pause():l.current.play())},[r]),e.jsxs("div",{className:"size-full relative z-40 overflow-hidden flex items-center justify-center p-6",children:[!x&&e.jsx(T,{className:"size-20 lg:size-36 absolute"}),(h=o.type)!=null&&h.startsWith("image/")?e.jsx("img",{src:o.contentUrl,alt:"story-content",className:"size-full object-contain",onLoad:()=>j()}):e.jsx("video",{ref:l,onLoadedData:()=>j(),onPlaying:u=>{const b=Math.max(0,(u.target.duration-u.target.currentTime)*1e3);t(b)},autoPlay:m===c,className:"size-full object-cover",src:o.contentUrl}),a&&e.jsxs("div",{className:"absolute z-50 inset-0 flex flex-col text-gray-200 gap-y-4 font-medium bg-gray-900/80 rounded-xl items-center justify-center",children:[e.jsx(T,{className:"size-24"}),e.jsx("p",{children:"Deleting story, please dont refresh page"})]}),e.jsxs("div",{onTouchStart:()=>n(!0),onTouchEnd:()=>n(!1),className:"absolute z-50 inset-0 flex",children:[e.jsx("div",{onClick:()=>!i&&!a&&s("prev"),className:"h-full w-2/5"}),e.jsx("div",{onClick:()=>!i&&!a&&s("next"),className:"h-full w-3/5"})]})]})}function re({remainingTime:t,pause:a}){const s=ae(),{list:r,currentSlideIndex:n}=S();return d.useEffect(()=>{a?s.stop():s.start({translateX:"0%",transition:{duration:t/1e3,ease:"linear"}})},[a,t]),e.jsx("div",{className:"flex gap-2 p-2",children:r.map((i,o)=>e.jsx("p",{className:`${o===n?"bg-gray-50":"bg-gray-400"} w-full h-1 rounded-xl overflow-hidden relative`,children:o===n&&e.jsx(F.div,{className:"bg-primary-300 h-1 absolute left-0 top-0 w-full",initial:{translateX:"-100%"},animate:s,transition:{duration:t/1e3,ease:"linear"}})},o))})}function ie({pause:t,handlePause:a,setLoading:s,loading:r,contextMenuShow:n,setContextMenu:i}){const{changeStoryHandler:o,story:c}=S(),m=d.useRef();H(m,x,!n);const{userId:l}=R(g=>g.userData);function x(){a(),i(!1)}async function f(){try{s(!0),a(!1);const g=G(I,c.contentUrl);await K(g);const j=C(),h=w(j,`stories/${c.id}`);await Y(h),N.success("story removed successfully")}catch(g){N.remove(),N.error("There was an error on delete story, please try again later"),s(!1),a(!1),console.log(g)}}async function v(){try{s(!0),a(!1);const g=C(),j=w(g,`stories/${c.id}`);P(j,{highlightRef:null,title:null}),N.success("highlight removed successfully"),s(!1),a(!0)}catch(g){N.error("There was an error on remove highlight, please try again later"),s(!1),a(!1),console.log(g)}}return e.jsxs("div",{ref:m,className:"flex items-center gap-x-2 relative",children:[e.jsx("button",{onClick:()=>a(),className:"text-gray-50",children:t?e.jsx(U,{className:"text-xl"}):e.jsx(Z,{className:"text-2xl"})}),e.jsx("button",{onClick:()=>{a(!0),i(!0)},className:"text-3xl text-gray-50",children:e.jsx(X,{className:"rotate-90"})}),e.jsxs("div",{className:`${n?"opacity-100 visible":"opacity-0 invisible"} ${r&&"hidden"} text-base flex top-8 p-1 flex-col bg-gray-50 text-gray-950 absolute right-0 rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>{v(),i(!1)},disabled:!(c!=null&&c.highlightRef)||c.authorId!==l,className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(L,{className:"text-xl"}),e.jsx("p",{children:"Remove highlight"})]}),e.jsxs("button",{disabled:c.authorId!==l,onClick:()=>{f(),i(!1)},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx("p",{children:e.jsx(V,{})}),e.jsx("p",{children:"Delete story"})]}),e.jsxs("button",{onClick:()=>{o("close")},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all text-red-500 items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(q,{className:"rotate-45 text-xl"}),e.jsx("p",{children:"Close"})]})]})]})}function oe(){const{changeStoryHandler:t,listIndex:a,currentListIndex:s,story:r}=S(),[n,i]=d.useState(!1),{remainingTime:o,pause:c,handlePause:m,setRemainingTime:l}=ne(5e3,()=>t("next")),[x,f]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"size-full relative z-50 bg-gray-950 lg:rounded-xl flex items-center",children:[e.jsx("div",{className:"z-50 absolute -left-4 h-1/2 hidden xl:flex items-center",children:e.jsx("button",{disabled:n,onClick:()=>t("prev"),className:"text-2xl disabled:hidden rounded-full p-1.5 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2 rotate-180",children:e.jsx(k,{})})}),e.jsxs("div",{className:`${a===s?"block":"hidden"} absolute z-50 top-0 w-full p-1`,children:[e.jsx(re,{pause:c,remainingTime:o}),e.jsxs("div",{className:"w-full flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-10 bg-gray-50/20 rounded-full overflow-hidden flex items-center justify-center",children:r!=null&&r.authorProfilePic?e.jsx("img",{src:r==null?void 0:r.authorProfilePic,className:"object-cover"}):e.jsx(E,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h6",{className:"text-gray-50 text-lg",children:r.author.first_name})]}),e.jsx(ie,{pause:c,handlePause:m,setLoading:i,loading:n,contextMenuShow:x,setContextMenu:f})]})]}),e.jsx(le,{setRemainingTime:l,loading:n,changeStoryHandler:t,handlePause:m,pause:c,contextMenuShow:x}),e.jsx("div",{className:`${a!==s&&"!hidden"} absolute -right-4 h-1/2 hidden xl:flex items-center`,children:e.jsx("button",{disabled:n,onClick:()=>t("next"),className:"text-2xl disabled:hidden disabled:bg-gray-500 disabled:opacity-50 rounded-full p-1.5 z-50 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2",children:e.jsx(k,{})})})]}),n&&e.jsx("div",{className:"fixed inset-0 z-40"})]})}const ce=(t,a,s)=>{const[r,n]=d.useState(0),i=d.useRef(),o=W({maxWidth:768}),[c,m]=d.useState(null),[l,x]=d.useState(!1);Q(780,!1);const f=J();return d.useEffect(()=>{},[t]),d.useEffect(()=>{const h=document.querySelector(".currentSlide"),u=new IntersectionObserver(([b])=>{if(!b.isIntersecting&&c!==null){const p=c==="next"?t<s.length-1?t+1:null:t-1;x(!0),a(p),n(0),m(null)}},{threshold:.05});return h&&u.observe(h),()=>u.disconnect()},[c,t]),d.useEffect(()=>{if(l){const h=setTimeout(()=>x(!1),500);return()=>clearTimeout(h)}},[l]),d.useEffect(()=>{(()=>{if(!i.current)return;const u=document.querySelector(".currentSlide");if(!u)return;const b=u.getBoundingClientRect(),p=i.current.getBoundingClientRect(),y=b.left+b.width/2-(p.left+p.width/2);i.current.scrollLeft+=y})()},[t,o,l]),{containerRef:i,isChangingSlide:l,changeStory:h=>{const u=s[t],b=h==="next";if(h==="close"){a(null),n(0);return}else{let p=r+(b?1:-1);const y=t+(b?1:-1);(p<0||p>=u.length)&&(a(y>=0&&y<s.length?y:null),p=0),n(p)}},handleTouch:(h,u)=>{if(u==="start")m(null),i.current.dataset.touchStart=h.touches[0].clientX;else if(u==="move"){const b=h.touches[0].clientX-i.current.dataset.touchStart;m(b>20?"prev":"next")}},getPaginatedLists:()=>f!=null&&f.id?s:s.filter((h,u)=>u===t-1||u===t||u===t+1),currentSlideIndex:r}},$=d.createContext();function he({currentListIndex:t,setList:a,storiesList:s}){const{containerRef:r,isChangingSlide:n,changeStory:i,handleTouch:o,getPaginatedLists:c,currentSlideIndex:m}=ce(t,a,s);return R(l=>l.userData),console.log(c()),e.jsx("div",{ref:r,className:`${n?"overflow-hidden":"overflow-auto"} fixed bg-gray-950/80 hidden-scroll-bar inset-0 z-50 lg:flex items-center justify-center snap-x snap-mandatory lg:snap-none`,children:e.jsxs("div",{onTouchMove:l=>o(l,"move"),onTouchStart:l=>o(l,"start"),className:"inline-flex items-center lg:gap-x-8 size-full lg:px-[500vw]",children:[c().map(({slides:l},x)=>{if(l)return e.jsx("div",{className:`${x===t?"lg:h-[95vh] currentSlide":"lg:h-[80vh]"} flex-none h-full select-none w-full lg:relative lg:w-96 transition-all z-40 snap-end`,children:l.map((f,v)=>{var g;return t===x?m===v&&e.jsx($.Provider,{value:{changeStoryHandler:i,listIndex:x,currentListIndex:t,list:l,currentSlideIndex:m,slideindex:v,story:f},children:e.jsx(oe,{},v)}):e.jsx("div",{className:"size-full first-of-type:flex hidden relative bg-gray-950 lg:rounded-xl items-center",children:e.jsxs("div",{onClick:()=>a(x),className:"size-full select-none flex flex-col gap-y-2 items-center justify-center",children:[e.jsx("div",{className:"size-28 bg-gray-50/20 overflow-hidden rounded-full",children:f!=null&&f.authorProfilePic?e.jsx("img",{src:f==null?void 0:f.authorProfilePic,className:"object-cover"}):e.jsx(E,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h4",{className:"text-gray-50",children:(g=f.author)==null?void 0:g.first_name})]})},v)})},x)}),e.jsx("div",{className:`${n?"opacity-100 visible":"invisible opacity-0"} fixed inset-0 z-50 transition-all`}),e.jsx("div",{onClick:()=>a(null),id:"list-background",className:"fixed inset-0 bg-gray-950/80 hidden lg:block"})]})})}const S=()=>d.useContext($);export{he as S};
