import{bz as E,bA as P,bB as D,bC as O,r as c,j as e,aJ as S,m as $,O as A,b as M,bD as B,bE as F,bF as X,bG as _,bc as H,bd as U,bH as q,b1 as w,q as C,s as R,bI as V,_ as y,b2 as G,aG as z,aL as T,l as W}from"./index-KofMtEW3.js";import{u as J}from"./UseDisableScroll-CYFbH9of.js";import{a as Q}from"./index-DuoAVoc3.js";import{b as I}from"./index-WMZW4D9K.js";function K(t){t.values.forEach(n=>n.stop())}function Y(){const t=new Set,n={subscribe(s){return t.add(s),()=>void t.delete(s)},start(s,a){const l=[];return t.forEach(i=>{l.push(E(i,s,{transitionOverride:a}))}),Promise.all(l)},set(s){return t.forEach(a=>{P(a,s)})},stop(){t.forEach(s=>{K(s)})},mount(){return()=>{n.stop()}}};return n}function Z(){const t=D(Y);return O(t.mount,[]),t}const L=Z;function ee(t,n){const[s,a]=c.useState(t),[l,i]=c.useState(!0),d=c.useRef(),o=c.useRef();return c.useEffect(()=>{if(!l)return o.current=Date.now(),d.current=setTimeout(()=>{n()},s),()=>clearTimeout(d.current)},[s,l,n]),{remainingTime:s,pause:l,handlePause:r=>{i(u=>r||!u)},setRemainingTime:a,setPause:i}}function te({setRemainingTime:t,loading:n,changeStoryHandler:s,pause:a,handlePause:l,contextMenuShow:i}){var x;const{story:d,slideindex:o,currentSlideIndex:m}=N(),r=c.useRef(),[u,g]=c.useState(!1);function b(){g(!0),l()}return c.useEffect(()=>{r.current&&(a?r.current.pause():r.current.play())},[a]),e.jsxs("div",{className:"size-full relative z-40 overflow-hidden flex items-center justify-center p-6",children:[!u&&e.jsx(S,{className:"size-20 lg:size-36 absolute"}),(x=d.type)!=null&&x.startsWith("image/")?e.jsx("img",{src:d.contentUrl,alt:"story-content",className:"size-full object-contain",onLoad:()=>b()}):e.jsx("video",{ref:r,onLoadedData:()=>b(),onPlaying:f=>{const h=Math.max(0,(f.target.duration-f.target.currentTime)*1e3);t(h)},autoPlay:m===o,className:"size-full object-cover",src:d.contentUrl}),n&&e.jsxs("div",{className:"absolute z-50 inset-0 flex flex-col text-gray-200 gap-y-4 font-medium bg-gray-900/80 rounded-xl items-center justify-center",children:[e.jsx(S,{className:"size-24"}),e.jsx("p",{children:"Deleting story, please dont refresh page"})]}),e.jsxs("div",{onTouchStart:()=>l(!0),onTouchEnd:()=>l(!1),className:"absolute z-50 inset-0 flex",children:[e.jsx("div",{onClick:()=>!i&&!n&&s("prev"),className:"h-full w-2/5"}),e.jsx("div",{onClick:()=>!i&&!n&&s("next"),className:"h-full w-3/5"})]})]})}function se({remainingTime:t,pause:n}){const s=L(),{list:a,currentSlideIndex:l}=N();return c.useEffect(()=>{n?s.stop():s.start({translateX:"0%",transition:{duration:t/1e3,ease:"linear"}})},[n,t]),e.jsx("div",{className:"flex gap-2 p-2",children:a.map((i,d)=>e.jsx("p",{className:`${d===l?"bg-gray-50":"bg-gray-400"} w-full h-1 rounded-xl overflow-hidden relative`,children:d===l&&e.jsx($.div,{className:"bg-primary-300 h-1 absolute left-0 top-0 w-full",initial:{translateX:"-100%"},animate:s,transition:{duration:t/1e3,ease:"linear"}})},d))})}function ne({pause:t,handlePause:n,setLoading:s,loading:a,contextMenuShow:l,setContextMenu:i}){const{changeStoryHandler:d,story:o}=N(),m=c.useRef();A(m,u,!l);const{userId:r}=M(x=>x.userData);function u(){n(),i(!1)}async function g(){try{s(!0),n(!1);const x=H(U,o.contentUrl);await q(x);const f=w(C(R,"Stories"),o.id);await V(f),y.success("story removed successfully"),window.location.reload()}catch(x){y.remove(),y.error("There was an error on delete story, please try again later"),s(!1),n(!1),console.log(x)}}async function b(){try{s(!0),n(!1);const x=w(C(R,"Stories"),o.id);await G(x,{...o,highlightRef:null}),y.success("highlight removed successfully"),window.location.reload()}catch(x){y.error("There was an error on remove highlight, please try again later"),s(!1),n(!1),console.log(x)}}return e.jsxs("div",{ref:m,className:"flex items-center gap-x-2 relative",children:[e.jsx("button",{onClick:()=>n(),className:"text-gray-50",children:t?e.jsx(B,{className:"text-xl"}):e.jsx(Q,{className:"text-2xl"})}),e.jsx("button",{onClick:()=>{n(!0),i(!0)},className:"text-3xl text-gray-50",children:e.jsx(F,{className:"rotate-90"})}),e.jsxs("div",{className:`${l?"opacity-100 visible":"opacity-0 invisible"} ${a&&"hidden"} text-base flex top-8 p-1 flex-col bg-gray-50 text-gray-950 absolute right-0 rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>{b(),i(!1)},disabled:!(o!=null&&o.highlightRef)||o.authorId!==r,className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(I,{className:"text-xl"}),e.jsx("p",{children:"Remove highlight"})]}),e.jsxs("button",{disabled:o.authorId!==r,onClick:()=>{g(),i(!1)},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx("p",{children:e.jsx(X,{})}),e.jsx("p",{children:"Delete story"})]}),e.jsxs("button",{onClick:()=>{d("close")},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all text-red-500 items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(_,{className:"rotate-45 text-xl"}),e.jsx("p",{children:"Close"})]})]})]})}function le(){const{changeStoryHandler:t,listIndex:n,currentListIndex:s,story:a}=N(),[l,i]=c.useState(!1),{remainingTime:d,pause:o,handlePause:m,setRemainingTime:r}=ee(5e3,()=>t("next")),[u,g]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"size-full relative z-50 bg-gray-950 lg:rounded-xl flex items-center",children:[e.jsx("div",{className:"z-50 absolute -left-4 h-1/2 hidden xl:flex items-center",children:e.jsx("button",{disabled:l,onClick:()=>t("prev"),className:"text-2xl disabled:hidden rounded-full p-1.5 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2 rotate-180",children:e.jsx(z,{})})}),e.jsxs("div",{className:`${n===s?"block":"hidden"} absolute z-50 top-0 w-full p-1`,children:[e.jsx(se,{pause:o,remainingTime:d}),e.jsxs("div",{className:"w-full flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-10 bg-gray-50/20 rounded-full overflow-hidden flex items-center justify-center",children:a!=null&&a.authorProfilePic?e.jsx("img",{src:a==null?void 0:a.authorProfilePic,className:"object-cover"}):e.jsx(T,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h6",{className:"text-gray-50 text-lg",children:a.author.first_name})]}),e.jsx(ne,{pause:o,handlePause:m,setLoading:i,loading:l,contextMenuShow:u,setContextMenu:g})]})]}),e.jsx(te,{setRemainingTime:r,loading:l,changeStoryHandler:t,handlePause:m,pause:o,contextMenuShow:u}),e.jsx("div",{className:`${n!==s&&"!hidden"} absolute -right-4 h-1/2 hidden xl:flex items-center`,children:e.jsx("button",{disabled:l,onClick:()=>t("next"),className:"text-2xl disabled:hidden disabled:bg-gray-500 disabled:opacity-50 rounded-full p-1.5 z-50 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2",children:e.jsx(z,{})})})]}),l&&e.jsx("div",{className:"fixed inset-0 z-40"})]})}const ae=(t,n,s)=>{const[a,l]=c.useState(0),i=c.useRef(),d=W({maxWidth:768}),[o,m]=c.useState(null),[r,u]=c.useState(!1);return J(780,!1),c.useEffect(()=>{const f=document.querySelector(".currentSlide"),h=new IntersectionObserver(([p])=>{if(!p.isIntersecting&&o!==null){const v=o==="next"?t<s.length-1?t+1:null:t-1;u(!0),n(v),l(0),m(null)}},{threshold:.05});return f&&h.observe(f),()=>h.disconnect()},[o,t]),c.useEffect(()=>{if(r){const f=setTimeout(()=>u(!1),500);return()=>clearTimeout(f)}},[r]),c.useEffect(()=>{(()=>{if(!i.current)return;const h=document.querySelector(".currentSlide");if(!h)return;const p=h.getBoundingClientRect(),v=i.current.getBoundingClientRect(),j=p.left+p.width/2-(v.left+v.width/2);i.current.scrollLeft+=j})()},[t,d,r]),{containerRef:i,isChangingSlide:r,changeStory:f=>{const h=s[t],p=f==="next";if(f==="close"){n(null),l(0);return}else{let v=a+(p?1:-1);const j=t+(p?1:-1);(v<0||v>=h.length)&&(n(j>=0&&j<s.length?j:null),v=0),l(v)}},handleTouch:(f,h)=>{if(h==="start")m(null),i.current.dataset.touchStart=f.touches[0].clientX;else if(h==="move"){const p=f.touches[0].clientX-i.current.dataset.touchStart;m(p>20?"prev":"next")}},getPaginatedLists:()=>s.filter((f,h)=>h===t-1||h===t||h===t+1),currentSlideIndex:a}},k=c.createContext();function de({currentListIndex:t,setList:n,storiesList:s}){const{containerRef:a,isChangingSlide:l,changeStory:i,handleTouch:d,getPaginatedLists:o,currentSlideIndex:m}=ae(t,n,s);return e.jsx("div",{ref:a,className:`${l?"overflow-hidden":"overflow-auto"} fixed bg-gray-950/80 hidden-scroll-bar inset-0 z-50 lg:flex items-center justify-center snap-x snap-mandatory lg:snap-none`,children:e.jsxs("div",{onTouchMove:r=>d(r,"move"),onTouchStart:r=>d(r,"start"),className:"inline-flex items-center lg:gap-x-8 size-full lg:px-[500vw]",children:[o().map((r,u)=>{if(r)return e.jsx("div",{className:`${u===t?"lg:h-[95vh] currentSlide":"lg:h-[80vh]"} flex-none h-full select-none w-full lg:relative lg:w-96 transition-all z-40 snap-end`,children:r.map((g,b)=>{var x;return t===u?m===b&&e.jsx(k.Provider,{value:{changeStoryHandler:i,listIndex:u,currentListIndex:t,list:r,currentSlideIndex:m,slideindex:b,story:g},children:e.jsx(le,{},b)}):e.jsx("div",{className:"size-full first-of-type:flex hidden relative bg-gray-950 lg:rounded-xl items-center",children:e.jsxs("div",{onClick:()=>n(u),className:"size-full select-none flex flex-col gap-y-2 items-center justify-center",children:[e.jsx("div",{className:"size-28 bg-gray-50/20 overflow-hidden rounded-full",children:g!=null&&g.authorProfilePic?e.jsx("img",{src:g==null?void 0:g.authorProfilePic,className:"object-cover"}):e.jsx(T,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h4",{className:"text-gray-50",children:(x=g.author)==null?void 0:x.first_name})]})},b)})},u)}),e.jsx("div",{className:`${l?"opacity-100 visible":"invisible opacity-0"} fixed inset-0 z-50 transition-all`}),e.jsx("div",{onClick:()=>n(null),id:"list-background",className:"fixed inset-0 bg-gray-950/80 hidden lg:block"})]})})}const N=()=>c.useContext(k);export{de as S};
