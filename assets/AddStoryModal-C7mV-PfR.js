import{r as y,b as C,j as e,bo as S,bp as U,al as R,as as _,_ as u,aT as A,aU as L,g as p,aV as P,aW as T}from"./index-DWSuo8YA.js";import{g as m,q as k,r as b,o as $,e as q,b as z,s as D,c as F}from"./index.esm2017-X8zW3DNY.js";import{C as B}from"./ContentSwitcher-BX8TLZrW.js";function W({onModalChange:i}){const[t,d]=y.useState(null),[{error:E,loading:l},c]=y.useState({loading:!1,error:null}),{userId:n,businessInformation:o,personalInformation:r}=C(a=>a.userData);async function h(){try{c({loading:!0,isUploaded:!1,error:null});const a=m(),s=k(b(a,"stories"),$("authorId"),q(n));if(await z(s).then(N=>{var x;return(x=Object.values(N.val()||{}))==null?void 0:x.length})>=8){u.error("You can upload a maximum of 8 slides every 10 hours. 📊⏳"),i(null);return}const j=A(L,`Story Images/${p()}`),w=await P(j,t),v=await T(w.ref);await f(v),c({loading:!1,error:null}),i(null)}catch(a){u.error("there was an error on add story, please try again later"),console.log(a),c({loading:!1,isUploaded:!1,error:a})}}async function f(a){try{let s=p(n).replace(".","&");const g=m();await D(b(g,`stories/${s}`),{contentUrl:a,id:s,author:{first_name:(o==null?void 0:o.businessName)||(r==null?void 0:r.first_name)||(r==null?void 0:r.email),last_name:(o==null?void 0:o.career_title)||(r==null?void 0:r.last_name)},createdAt:F(),authorId:n,type:t==null?void 0:t.type,authorProfilePic:r.profilePic}),d(null),u.success("story created successfully")}catch(s){console.log(s)}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 z-20 bg-gray-50 py-2 lg:px-6 lg:py-4 w-[95vw] lg:w-[50vw] xl:w-[40vw] h-5/6 lg:h-[80vh] mx-auto lg:border border-gray-200 lg:shadow hover:shadow-2xl transition-all duration-300 rounded-md flex flex-col",children:[e.jsx("h4",{className:"text-2xl font-bold mb-2",children:"Add New Story"}),t?e.jsxs("div",{className:"w-full h-5/6 relative flex flex-col items-center justify-center gap-y-4 py-3",children:[e.jsx("button",{disabled:l,onClick:()=>d(null),className:"absolute disabled:hidden z-50 -top-3 -right-3 p-2 text-red-500 bg-gray-50 text-2xl rounded-full border border-gray-200",children:e.jsx(R,{})}),e.jsx(B,{loading:l,contentType:t==null?void 0:t.type,contentUrl:URL.createObjectURL(t),controls:!0}),e.jsxs("div",{className:`${l?"opacity-100 visible":"opacity-0 invisible"} absolute w-full h-[95%] rounded-md gap-y-6 px-4 bg-gray-800/80 transition-all backdrop-blur flex flex-col items-center justify-center`,children:[e.jsx(_,{}),e.jsx("h4",{className:"text-gray-50 text-center text-xl font-bold bg-gray-950/50 px-4 py-1 rounded-md",children:"Please do not refresh the page while adding story."})]})]}):e.jsxs("div",{className:"w-full h-full relative flex flex-col items-center justify-center gap-y-4",children:[e.jsx("input",{className:"opacity-0 absolute inset-0 z-50 bg-red-300",accept:"image/jpeg, image/webp, image/png, image/gif, video/mp4, video/webm, video/ogg",type:"file",onChange:a=>{S(a.target.files[0],20,s=>d(s)),a.target.value=""}}),e.jsx(U,{className:"text-7xl text-primary-500"}),e.jsx("h6",{className:"text-xl font-bold",children:"Add media"})]}),e.jsxs("div",{className:"w-full h-1/6 flex items-center justify-end gap-2",children:[e.jsx("button",{disabled:l,onClick:()=>{d(null),i(null)},className:"px-4 py-2 disabled:hidden bg-gray-50 rounded-md text-primary-500 border-2 border-primary-500",children:"Cancel"}),e.jsx("button",{disabled:!t||l,onClick:h,className:"px-4 py-2 bg-primary-500 rounded-md text-gray-50 border-2 border-primary-500 disabled:opacity-50",children:"Upload"})]})]}),e.jsx("div",{className:`${l?"block":"hidden"} fixed inset-0`})]})}export{W as A};
