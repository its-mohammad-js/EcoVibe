import{bu as A,bv as $,bw as O,bx as B,r as x,b as R,j as e,aK as z,m as H,N as T,by as M,bz as _,bA as F,bB as X,_ as S,bC as U,bD as V,aj as q,aH as K,t as W,aE as P,aM as E,l as Q,a8 as G,a9 as J}from"./index-DFkV507d.js";import{g as w,r as C,u as k,s as Y}from"./index.esm2017-Bk58jxCu.js";import{b as Z}from"./index-DxbIFglj.js";import{c as I}from"./index-BKpAa_IK.js";import{a as L}from"./useGetStories-CSfz7jvO.js";function ee(t){t.values.forEach(n=>n.stop())}function te(){const t=new Set,n={subscribe(s){return t.add(s),()=>void t.delete(s)},start(s,a){const o=[];return t.forEach(r=>{o.push(A(r,s,{transitionOverride:a}))}),Promise.all(o)},set(s){return t.forEach(a=>{$(a,s)})},stop(){t.forEach(s=>{ee(s)})},mount(){return()=>{n.stop()}}};return n}function se(){const t=O(te);return B(t.mount,[]),t}const le=se;function ae(t,n){const[s,a]=x.useState(t),[o,r]=x.useState(!0),i=x.useRef(),m=x.useRef();return x.useEffect(()=>{if(!o)return m.current=Date.now(),i.current=setTimeout(()=>{n()},s),()=>clearTimeout(i.current)},[s,o,n]),{remainingTime:s,pause:o,handlePause:c=>{r(h=>c||!h)},setRemainingTime:a,setPause:r}}function ne({setRemainingTime:t,loading:n,changeStoryHandler:s,pause:a,handlePause:o,contextMenuShow:r}){var N;const{story:i,slideindex:m,currentSlideIndex:p}=y(),c=x.useRef(),[h,f]=x.useState(!1),{userId:b}=R(d=>d.userData);function j(){var g;f(!0),o();const d=w(),u=C(d,`stories/${i.id}`),l=(g=i==null?void 0:i.seenBy)==null?void 0:g.filter(v=>v!==b);k(u,{seenBy:[...l||[],b]})}return x.useEffect(()=>{c.current&&(a?c.current.pause():c.current.play())},[a]),e.jsxs("div",{className:"size-full relative z-40 overflow-hidden flex items-center justify-center p-6",children:[!h&&e.jsx(z,{className:"size-20 lg:size-36 absolute"}),(N=i.type)!=null&&N.startsWith("image/")?e.jsx("img",{src:i.contentUrl,alt:"story-content",className:"size-full object-contain",onLoad:()=>j()}):e.jsx("video",{ref:c,onLoadedData:()=>j(),onPlaying:d=>{const u=Math.max(0,(d.target.duration-d.target.currentTime)*1e3);t(u)},autoPlay:p===m,className:"size-full object-cover",src:i.contentUrl}),n&&e.jsxs("div",{className:"absolute z-50 inset-0 flex flex-col text-gray-200 gap-y-4 font-medium bg-gray-900/80 rounded-xl items-center justify-center",children:[e.jsx(z,{className:"size-24"}),e.jsx("p",{children:"Deleting story, please dont refresh page"})]}),e.jsxs("div",{onTouchStart:()=>o(!0),onTouchEnd:()=>o(!1),className:"absolute z-40 inset-0 flex lg:hidden",children:[e.jsx("div",{onClick:()=>!r&&!n&&s("prev"),className:"h-full w-2/5"}),e.jsx("div",{onClick:()=>!r&&!n&&s("next"),className:"h-full w-3/5"})]})]})}function ie({remainingTime:t,pause:n}){const s=le(),{list:a,currentSlideIndex:o}=y();return x.useEffect(()=>{n?s.stop():s.start({translateX:"0%",transition:{duration:t/1e3,ease:"linear"}})},[n,t]),e.jsx("div",{className:"flex gap-2 p-2",children:a.map((r,i)=>e.jsx("p",{className:`${i===o?"bg-gray-50":"bg-gray-400"} w-full h-1 rounded-xl overflow-hidden relative`,children:i===o&&e.jsx(H.div,{className:"bg-primary-300 h-1 absolute left-0 top-0 w-full",initial:{translateX:"-100%"},animate:s,transition:{duration:t/1e3,ease:"linear"}})},i))})}function re({pause:t,handlePause:n,onDeleteSlide:s,loading:a,contextMenuShow:o,setContextMenu:r}){const{changeStoryHandler:i,story:m}=y(),p=x.useRef();T(p,h,!o);const{userId:c}=R(j=>j.userData);function h(){n(),r(!1)}async function f(){try{n(!0),await s(m,()=>i("close")),S.success("story removed successfully"),n(!1)}catch(j){S.remove(),S.error("There was an error on delete story, please try again later"),n(!1),console.log(j)}}async function b(){}return e.jsxs("div",{ref:p,className:"flex items-center gap-x-2 relative",children:[e.jsx("button",{onClick:()=>n(),className:"text-gray-50",children:t?e.jsx(M,{className:"text-xl"}):e.jsx(Z,{className:"text-2xl"})}),e.jsx("button",{onClick:()=>{n(!0),r(!0)},className:"text-3xl text-gray-50",children:e.jsx(_,{className:"rotate-90"})}),e.jsxs("div",{className:`${o?"opacity-100 visible":"opacity-0 invisible"} ${a&&"hidden"} text-base flex top-8 p-1 flex-col bg-gray-50 text-gray-950 absolute right-0 rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>{b(),r(!1)},disabled:!(m!=null&&m.highlightRef)||m.authorId!==c,className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(I,{className:"text-xl"}),e.jsx("p",{children:"Remove highlight"})]}),e.jsxs("button",{disabled:m.authorId!==c,onClick:()=>{f(),r(!1)},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx("p",{children:e.jsx(F,{})}),e.jsx("p",{children:"Delete story"})]}),e.jsxs("button",{onClick:()=>{i("close")},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all text-red-500 items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(X,{className:"rotate-45 text-xl"}),e.jsx("p",{children:"Close"})]})]})]})}function ce({story:t,handlePause:n}){var N,d,u;const{userId:s,personalInformation:a,auth_status:o}=R(l=>l.userData),[r,i]=x.useState(!1),[m,p]=x.useState(null),c=x.useRef();T(c,()=>{p(!1),m!==null&&n()},m===null);const[h,f]=x.useState("");x.useEffect(()=>{var l;i((l=t==null?void 0:t.likes)==null?void 0:l.includes(s))},[t]);function b(){const l=w(),g=C(l,`stories/${t.id}`);k(g,{likes:W(t==null?void 0:t.likes,s)})}function j(){const l=w(),g=C(l,`stories/${t.id}`);k(g,{comments:[...(t==null?void 0:t.comments)||[],{createdAt:Y(),authorId:s,content:h,authorProfile:a==null?void 0:a.profilePic,authorName:(a==null?void 0:a.first_name)+" "+(a==null?void 0:a.last_name)}]}),f("")}return e.jsx(e.Fragment,{children:e.jsxs("div",{ref:c,className:"absolute w-full bottom-20 left-0 h-5 items-end flex gap-y-3 flex-col pb-8 gap-x-2 z-50 p-2",children:[e.jsxs("button",{onClick:b,className:"text-gray-400 text-4xl",children:[r?e.jsx(U,{className:"text-red-500"}):e.jsx(V,{className:"text-gray-400"}),e.jsx("p",{className:"text-lg",children:((N=t==null?void 0:t.likes)==null?void 0:N.length)||0})]}),e.jsx("input",{onClick:()=>{n(!0),p(!0)},type:"text",className:"bg-transparent w-full disabled:hidden outline-none border flex-1 px-2 py-2 border-gray-400 text-gray-300 rounded-2xl",placeholder:"comment something"}),e.jsxs("div",{className:`${m?"opacity-100 visible translate-y-0":"opacity-0 invisible translate-y-10"} absolute -bottom-24 grid grid-rows-8 transition-all rounded-t-3xl px-2 pb-1 pt-3 overflow-hidden h-[25rem] w-full left-0 bg-gray-900/85 backdrop-blur-xl`,children:[e.jsx("div",{className:"w-full row-span-7 overflow-auto styled-scroll-bar flex flex-col gap-y-4",children:(d=t==null?void 0:t.comments)!=null&&d.length?(u=t==null?void 0:t.comments)==null?void 0:u.map((l,g)=>e.jsxs("div",{className:"w-full flex items-start",children:[e.jsx("div",{className:"size-14 rounded-full overflow-hidden flex items-center justify-center",children:l!=null&&l.authorProfile?e.jsx("img",{className:"mt-1",src:l==null?void 0:l.authorProfile}):e.jsx(q,{className:"text-4xl text-gray-400"})}),e.jsxs("div",{className:"flex-col p-1 w-11/12",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-300 line-clamp-1",children:l.authorName}),e.jsx("p",{className:"text-gray-400 text-sm line-clamp-6",children:l.content})]})]},g)):e.jsx("h2",{className:"my-auto w-full text-center text-gray-300",children:"no comments yet..."})}),e.jsxs("div",{className:"flex items-center border border-gray-400 rounded-2xl pl-1 pr-2",children:[e.jsx("input",{onKeyDown:l=>{l.key==="Enter"&&h.length>0&&(l.preventDefault(),j())},type:"text",onChange:({target:l})=>f(l.value),value:h,className:"bg-transparent w-full outline-none border-transparent flex-1 px-2 py-2 text-gray-300",placeholder:"comment something"}),e.jsx("button",{onClick:()=>j(),disabled:h.length<=0,className:"text-gray-300 disabled:opacity-0 transition-all text-3xl opacity-80 hover:opacity-100",children:e.jsx(K,{})})]})]})]})})}function oe(){const{changeStoryHandler:t,listIndex:n,currentListIndex:s,story:a}=y(),{remainingTime:o,pause:r,handlePause:i,setRemainingTime:m}=ae(5e3,()=>t("next")),[p,c]=x.useState(!1),{onDeleteSlide:h,loading:f,onRemoveHighlight:b}=L(i);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"size-full relative z-50 bg-gray-950 lg:rounded-xl flex items-center",children:[e.jsx("div",{className:"z-50 absolute -left-4 h-1/2 hidden xl:flex items-center",children:e.jsx("button",{disabled:f,onClick:()=>t("prev"),className:"text-2xl disabled:hidden rounded-full p-1.5 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2 rotate-180",children:e.jsx(P,{})})}),e.jsxs("div",{className:`${n===s?"block":"hidden"} absolute z-50 top-0 w-full p-1`,children:[e.jsx(ie,{pause:r,remainingTime:o}),e.jsxs("div",{className:"w-full flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-10 bg-gray-50/20 rounded-full overflow-hidden flex items-center justify-center",children:a!=null&&a.authorProfilePic?e.jsx("img",{src:a==null?void 0:a.authorProfilePic,className:"object-cover"}):e.jsx(E,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h6",{className:"text-gray-50 text-lg",children:a.author.first_name})]}),e.jsx(re,{pause:r,onRemoveHighlight:b,handlePause:i,onDeleteSlide:h,loading:f,contextMenuShow:p,setContextMenu:c})]})]}),e.jsx(ne,{setRemainingTime:m,loading:f,changeStoryHandler:t,handlePause:i,pause:r,contextMenuShow:p}),e.jsx(ce,{story:a,handlePause:i}),e.jsx("div",{className:`${n!==s&&"!hidden"} absolute -right-4 h-1/2 hidden xl:flex items-center`,children:e.jsx("button",{disabled:f,onClick:()=>t("next"),className:"text-2xl disabled:hidden disabled:bg-gray-500 disabled:opacity-50 rounded-full p-1.5 z-40 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2",children:e.jsx(P,{})})})]}),f&&e.jsx("div",{className:"fixed inset-0 z-40"})]})}const de=(t,n,s)=>{const[a,o]=x.useState(0),r=x.useRef(),i=Q({maxWidth:768}),[m,p]=x.useState(null),[c,h]=x.useState(!1);G(780,!1);const f=J();return x.useEffect(()=>{var u,l;const d=(l=(u=s[t])==null?void 0:u.slides)==null?void 0:l.findIndex(({isSeen:g})=>!g);o(d>=0?d:0)},[t]),x.useEffect(()=>{const d=document.querySelector(".currentSlide"),u=new IntersectionObserver(([l])=>{if(!l.isIntersecting&&m!==null){const g=m==="next"?t<s.length-1?t+1:null:t-1;h(!0),n(g),o(0),p(null)}},{threshold:.05});return d&&u.observe(d),()=>u.disconnect()},[m,t]),x.useEffect(()=>{if(c){const d=setTimeout(()=>h(!1),500);return()=>clearTimeout(d)}},[c]),x.useEffect(()=>{(()=>{if(!r.current)return;const u=document.querySelector(".currentSlide");if(!u)return;const l=u.getBoundingClientRect(),g=r.current.getBoundingClientRect(),v=l.left+l.width/2-(g.left+g.width/2);r.current.scrollLeft+=v})()},[t,i,c]),{containerRef:r,isChangingSlide:c,changeStory:d=>{const u=s[t],l=d==="next";if(d==="close"){n(null),o(0);return}else{let g=a+(l?1:-1);const v=t+(l?1:-1);(g<0||g>=u.slides.length)&&(n(v>=0&&v<s.length?v:null),g=0),o(g)}},handleTouch:(d,u)=>{if(u==="start")p(null),r.current.dataset.touchStart=d.touches[0].clientX;else if(u==="move"){const l=d.touches[0].clientX-r.current.dataset.touchStart;p(l>20?"prev":"next")}},getPaginatedLists:()=>f!=null&&f.id?s:s.map((d,u)=>({...d,listIndex:u})).filter((d,u)=>u===t-1||u===t||u===t+1),currentSlideIndex:a}},D=x.createContext();function ge({currentListIndex:t,setList:n,storiesList:s}){const{containerRef:a,isChangingSlide:o,changeStory:r,handleTouch:i,getPaginatedLists:m,currentSlideIndex:p}=de(t,n,s);return e.jsx("div",{ref:a,className:`${o?"overflow-hidden":"overflow-auto"} fixed bg-gray-950/80 hidden-scroll-bar inset-0 z-50 lg:flex items-center justify-center snap-x snap-mandatory lg:snap-none`,children:e.jsxs("div",{onTouchMove:c=>i(c,"move"),onTouchStart:c=>i(c,"start"),className:"inline-flex items-center lg:gap-x-8 size-full lg:px-[500vw]",children:[m().map(({slides:c,listIndex:h})=>{if(c)return e.jsx("div",{className:`${h===t?"lg:h-[95vh] currentSlide":"lg:h-[80vh]"} flex-none h-full select-none w-full lg:relative lg:w-96 transition-all duration-500 z-40 snap-end`,children:c.map((f,b)=>{var j;return t===h?p===b&&e.jsx(D.Provider,{value:{changeStoryHandler:r,listIndex:h,currentListIndex:t,list:c,currentSlideIndex:p,slideindex:b,story:f},children:e.jsx(oe,{},b)}):e.jsx("div",{className:"size-full first-of-type:flex hidden relative bg-gray-950 lg:rounded-xl items-center",children:e.jsxs("div",{onClick:()=>n(h),className:"size-full select-none flex flex-col gap-y-2 items-center justify-center",children:[e.jsx("div",{className:"size-28 bg-gray-50/20 overflow-hidden rounded-full",children:f!=null&&f.authorProfilePic?e.jsx("img",{src:f==null?void 0:f.authorProfilePic,className:"object-cover"}):e.jsx(E,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h4",{className:"text-gray-50",children:(j=f.author)==null?void 0:j.first_name})]})},b)})},h)}),e.jsx("div",{className:`${o?"opacity-100 visible":"invisible opacity-0"} fixed inset-0 z-50 transition-all`}),e.jsx("div",{onClick:()=>n(null),id:"list-background",className:"fixed inset-0 bg-gray-950/80 hidden lg:block"})]})})}const y=()=>x.useContext(D);export{ge as S};
