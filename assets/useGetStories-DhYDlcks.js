import{g as S,r as g,e as L,u as q,a as x,b as j,c as T,q as $,h as w,i as A}from"./index.esm2017-R3dF6-mv.js";import{r as f,ba as G,bb as H,cB as k,_ as y,u as Q}from"./index-DTXJM5T6.js";import{l as B}from"./lodash-DtidTkUn.js";function C(c){const[d,o]=f.useState(!1);return{loading:d,onDeleteSlide:async(i,e=()=>{})=>{try{const a=S();o(!0);const p=G(H,i.contentUrl);await k(p);const l=g(a,`stories/${i.id}`);L(l),o(!1),e()}catch(a){y.error("There was an error on delete story, please try again later"),o(!1),e(),console.log(a)}},onRemoveHighlight:async i=>{try{o(!0),c(!1);const e=S(),a=g(e,`stories/${i.id}`);q(a,{highlightRef:null,title:null}),y.success("highlight removed successfully"),o(!1),c(!0)}catch(e){y.error("There was an error on remove highlight, please try again later"),o(!1),c(!1),console.log(e)}}}}const F=(c,d)=>{const[o,h]=f.useState(!1),[b,i]=f.useState([]),e=S(),{userId:a,loading:p}=Q(n=>n.userData),l=f.useRef(),D=()=>{const n=g(e,"stories"),t=c?$(n,A("authorId"),w(c)):n;j(t,m=>{const s=Object.values(m.val()||{});i(s)})},E=n=>{const t=B.groupBy(n,"authorId");Object.keys(t).forEach(s=>{t[s]=t[s].map(r=>{var u;return{...r,isSeen:(u=r.seenBy)==null?void 0:u.includes(a)}})});const m=B.sortBy(Object.keys(t),s=>t[s].every(r=>r.isSeen));return l.current=d?l.current:m,l.current.map(s=>{var u,R,v,_,O;const r=t[s];return{authorId:s,first_name:(R=(u=r[0])==null?void 0:u.author)==null?void 0:R.first_name,last_name:(_=(v=r[0])==null?void 0:v.author)==null?void 0:_.last_name,profile_pic:(O=r[0])==null?void 0:O.authorProfilePic,slides:r}})};return f.useEffect(()=>{x(e);const n=g(e,".info/connected");return j(n,t=>{t.val()===!0&&!p?(D(),h(!1)):h(!0)}),()=>{T(e)}},[a]),{loading:o,groupedStories:E(b)}};export{C as a,F as u};
