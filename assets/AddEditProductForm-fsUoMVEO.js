import{G as _,j as e,ad as E,da as W,r as N,ba as R,bb as D,bc as K,bd as Y,_ as S,bD as Z,cA as H,b0 as L,ar as q,b1 as M,g as U,A as B,N as J,t as Q,i as X,b5 as ee,q as ae,b as se,u as te,a8 as le,aK as re,db as oe}from"./index-D-03quZq.js";import{a as $,u as ie,F as ne}from"./index.esm-BTxiklvI.js";import{d as ce}from"./index-BfzeEHqg.js";import{S as A}from"./react-select.esm-DQ_ugolG.js";import{S as de}from"./Select-49a62830.esm-C4jWKR7X.js";import{l as k}from"./lodash-CHr0VgFw.js";import{u as me}from"./useGetOptions-BVgAO5q6.js";function pe(i){return _({tag:"svg",attr:{version:"1.1",viewBox:"0 0 18 16"},child:[{tag:"path",attr:{d:"M17 2h-1v-1c0-0.55-0.45-1-1-1h-14c-0.55 0-1 0.45-1 1v12c0 0.55 0.45 1 1 1h1v1c0 0.55 0.45 1 1 1h14c0.55 0 1-0.45 1-1v-12c0-0.55-0.45-1-1-1zM2 3v10h-0.998c-0.001-0.001-0.001-0.001-0.002-0.002v-11.996c0.001-0.001 0.001-0.001 0.002-0.002h13.996c0.001 0.001 0.001 0.001 0.002 0.002v0.998h-12c-0.55 0-1 0.45-1 1v0zM17 14.998c-0.001 0.001-0.001 0.001-0.002 0.002h-13.996c-0.001-0.001-0.001-0.001-0.002-0.002v-11.996c0.001-0.001 0.001-0.001 0.002-0.002h13.996c0.001 0.001 0.001 0.001 0.002 0.002v11.996z"},child:[]},{tag:"path",attr:{d:"M15 5.5c0 0.828-0.672 1.5-1.5 1.5s-1.5-0.672-1.5-1.5 0.672-1.5 1.5-1.5 1.5 0.672 1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M16 14h-12v-2l3.5-6 4 5h1l3.5-3z"},child:[]}]})(i)}const F=({url:i,onRemove:n,onRetry:o,isFailed:r,isUploaded:t,loading:u})=>e.jsxs("div",{className:"relative bg-gray-300 size-24 flex-none overflow-hidden rounded-lg",children:[e.jsx("img",{src:i,alt:"preview",className:`${u&&"animate-pulse"} w-full h-full object-cover rounded-md`}),e.jsx("button",{type:"button",onClick:n,className:"absolute z-10 top-1 right-1 text-xl bg-white text-red-500 p-1 rounded-full",children:e.jsx(E,{})}),r&&e.jsx("button",{type:"button",onClick:o,className:"absolute bottom-1 right-1 bg-white text-gray-500 p-1 rounded-full",children:e.jsx(ce,{})}),t&&e.jsx("div",{className:"absolute inset-0 bg-primary-500/80 flex items-center justify-center text-white",children:e.jsx(W,{className:"text-7xl"})})]}),ge=({isEdit:i,isUploading:n,setUploading:o})=>{const{setValue:r,getValues:t,watch:u}=$(),[p,j]=N.useState([]),g=u("Images")||[];console.log(u("Images"));const v=s=>{var f,h;if(((f=u("Images"))==null?void 0:f.length)+s.length>=6||((h=u("Images"))==null?void 0:h.length)+p.length>=6){S.error("you can only add 5 images per product");return}let d=[];s.forEach((c,a)=>{Z(c,50,l=>{d.push({id:U(a),file:l})})}),j(c=>[...c,...d])},m=N.useCallback(async({file:s,id:d})=>{const f=t("Category"),h=t("Name"),c=R(D,`Products Images/${f}/${h}-${d}`);try{o(!0),await K(c,s);const a=await Y(c);r("Images",[...u("Images")||[],a]),j(l=>l.filter(x=>x.id!==d)),o(!1)}catch{o(!1)}},[t,g,r]),C=async()=>{for(const s of p)await m(s)},w=async(s,d,f)=>{try{if(s){const h=R(D,s);if(await H(h),f){const c=g.filter(a=>a!==s);r("Images",c)}}else j(h=>h.filter(c=>c.id!==d))}catch(h){if(h.code==="storage/object-not-found"){const c=g.filter(l=>l!==s),a=L(q,"Products",t().id);await M(a,{...t(),Images:c,Thumbnail:c[0]||""}),r("Images",c)}}};return N.useEffect(()=>{if(i&&g.length){const s=[...new Set(g)];(s.length!==g.length||!s.every((d,f)=>d===g[f]))&&r("Images",s)}},[g,i,r]),e.jsxs("div",{className:"lg:h-96 relative flex flex-col gap-3 lg:justify-between",children:[e.jsx("h4",{className:"text-xl font-bold",children:"Select Images:"}),e.jsxs("div",{className:"w-full relative h-60 lg:flex-1 flex flex-col items-center justify-center border-2 border-dotted border-primary-300 rounded-md gap-y-2",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/jpeg, image/webp, image/png, image/gif",className:"absolute inset-0 opacity-0 cursor-pointer",onChange:s=>{v([...s.target.files]),s.target.value=""}}),e.jsx(pe,{className:"text-4xl text-primary-400"}),e.jsx("h6",{className:"text-lg text-primary-400",children:"Add New Image"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Supports only ",e.jsx("span",{className:"font-semibold",children:"WEBP"})]})]}),e.jsxs("div",{className:"overflow-auto horizontal-scroll-bar w-full flex gap-x-4 py-2",children:[g.map((s,d)=>e.jsx(F,{url:s,onRemove:()=>w(s,null,!0),isUploaded:!0},d)),p.map(({id:s,file:d})=>e.jsx(F,{url:URL.createObjectURL(d),onRemove:()=>w(null,s,!1),onRetry:()=>m({id:s,file:d}),loading:n&&URL.createObjectURL(d)},s))]}),e.jsx("button",{type:"button",disabled:p.length===0||n,className:"px-4 py-2 bg-primary-500 text-white rounded disabled:bg-gray-400",onClick:C,children:n?"Uploading...":"Upload"})]})},O={Name:{required:"Please choose a name",minLength:{value:3,message:"Min length is 3 characters"},pattern:{value:/^[a-zA-Z0-9 ]+$/,message:"Name can only contain letters and numbers"}},Category:{required:"Select Cateogry"},Type:{required:"Choose Product Type"},Description:{required:"This field is reqired"},Price:{required:"This field is reqired",max:{value:1e3,message:"Max price is $1000"},min:{value:1,message:"Max price is $1"},pattern:{value:/^(?!0\d)(\d+(\.\d{1,2})?)$/,message:"Invalid number, please enter price in N.NN format"}}};function ue({isEdit:i}){var u,p,j,g,v,m,C,w,s,d,f,h,c,a;const{register:n,setValue:o,watch:r,formState:{errors:t}}=$();return e.jsxs("div",{className:"flex flex-col gap-y-2 mb-6 lg:basis-2/5",children:[e.jsxs("div",{className:"grid grid-rows-4 lg:grid-cols-2 lg:grid-rows-2 gap-2 lg:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Product Name :"}),e.jsx("input",{autoFocus:i,type:"text",...n("Name",{...O.Name}),className:"px-3 py-2 border border-gray-300 rounded-md w-full outline-none focus:border-primary-400/50 transition-all",placeholder:"Enter Your Product Title"}),e.jsx("p",{className:"text-red-500 px-1",children:(u=t==null?void 0:t.Name)==null?void 0:u.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Category :"}),e.jsx(A,{menuShouldScrollIntoView:!1,options:xe,...n("Category",{...O.Category}),onChange:({value:l})=>{o("Category",l),o("Type",void 0),o("Collection",void 0)},placeholder:(p=r())!=null&&p.Category?(j=r())==null?void 0:j.Category:"Add Category",isDisabled:i}),e.jsx("p",{className:"text-red-500 px-1",children:(g=t==null?void 0:t.Category)==null?void 0:g.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Product Type :"}),N.createElement(A,{menuShouldScrollIntoView:!1,...n("Type",{required:"Choose Product Type"}),onChange:({value:l})=>o("Type",l),options:V((v=r())==null?void 0:v.Category,"productTypes"),placeholder:(m=r())!=null&&m.Type?(C=r())==null?void 0:C.Type:"Select type",isDisabled:i,key:(w=r())==null?void 0:w.Category}),e.jsx("p",{className:"text-red-500 px-1",children:(s=t==null?void 0:t.Type)==null?void 0:s.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Collection :"}),N.createElement(A,{menuShouldScrollIntoView:!1,...n("Collection"),onChange:({value:l})=>o("Collection",l),options:V((d=r())==null?void 0:d.Category,"collections"),placeholder:i?(f=r())==null?void 0:f.Collection:"Add Collection",key:(h=r())==null?void 0:h.Category})]})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Tags :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:J.map(({title:l},x)=>{var b;return e.jsxs("button",{type:"button",onClick:()=>{var y;return o("Tags",Q((y=r())==null?void 0:y.Tags,l))},className:`${X((b=r())==null?void 0:b.Tags,l)?"bg-primary-500 text-gray-50 border-gray-50 [&>span]:inline":"border-primary-300 bg-gray-50 text-primary-500 [&>span]:hidden"} flex items-center gap-1 px-2 py-1 rounded-md border transition-all`,children:[e.jsx("p",{children:l}),e.jsx("span",{children:e.jsx(ee,{})})]},x)})})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Description :"}),e.jsx("textarea",{type:"text",rows:8,...n("Description",{...O.Description}),className:"px-3 py-2 border border-gray-300 rounded-md w-full outline-none focus:border-primary-400/50 transition-all resize-none",placeholder:"Write About Your Product"}),e.jsx("p",{className:"text-red-500 px-1",children:(c=t==null?void 0:t.Description)==null?void 0:c.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Price :"}),e.jsx("input",{type:"number",step:"0.01",rows:8,...n("Price",{...O.Price}),className:"px-3 py-2 border border-gray-300 rounded-md w-full outline-none focus:border-primary-400/50 transition-all resize-none",placeholder:"Add Product Price"}),e.jsx("p",{className:"text-red-500 px-1",children:(a=t==null?void 0:t.Price)==null?void 0:a.message})]})]})}const xe=B.map(({title:i})=>({label:i,value:i})),V=(i,n)=>{var o,r;return(r=(o=B.find(({title:t})=>t===i))==null?void 0:o[n])==null?void 0:r.filter(({used:t})=>!t).map(({title:t})=>({label:t,value:t}))};function he(){return e.jsxs("div",{className:"w-full h-80 animate-pulse",children:[e.jsx("h6",{className:"text-center text-3xl font-bold text-primary-300",children:"Load Options..."}),e.jsx("div",{className:"flex flex-col gap-y-4 my-4",children:ae(4).map((i,n)=>e.jsx(de,{isDisabled:!0},n))})]})}function fe({isEdit:i}){var f,h,c;const{setValue:n,getValues:o,watch:r}=$(),[t,u]=N.useState([]),{Type:p}=o(),{error:j,getSupportedOptions:g,loading:v,optionsList:m}=me(p),C=N.useRef();function w(a,l){if(a)return a.map(x=>l.toLowerCase()==="color"?{label:x.name,value:x.code}:{label:x,value:x})}N.useEffect(()=>{i||(u([]),n("Options",[]))},[(f=r())==null?void 0:f.Type,(h=r())==null?void 0:h.Category]);function s(a,l){const x={title:a,options:k.map(l,"value")},b=l.length?[...k.filter(t,y=>y.title!==a),x]:k.filter(t,y=>y.title!==a);u(b),n("Options",b)}function d(a){var b,y,P,T;const l=(b=m.filter(({title:I})=>(I==null?void 0:I.toLowerCase())==="color")[0])==null?void 0:b.options;return(T=(P=(y=r("Options"))==null?void 0:y.filter(({title:I})=>I===a)[0])==null?void 0:P.options)==null?void 0:T.map(I=>{var z;return{label:(a==null?void 0:a.toLowerCase())==="color"?(z=l.filter(({code:G})=>G===I)[0])==null?void 0:z.name:I,value:I}})}if(j&&!m.length)return e.jsxs("div",{className:"h-80 flex flex-col items-center justify-center gap-y-4",children:[e.jsx("h6",{className:"text-2xl font-bold",children:"Failed To Get Product Options..."}),e.jsx("button",{onClick:()=>g(),className:"px-4 py-2 rounded-md bg-primary-500 text-gray-50",children:"Try Again"})]});if(v)return e.jsx(he,{});if(!v&&(m!=null&&m.length))return e.jsxs("div",{children:[e.jsxs("div",{className:"text-center my-2",children:[e.jsx("h4",{className:"text-3xl font-bold",children:"Select Options"}),e.jsxs("p",{className:"leading-6 text-sm",children:["This user-friendly interface allows admins to quickly add new products or update existing ones with ease ✏️. Key fields like product name, price, description, and category are neatly organized 🛍️.",e.jsx("span",{className:"hidden lg:inline",children:"  Admins can upload product images 📸 and set stock availability directly from the modal. Validation ensures correct data entry ✅, while real-time previews offer clarity 👀. Whether launching a new item or tweaking details, the modal streamlines operations for a smooth e-commerce experience 💼."})]})]}),e.jsxs("div",{className:"",children:[e.jsx("h6",{className:"text-xl font-bold",children:"Options List :"}),e.jsx("div",{ref:C,className:"flex flex-col gap-y-4 my-2",children:m.map(({title:a,options:l,once:x},b)=>e.jsx("div",{className:"option",children:e.jsx(A,{onChange:y=>s(a,x?[y]:y),isMulti:!x,value:d(a),options:w(l,a),placeholder:`Choose ${a}`})},b))})]},(c=r())==null?void 0:c.Type)]})}function ye({isEdit:i,onModalChange:n,currentStep:o,setCurrentStep:r}){var g;const{watch:t}=$(),[u,p]=N.useState(!1),j=()=>o===1?n():r(v=>Math.max(v-1,1));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-h-96 lg:max-h-[55vh] overflow-y-auto overflow-x-hidden styled-scroll-bar scroll-smooth px-2 py-1.5 relative",children:[e.jsx("div",{className:`${o===1?"visible opacity-100 static translate-x-0":"invisible opacity-0 absolute -top-96 -translate-y-96 -translate-x-96"} transition-all duration-500`,children:e.jsx(ue,{isEdit:i})}),e.jsx("div",{className:`${o===2?"visible opacity-100 static translate-x-0":"invisible opacity-0 absolute -top-96 -translate-y-96 -translate-x-96"} transition-all duration-500`,children:e.jsx(fe,{isEdit:i,currentStep:o})}),e.jsx("div",{className:`${o===3?"visible opacity-100 static translate-x-0":"invisible opacity-0 absolute -top-96 -translate-y-96 -translate-x-96"} transition-all duration-500`,children:e.jsx(ge,{isEdit:i,isUploading:u,setUploading:p})})]}),e.jsxs("div",{className:"flex items-center justify-end my-2 gap-x-2",children:[e.jsx("button",{type:"button",disabled:i&&o===3||o===3&&!((g=t("Images"))!=null&&g.length),onClick:j,className:"px-4 py-2 lg:w-1/6 border-2 rounded-md border-gray-600 text-gray-900 hover:border-primary-800 hover:text-primary-800 transition-all disabled:opacity-50",children:o===1?"Close":"Back"}),e.jsx("button",{disabled:u,type:"submit",className:"px-4 py-2 disabled:cursor-not-allowed disabled:animate-pulse bg-primary-500 text-gray-50 rounded-md border-2 border-primary-500 hover:bg-gray-50 hover:text-primary-500 transition-all lg:w-1/5",children:o!==3?"Next":"Submit"})]})]})}const be=[{step:1,title:"General Info"},{step:2,title:"Options"},{step:3,title:"Images"}];function Te({onModalChange:i,isEdit:n,selectedProduct:o,getProducts:r}){const{userId:t,businessInformation:u,personalInformation:p}=se(a=>a.userData),[j,g]=N.useState(!1),v=ie({defaultValues:{Collection:"",Tags:[]}}),[m,C]=N.useState(1),{setValue:w,watch:s,handleSubmit:d}=v,f=te();le(),N.useEffect(()=>{n&&Object.entries(o).forEach(([a,l])=>{w(a,l)})},[n,o,w]);function h(){var P;const{Name:a,Type:l,Category:x,Price:b}=s(),y=s().Options;if(m===1&&(!(a!=null&&a.length)||!l||!x||!b)){S.error("Please complete the product information form");return}else if(m===2&&!y.length){S("Add at least one option");return}else if(m===3)if(((P=s())==null?void 0:P.Images.length)>0){c();return}else S.error("add one image at least");C(T=>Math.min(T+1,3))}async function c(a){var b;if(m!==3){h();return}const l=n?s().id:U(t),x={...s(),Images:k.uniq(s("Images")||[]),Thumbnail:((b=s())==null?void 0:b.Images[0])||"",SellerId:t,SellerName:(u==null?void 0:u.business_name)||(p==null?void 0:p.fisrt_name)||"",SellerEmail:(p==null?void 0:p.email)||"",SellerProfile:(p==null?void 0:p.profilePic)||"",createdByUser:!0,createdAt:oe()};try{g(!0),await M(L(q,"Products",l),x),n?(S.success("your changes sumbitted"),r(),i()):(S.success("Product Uploaded Succesfully !"),f(`/EcoVibe/Products/${l}`)),g(!1)}catch(y){g(!1),console.log(y)}}return e.jsxs(ne,{...v,children:[e.jsxs("form",{onSubmit:d(c),className:"px-4 bg-gray-50 relative py-2 lg:px-6 lg:py-4 flex flex-col lg:gap-4 w-[95vw] lg:w-[50vw] xl:w-[40vw] h-5/6 lg:h-auto mx-auto lg:border border-gray-200 lg:shadow hover:shadow-2xl transition-all duration-300 rounded-md",children:[e.jsx("div",{className:"flex items-center justify-evenly lg:justify-center lg:gap-x-6 my-4",children:be.map(({step:a,title:l},x)=>e.jsxs("div",{className:"flex flex-col items-center justify-center text-center gap-2 transition-all",children:[e.jsxs("p",{className:`${m===a?"bg-primary-500 text-gray-50":"border border-primary-500 text-primary-500 bg-gray-50"} size-14 rounded-full flex items-center justify-center text-2xl relative`,children:[a,a<3&&e.jsx("p",{className:`${a===m?"bg-primary-500":"bg-gray-300"} absolute -right-9 -z-10 w-10 h-1`})]}),e.jsx("span",{className:`${m===a?"text-primary-500 font-bold":"text-primary-400"} text-sm`,children:l})]},x))}),j&&e.jsxs("div",{className:"absolute inset-0 bg-gray-50 z-50 flex items-center gap-4 justify-center flex-col",children:[e.jsx(re,{className:"size-24"}),e.jsxs("h4",{className:"text-2xl font-bold text-center",children:[n?"Update product info, please dont refresh page":"Add new product, please dont refresh page","..."]})]}),e.jsx(ye,{isEdit:n,onModalChange:i,currentStep:m,setCurrentStep:C,onSubmitProduct:d(c)})]}),e.jsx("div",{onClick:()=>{var a;if(n)if(m!==3||!((a=s("Images"))!=null&&a.length))i();else{S.remove(),S.error("Plase submit your changes...");return}i()},className:"absolute inset-0 bg-gray-950/70 backdrop-blur cursor-pointer -z-10"})]})}export{Te as A};
