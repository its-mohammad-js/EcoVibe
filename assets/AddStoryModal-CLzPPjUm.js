import{r as y,b as C,j as e,bF as S,bG as U,al as P,aP as R,_ as u,bd as _,be as A,g as p,bf as L,bg as k}from"./index-DNYibs0x.js";import{g as b,q as T,r as m,d as $,e as F,i as q,f as z,s as D}from"./index.esm2017-CBSparzd.js";import{C as B}from"./ContentSwitcher-Dpzl3SF4.js";function Y({onModalChange:i}){const[a,o]=y.useState(null),[{error:E,loading:l},c]=y.useState({loading:!1,error:null}),{userId:n,businessInformation:d,personalInformation:r}=C(t=>t.userData);async function h(){try{c({loading:!0,isUploaded:!1,error:null});const t=b(),s=T(m(t,"stories"),$("authorId"),F(n));if(await q(s).then(N=>{var x;return(x=Object.values(N.val()||{}))==null?void 0:x.length})>=8){u.error("You can upload a maximum of 8 slides every 10 hours. 📊⏳"),i(null);return}const j=_(A,`Story Images/${p()}`),w=await L(j,a),v=await k(w.ref);await f(v),c({loading:!1,error:null}),i(null)}catch(t){u.error("there was an error on add story, please try again later"),console.log(t),c({loading:!1,isUploaded:!1,error:t})}}async function f(t){try{let s=p(n).replace(".","&");const g=b();await z(m(g,`stories/${s}`),{contentUrl:t,id:s,author:{first_name:(d==null?void 0:d.businessName)||(r==null?void 0:r.first_name)||(r==null?void 0:r.email),last_name:(d==null?void 0:d.career_title)||(r==null?void 0:r.last_name)},createdAt:D(),authorId:n,type:a==null?void 0:a.type,authorProfilePic:r.profilePic}),o(null),u.success("story created successfully")}catch(s){console.log(s)}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 z-20 bg-gray-50 py-2 lg:px-6 lg:py-4 w-[95vw] lg:w-[50vw] xl:w-[40vw] h-5/6 lg:h-[80vh] mx-auto lg:border border-gray-200 lg:shadow hover:shadow-2xl transition-all duration-300 rounded-md flex flex-col",children:[e.jsx("h4",{className:"text-2xl font-bold mb-2",children:"Add New Story"}),a?e.jsxs("div",{className:"w-full h-5/6 relative flex flex-col items-center justify-center gap-y-4 py-3",children:[e.jsx("button",{disabled:l,onClick:()=>o(null),className:"absolute disabled:hidden z-50 -top-3 -right-3 p-2 text-red-500 bg-gray-50 text-2xl rounded-full border border-gray-200",children:e.jsx(P,{})}),e.jsx(B,{loading:l,contentType:a==null?void 0:a.type,contentUrl:URL.createObjectURL(a),controls:!0}),e.jsxs("div",{className:`${l?"opacity-100 visible":"opacity-0 invisible"} absolute w-full h-[95%] rounded-md gap-y-6 px-4 bg-gray-800/80 transition-all backdrop-blur flex flex-col items-center justify-center`,children:[e.jsx(R,{}),e.jsx("h4",{className:"text-gray-50 text-center text-xl font-bold bg-gray-950/50 px-4 py-1 rounded-md",children:"Please do not refresh the page while adding story."})]})]}):e.jsxs("div",{className:"w-full h-full relative flex flex-col items-center justify-center gap-y-4",children:[e.jsx("input",{className:"opacity-0 absolute inset-0 z-50 bg-red-300",accept:"image/jpeg, image/webp, image/png, image/gif, video/mp4, video/webm, video/ogg",type:"file",onChange:t=>{S(t.target.files[0],20,s=>o(s)),t.target.value=""}}),e.jsx(U,{className:"text-7xl text-primary-500"}),e.jsx("h6",{className:"text-xl font-bold",children:"Add media"})]}),e.jsxs("div",{className:"w-full h-1/6 flex items-center justify-end gap-2",children:[e.jsx("button",{disabled:l,onClick:()=>{o(null),i(null)},className:"px-4 py-2 disabled:hidden bg-gray-50 rounded-md text-primary-500 border-2 border-primary-500",children:"Cancel"}),e.jsx("button",{disabled:!a||l,onClick:h,className:"px-4 py-2 bg-primary-500 rounded-md text-gray-50 border-2 border-primary-500 disabled:opacity-50",children:"Upload"})]})]}),e.jsx("div",{className:`${l?"block":"hidden"} fixed inset-0`})]})}export{Y as A};
