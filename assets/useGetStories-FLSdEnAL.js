import{g as S,r as g,h as x,u as B,a as H,b as j,c as T,q as $,e as w,d as A}from"./index.esm2017-Yx6hiY6Y.js";import{r as f,bh as G,bi as k,cH as Q,_ as m,b as U}from"./index-tYsTgsKc.js";import{l as D}from"./lodash-BMaq9prM.js";function F(c){const[d,o]=f.useState(!1);return{loading:d,onDeleteSlide:async(i,e=()=>{})=>{try{const a=S();o(!0);const p=G(k,i.contentUrl);await Q(p);const l=g(a,`stories/${i.id}`);x(l),o(!1),e()}catch(a){m.error("There was an error on delete story, please try again later"),o(!1),e(),console.log(a)}},onRemoveHighlight:async i=>{try{o(!0),c(!1);const e=S(),a=g(e,`stories/${i.id}`);B(a,{highlightRef:null,title:null}),m.success("highlight removed successfully"),o(!1),c(!0)}catch(e){m.error("There was an error on remove highlight, please try again later"),o(!1),c(!1),console.log(e)}}}}const I=(c,d)=>{const[o,h]=f.useState(!1),[b,i]=f.useState([]),e=S(),{userId:a,loading:p}=U(n=>n.userData),l=f.useRef(),E=()=>{const n=g(e,"stories"),t=c?$(n,A("authorId"),w(c)):n;j(t,y=>{const r=Object.values(y.val()||{});i(r)})},L=n=>{const t=D.groupBy(n,"authorId");Object.keys(t).forEach(r=>{t[r]=t[r].map(s=>{var u;return{...s,isSeen:(u=s.seenBy)==null?void 0:u.includes(a)}})});const y=D.sortBy(Object.keys(t),r=>t[r].every(s=>s.isSeen));return l.current=d?l.current:y,l.current.map(r=>{var u,v,R,_,O;const s=t[r];return{authorId:r,first_name:(v=(u=s[0])==null?void 0:u.author)==null?void 0:v.first_name,last_name:(_=(R=s[0])==null?void 0:R.author)==null?void 0:_.last_name,profile_pic:(O=s[0])==null?void 0:O.authorProfilePic,slides:s,isSeen:s.every(({isSeen:q})=>q)}})};return f.useEffect(()=>{H(e);const n=g(e,".info/connected");return j(n,t=>{t.val()===!0&&!p?(E(),h(!1)):h(!0)}),()=>{T(e)}},[a]),{loading:o,groupedStories:L(b)}};export{F as a,I as u};
