import{bB as O,bC as B,bD as H,bE as _,r as u,b as R,j as e,aQ as E,bF as F,m as M,K as T,bG as U,bH as X,bI as K,bJ as V,_ as S,bK as q,bL as G,as as Q,aE as W,t as J,aN as P,aS as D,l as I,ad as Y,ae as Z}from"./index-BOiJ9usr.js";import{g as w,r as C,u as k,d as L}from"./index.esm2017-BFQEDu2-.js";import{a as ee}from"./index-wfR4NZ4H.js";import{b as te}from"./index-CubkihYL.js";import{a as se}from"./useGetStories-fTkUpvxN.js";function le(t){t.values.forEach(n=>n.stop())}function ae(){const t=new Set,n={subscribe(l){return t.add(l),()=>void t.delete(l)},start(l,a){const r=[];return t.forEach(c=>{r.push(O(c,l,{transitionOverride:a}))}),Promise.all(r)},set(l){return t.forEach(a=>{B(a,l)})},stop(){t.forEach(l=>{le(l)})},mount(){return()=>{n.stop()}}};return n}function ne(){const t=H(ae);return _(t.mount,[]),t}const ie=ne;function re(t,n){const[l,a]=u.useState(t),[r,c]=u.useState(!0),i=u.useRef(),f=u.useRef();return u.useEffect(()=>{if(!r)return f.current=Date.now(),i.current=setTimeout(()=>{n()},l),()=>clearTimeout(i.current)},[l,r,n]),{remainingTime:l,pause:r,handlePause:o=>{c(h=>o||!h)},setRemainingTime:a,setPause:c}}function ce({setRemainingTime:t,loading:n,changeStoryHandler:l,pause:a,handlePause:r,contextMenuShow:c}){var m;const{story:i,slideindex:f,currentSlideIndex:b}=y(),o=u.useRef(),[h,x]=u.useState(!1),{auth_status:p,userId:j}=R(d=>d.userData);function N(){var z;x(!0),r();const d=w(),s=C(d,`stories/${i.id}`),g=p===401?F():j,v=(z=i==null?void 0:i.seenBy)==null?void 0:z.filter($=>$!==g);k(s,{seenBy:[...v||[],g]})}return u.useEffect(()=>{o.current&&(a?o.current.pause():o.current.play())},[a]),e.jsxs("div",{className:"size-full relative z-40 overflow-hidden flex items-center justify-center p-6",children:[!h&&e.jsx(E,{className:"size-20 lg:size-36 absolute"}),(m=i.type)!=null&&m.startsWith("image/")?e.jsx("img",{src:i.contentUrl,alt:"story-content",className:"size-full object-contain",onLoad:()=>N()}):e.jsx("video",{ref:o,onLoadedData:()=>N(),onPlaying:d=>{const s=Math.max(0,(d.target.duration-d.target.currentTime)*1e3);t(s)},autoPlay:b===f,className:"size-full object-cover",src:i.contentUrl}),n&&e.jsxs("div",{className:"absolute z-50 inset-0 flex flex-col text-gray-200 gap-y-4 font-medium bg-gray-900/80 rounded-xl items-center justify-center",children:[e.jsx(E,{className:"size-24"}),e.jsx("p",{children:"Deleting story, please dont refresh page"})]}),e.jsxs("div",{onTouchStart:()=>r(!0),onTouchEnd:()=>r(!1),className:"absolute z-40 inset-0 flex lg:hidden",children:[e.jsx("div",{onClick:()=>!c&&!n&&l("prev"),className:"h-full w-2/5"}),e.jsx("div",{onClick:()=>!c&&!n&&l("next"),className:"h-full w-3/5"})]})]})}function oe({remainingTime:t,pause:n}){const l=ie(),{list:a,currentSlideIndex:r}=y();return u.useEffect(()=>{n?l.stop():l.start({translateX:"0%",transition:{duration:t/1e3,ease:"linear"}})},[n,t]),e.jsx("div",{className:"flex gap-2 p-2",children:a.map((c,i)=>e.jsx("p",{className:`${i===r?"bg-gray-50":"bg-gray-400"} w-full h-1 rounded-xl overflow-hidden relative`,children:i===r&&e.jsx(M.div,{className:"bg-primary-300 h-1 absolute left-0 top-0 w-full",initial:{translateX:"-100%"},animate:l,transition:{duration:t/1e3,ease:"linear"}})},i))})}function de({pause:t,handlePause:n,onDeleteSlide:l,loading:a,contextMenuShow:r,setContextMenu:c}){const{changeStoryHandler:i,story:f}=y(),b=u.useRef();T(b,h,!r);const{userId:o}=R(j=>j.userData);function h(){n(),c(!1)}async function x(){try{n(!0),await l(f,()=>i("close")),S.success("story removed successfully"),n(!1)}catch(j){S.remove(),S.error("There was an error on delete story, please try again later"),n(!1),console.log(j)}}async function p(){}return e.jsxs("div",{ref:b,className:"flex items-center gap-x-2 relative",children:[e.jsx("button",{onClick:()=>n(),className:"text-gray-50",children:t?e.jsx(U,{className:"text-xl"}):e.jsx(ee,{className:"text-2xl"})}),e.jsx("button",{onClick:()=>{n(!0),c(!0)},className:"text-3xl text-gray-50",children:e.jsx(X,{className:"rotate-90"})}),e.jsxs("div",{className:`${r?"opacity-100 visible":"opacity-0 invisible"} ${a&&"hidden"} text-base flex top-8 p-1 flex-col bg-gray-50 text-gray-950 absolute right-0 rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>{p(),c(!1)},disabled:!(f!=null&&f.highlightRef)||f.authorId!==o,className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(te,{className:"text-xl"}),e.jsx("p",{children:"Remove highlight"})]}),e.jsxs("button",{disabled:f.authorId!==o,onClick:()=>{x(),c(!1)},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx("p",{children:e.jsx(K,{})}),e.jsx("p",{children:"Delete story"})]}),e.jsxs("button",{onClick:()=>{i("close")},className:"flex disabled:hidden hover:bg-gray-800 rounded-md hover:text-gray-50 transition-all text-red-500 items-center gap-x-2 text-center text-nowrap px-4 py-2",children:[e.jsx(V,{className:"rotate-45 text-xl"}),e.jsx("p",{children:"Close"})]})]})]})}function ue({story:t,handlePause:n}){var N,m,d;const{userId:l,personalInformation:a,auth_status:r}=R(s=>s.userData),[c,i]=u.useState(!1),[f,b]=u.useState(null),o=u.useRef();T(o,()=>{b(!1)});const[h,x]=u.useState("");u.useEffect(()=>{f||n()},[f]),u.useEffect(()=>{var s;i((s=t==null?void 0:t.likes)==null?void 0:s.includes(l))},[t]);function p(){const s=w(),g=C(s,`stories/${t.id}`);k(g,{likes:J(t==null?void 0:t.likes,l)})}function j(){const s=w(),g=C(s,`stories/${t.id}`);k(g,{comments:[...(t==null?void 0:t.comments)||[],{createdAt:L(),authorId:l,content:h,authorProfile:a==null?void 0:a.profilePic,authorName:(a==null?void 0:a.first_name)+" "+(a==null?void 0:a.last_name)}]}),x("")}return e.jsx(e.Fragment,{children:e.jsxs("div",{ref:o,className:"absolute w-full bottom-0 left-0 h-5 flex items-center justify-end pb-8 gap-x-2 z-50 p-2",children:[e.jsx("input",{disabled:r!==200,onClick:()=>{n(!0),b(!0)},value:"",type:"text",className:"bg-transparent disabled:hidden outline-none border flex-1 px-2 py-2 border-gray-400 text-gray-300 rounded-2xl",placeholder:"comment something"}),e.jsxs("button",{onClick:p,className:"text-gray-400 text-4xl",children:[c?e.jsx(q,{className:"text-red-500"}):e.jsx(G,{className:"text-gray-400"}),e.jsx("p",{className:"text-lg",children:((N=t==null?void 0:t.likes)==null?void 0:N.length)||0})]}),e.jsxs("div",{className:`${f?"opacity-100 visible translate-y-0":"opacity-0 invisible translate-y-10"} absolute bottom-0 grid grid-rows-8 transition-all rounded-t-3xl px-2 pb-1 pt-3 overflow-hidden h-[25rem] w-full left-0 bg-gray-900/85 backdrop-blur-xl`,children:[e.jsx("div",{className:"w-full row-span-7 overflow-auto styled-scroll-bar flex flex-col gap-y-4",children:(m=t==null?void 0:t.comments)!=null&&m.length?(d=t==null?void 0:t.comments)==null?void 0:d.map((s,g)=>e.jsxs("div",{className:"w-full flex items-start",children:[e.jsx("div",{className:"size-14 rounded-full overflow-hidden flex items-center justify-center",children:s!=null&&s.authorProfile?e.jsx("img",{className:"mt-1",src:s==null?void 0:s.authorProfile}):e.jsx(Q,{className:"text-4xl text-gray-400"})}),e.jsxs("div",{className:"flex-col p-1 w-11/12",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-300 line-clamp-1",children:s.authorName}),e.jsx("p",{className:"text-gray-400 text-sm line-clamp-6",children:s.content})]})]},g)):e.jsx("h2",{className:"my-auto w-full text-center text-gray-300",children:"no comments yet..."})}),e.jsxs("div",{className:"flex items-center border border-gray-400 rounded-2xl pl-1 pr-2",children:[e.jsx("input",{onKeyDown:s=>{s.key==="Enter"&&h.length>0&&(s.preventDefault(),j())},type:"text",onChange:({target:s})=>x(s.value),value:h,className:"bg-transparent w-full outline-none border-transparent flex-1 px-2 py-2 text-gray-300",placeholder:"comment something"}),e.jsx("button",{onClick:()=>j(),disabled:h.length<=0,className:"text-gray-300 disabled:opacity-0 transition-all text-3xl opacity-80 hover:opacity-100",children:e.jsx(W,{})})]})]})]})})}function xe(){const{changeStoryHandler:t,listIndex:n,currentListIndex:l,story:a}=y(),{remainingTime:r,pause:c,handlePause:i,setRemainingTime:f}=re(5e3,()=>t("next")),[b,o]=u.useState(!1),{onDeleteSlide:h,loading:x,onRemoveHighlight:p}=se(i);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"size-full relative z-50 bg-gray-950 lg:rounded-xl flex items-center",children:[e.jsx("div",{className:"z-50 absolute -left-4 h-1/2 hidden xl:flex items-center",children:e.jsx("button",{disabled:x,onClick:()=>t("prev"),className:"text-2xl disabled:hidden rounded-full p-1.5 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2 rotate-180",children:e.jsx(P,{})})}),e.jsxs("div",{className:`${n===l?"block":"hidden"} absolute z-50 top-0 w-full p-1`,children:[e.jsx(oe,{pause:c,remainingTime:r}),e.jsxs("div",{className:"w-full flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-10 bg-gray-50/20 rounded-full overflow-hidden flex items-center justify-center",children:a!=null&&a.authorProfilePic?e.jsx("img",{src:a==null?void 0:a.authorProfilePic,className:"object-cover"}):e.jsx(D,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h6",{className:"text-gray-50 text-lg",children:a.author.first_name})]}),e.jsx(de,{pause:c,onRemoveHighlight:p,handlePause:i,onDeleteSlide:h,loading:x,contextMenuShow:b,setContextMenu:o})]})]}),e.jsx(ce,{setRemainingTime:f,loading:x,changeStoryHandler:t,handlePause:i,pause:c,contextMenuShow:b}),e.jsx(ue,{story:a,handlePause:i}),e.jsx("div",{className:`${n!==l&&"!hidden"} absolute -right-4 h-1/2 hidden xl:flex items-center`,children:e.jsx("button",{disabled:x,onClick:()=>t("next"),className:"text-2xl disabled:hidden disabled:bg-gray-500 disabled:opacity-50 rounded-full p-1.5 z-40 hover:bg-opacity-100 bg-gray-50 bg-opacity-50 transition-all top-1/2",children:e.jsx(P,{})})})]}),x&&e.jsx("div",{className:"fixed inset-0 z-40"})]})}const fe=(t,n,l)=>{const[a,r]=u.useState(0),c=u.useRef(),i=I({maxWidth:768}),[f,b]=u.useState(null),[o,h]=u.useState(!1);Y(780,!1);const x=Z();return u.useEffect(()=>{var d,s;const m=(s=(d=l[t])==null?void 0:d.slides)==null?void 0:s.findIndex(({isSeen:g})=>!g);r(m>=0?m:0)},[t]),u.useEffect(()=>{const m=document.querySelector(".currentSlide"),d=new IntersectionObserver(([s])=>{if(!s.isIntersecting&&f!==null){const g=f==="next"?t<l.length-1?t+1:null:t-1;h(!0),n(g),r(0),b(null)}},{threshold:.05});return m&&d.observe(m),()=>d.disconnect()},[f,t]),u.useEffect(()=>{if(o){const m=setTimeout(()=>h(!1),500);return()=>clearTimeout(m)}},[o]),u.useEffect(()=>{(()=>{if(!c.current)return;const d=document.querySelector(".currentSlide");if(!d)return;const s=d.getBoundingClientRect(),g=c.current.getBoundingClientRect(),v=s.left+s.width/2-(g.left+g.width/2);c.current.scrollLeft+=v})()},[t,i,o]),{containerRef:c,isChangingSlide:o,changeStory:m=>{const d=l[t],s=m==="next";if(m==="close"){n(null),r(0);return}else{let g=a+(s?1:-1);const v=t+(s?1:-1);(g<0||g>=d.slides.length)&&(n(v>=0&&v<l.length?v:null),g=0),r(g)}},handleTouch:(m,d)=>{if(d==="start")b(null),c.current.dataset.touchStart=m.touches[0].clientX;else if(d==="move"){const s=m.touches[0].clientX-c.current.dataset.touchStart;b(s>20?"prev":"next")}},getPaginatedLists:()=>x!=null&&x.id?l:l.filter((m,d)=>d===t-1||d===t||d===t+1),currentSlideIndex:a}},A=u.createContext();function je({currentListIndex:t,setList:n,storiesList:l}){const{containerRef:a,isChangingSlide:r,changeStory:c,handleTouch:i,getPaginatedLists:f,currentSlideIndex:b}=fe(t,n,l);return e.jsx("div",{ref:a,className:`${r?"overflow-hidden":"overflow-auto"} fixed bg-gray-950/80 hidden-scroll-bar inset-0 z-50 lg:flex items-center justify-center snap-x snap-mandatory lg:snap-none`,children:e.jsxs("div",{onTouchMove:o=>i(o,"move"),onTouchStart:o=>i(o,"start"),className:"inline-flex items-center lg:gap-x-8 size-full lg:px-[500vw]",children:[f().map(({slides:o},h)=>{if(o)return e.jsx("div",{className:`${h===t?"lg:h-[95vh] currentSlide":"lg:h-[80vh]"} flex-none h-full select-none w-full lg:relative lg:w-96 transition-all duration-500 z-40 snap-end`,children:o.map((x,p)=>{var j;return t===h?b===p&&e.jsx(A.Provider,{value:{changeStoryHandler:c,listIndex:h,currentListIndex:t,list:o,currentSlideIndex:b,slideindex:p,story:x},children:e.jsx(xe,{},p)}):e.jsx("div",{className:"size-full first-of-type:flex hidden relative bg-gray-950 lg:rounded-xl items-center",children:e.jsxs("div",{onClick:()=>n(h),className:"size-full select-none flex flex-col gap-y-2 items-center justify-center",children:[e.jsx("div",{className:"size-28 bg-gray-50/20 overflow-hidden rounded-full",children:x!=null&&x.authorProfilePic?e.jsx("img",{src:x==null?void 0:x.authorProfilePic,className:"object-cover"}):e.jsx(D,{className:"text-4xl mt-2 text-gray-50"})}),e.jsx("h4",{className:"text-gray-50",children:(j=x.author)==null?void 0:j.first_name})]})},p)})},h)}),e.jsx("div",{className:`${r?"opacity-100 visible":"invisible opacity-0"} fixed inset-0 z-50 transition-all`}),e.jsx("div",{onClick:()=>n(null),id:"list-background",className:"fixed inset-0 bg-gray-950/80 hidden lg:block"})]})})}const y=()=>u.useContext(A);export{je as S};
