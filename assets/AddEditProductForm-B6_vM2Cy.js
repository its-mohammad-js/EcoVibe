import{aG as G,j as e,an as W,dh as _,r as j,bh as R,bi as F,bj as J,bk as Y,cH as H,aj as U,W as $,ai as L,aa as B,y as E,a1 as K,t as Q,i as X,ba as Z,p as ee,V as te,X as se,_ as S,b as ae,u as le,ad as re,aQ as oe,di as ie}from"./index-tYsTgsKc.js";import{a as z,u as ne,F as ce}from"./index.esm-BmOLQ3rQ.js";import{c as de}from"./index-K41frHL7.js";import{S as k,a as me}from"./react-select.esm-D6_Zdj6F.js";import{l as A}from"./lodash-BMaq9prM.js";function pe(o){return G({tag:"svg",attr:{version:"1.1",viewBox:"0 0 18 16"},child:[{tag:"path",attr:{d:"M17 2h-1v-1c0-0.55-0.45-1-1-1h-14c-0.55 0-1 0.45-1 1v12c0 0.55 0.45 1 1 1h1v1c0 0.55 0.45 1 1 1h14c0.55 0 1-0.45 1-1v-12c0-0.55-0.45-1-1-1zM2 3v10h-0.998c-0.001-0.001-0.001-0.001-0.002-0.002v-11.996c0.001-0.001 0.001-0.001 0.002-0.002h13.996c0.001 0.001 0.001 0.001 0.002 0.002v0.998h-12c-0.55 0-1 0.45-1 1v0zM17 14.998c-0.001 0.001-0.001 0.001-0.002 0.002h-13.996c-0.001-0.001-0.001-0.001-0.002-0.002v-11.996c0.001-0.001 0.001-0.001 0.002-0.002h13.996c0.001 0.001 0.001 0.001 0.002 0.002v11.996z"},child:[]},{tag:"path",attr:{d:"M15 5.5c0 0.828-0.672 1.5-1.5 1.5s-1.5-0.672-1.5-1.5 0.672-1.5 1.5-1.5 1.5 0.672 1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M16 14h-12v-2l3.5-6 4 5h1l3.5-3z"},child:[]}]})(o)}const q=({url:o,onRemove:r,onRetry:l,isFailed:n,isUploaded:a})=>e.jsxs("div",{className:"relative size-24 flex-none overflow-hidden rounded-lg",children:[e.jsx("img",{src:o,alt:"preview",className:"w-full h-full object-cover rounded-md"}),e.jsx("button",{type:"button",onClick:r,className:"absolute z-10 top-1 right-1 text-xl bg-white text-red-500 p-1 rounded-full",children:e.jsx(W,{})}),n&&e.jsx("button",{type:"button",onClick:l,className:"absolute bottom-1 right-1 bg-white text-gray-500 p-1 rounded-full",children:e.jsx(de,{})}),a&&e.jsx("div",{className:"absolute inset-0 bg-primary-500/80 flex items-center justify-center text-white",children:e.jsx(_,{className:"text-7xl"})})]}),ue=({isEdit:o})=>{const{setValue:r,getValues:l,watch:n}=z(),[a,b]=j.useState([]),[d,w]=j.useState({uploading:!1,failedImages:[]}),x=n("Images")||[],N=s=>{const m=s.map((h,f)=>({id:B(f),file:h}));b(h=>[...h,...m])},u=j.useCallback(async({file:s,id:m})=>{const h=l("Category"),f=l("Name"),g=R(F,`Products Images/${h}/${f}-${m}`);try{w(t=>({...t,uploading:!0})),await J(g,s);const c=await Y(g);r("Images",[...x,c]),b(t=>t.filter(i=>i.id!==m)),w(t=>({...t,uploading:!1}))}catch{w(t=>({...t,uploading:!1,failedImages:[...t.failedImages,m]}))}},[l,x,r]),O=async()=>{for(const s of a)await u(s)},C=async(s,m,h)=>{try{if(s){const f=R(F,s);if(await H(f),h){const g=x.filter(c=>c!==s);r("Images",g)}}else b(f=>f.filter(g=>g.id!==m))}catch(f){if(f.code==="storage/object-not-found"){const g=x.filter(t=>t!==s),c=U($,"Products",l().id);await L(c,{...l(),Images:g,Thumbnail:g[0]||""}),r("Images",g)}}};return j.useEffect(()=>{if(o&&x.length){const s=[...new Set(x)];(s.length!==x.length||!s.every((m,h)=>m===x[h]))&&r("Images",s)}},[x,o,r]),e.jsxs("div",{className:"lg:h-96 relative flex flex-col gap-3 lg:justify-between",children:[e.jsx("h4",{className:"text-xl font-bold",children:"Select Images:"}),e.jsxs("div",{className:"w-full relative h-60 lg:flex-1 flex flex-col items-center justify-center border-2 border-dotted border-primary-300 rounded-md gap-y-2",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/webp",className:"absolute inset-0 opacity-0 cursor-pointer",onChange:s=>N([...s.target.files])}),e.jsx(pe,{className:"text-4xl text-primary-400"}),e.jsx("h6",{className:"text-lg text-primary-400",children:"Add New Image"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Supports only ",e.jsx("span",{className:"font-semibold",children:"WEBP"})]})]}),e.jsxs("div",{className:"overflow-auto horizontal-scroll-bar w-full flex gap-x-4 py-2",children:[x.map((s,m)=>e.jsx(q,{url:s,onRemove:()=>C(s,null,!0),isUploaded:!0},m)),a.map(({id:s,file:m})=>e.jsx(q,{url:URL.createObjectURL(m),onRemove:()=>C(null,s,!1),onRetry:()=>u({id:s,file:m}),isFailed:d.failedImages.includes(s)},s))]}),e.jsx("button",{type:"button",disabled:a.length===0||d.uploading,className:"px-4 py-2 bg-primary-500 text-white rounded disabled:bg-gray-400",onClick:O,children:d.uploading?"Uploading...":"Upload"})]})},T={Name:{required:"Please choose a name",minLength:{value:3,message:"Min length is 3 characters"},pattern:{value:/^[a-zA-Z0-9 ]+$/,message:"Name can only contain letters and numbers"}},Category:{required:"Select Cateogry"},Type:{required:"Choose Product Type"},Description:{required:"This field is reqired"},Price:{required:"This field is reqired",max:{value:1e3,message:"Max price is $1000"},min:{value:1,message:"Max price is $1"},pattern:{value:/^(?!0\d)(\d+(\.\d{1,2})?)$/,message:"Invalid number, please enter price in N.NN format"}}};function ge({isEdit:o}){var b,d,w,x,N,u,O,C,s,m,h,f,g,c;const{register:r,setValue:l,watch:n,formState:{errors:a}}=z();return e.jsxs("div",{className:"flex flex-col gap-y-2 mb-6 lg:basis-2/5",children:[e.jsxs("div",{className:"grid grid-rows-4 lg:grid-cols-2 lg:grid-rows-2 gap-2 lg:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Product Name :"}),e.jsx("input",{autoFocus:o,type:"text",...r("Name",{...T.Name}),className:"px-3 py-2 border border-gray-300 rounded-md w-full outline-none focus:border-primary-400/50 transition-all",placeholder:"Enter Your Product Title"}),e.jsx("p",{className:"text-red-500 px-1",children:(b=a==null?void 0:a.Name)==null?void 0:b.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Category :"}),e.jsx(k,{menuShouldScrollIntoView:!1,options:xe,...r("Category",{...T.Category}),onChange:({value:t})=>{l("Category",t),l("Type",void 0),l("Collection",void 0)},placeholder:(d=n())!=null&&d.Category?(w=n())==null?void 0:w.Category:"Add Category",isDisabled:o}),e.jsx("p",{className:"text-red-500 px-1",children:(x=a==null?void 0:a.Category)==null?void 0:x.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Product Type :"}),j.createElement(k,{menuShouldScrollIntoView:!1,...r("Type",{required:"Choose Product Type"}),onChange:({value:t})=>l("Type",t),options:M((N=n())==null?void 0:N.Category,"productTypes"),placeholder:(u=n())!=null&&u.Type?(O=n())==null?void 0:O.Type:"Select type",isDisabled:o,key:(C=n())==null?void 0:C.Category}),e.jsx("p",{className:"text-red-500 px-1",children:(s=a==null?void 0:a.Type)==null?void 0:s.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Collection :"}),j.createElement(k,{menuShouldScrollIntoView:!1,...r("Collection"),onChange:({value:t})=>l("Collection",t),options:M((m=n())==null?void 0:m.Category,"collections"),placeholder:o?(h=n())==null?void 0:h.Collection:"Add Collection",key:(f=n())==null?void 0:f.Category})]})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Tags :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:K.map(({title:t},i)=>{var p;return e.jsxs("button",{type:"button",onClick:()=>{var y;return l("Tags",Q((y=n())==null?void 0:y.Tags,t))},className:`${X((p=n())==null?void 0:p.Tags,t)?"bg-primary-500 text-gray-50 border-gray-50 [&>span]:inline":"border-primary-300 bg-gray-50 text-primary-500 [&>span]:hidden"} flex items-center gap-1 px-2 py-1 rounded-md border transition-all`,children:[e.jsx("p",{children:t}),e.jsx("span",{children:e.jsx(Z,{})})]},i)})})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Description :"}),e.jsx("textarea",{type:"text",rows:8,...r("Description",{...T.Description}),className:"px-3 py-2 border border-gray-300 rounded-md w-full outline-none focus:border-primary-400/50 transition-all resize-none",placeholder:"Write About Your Product"}),e.jsx("p",{className:"text-red-500 px-1",children:(g=a==null?void 0:a.Description)==null?void 0:g.message})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("h6",{className:"font-semibold lg:text-lg",children:"Price :"}),e.jsx("input",{type:"number",step:"0.01",rows:8,...r("Price",{...T.Price}),className:"px-3 py-2 border border-gray-300 rounded-md w-full outline-none focus:border-primary-400/50 transition-all resize-none",placeholder:"Add Product Price"}),e.jsx("p",{className:"text-red-500 px-1",children:(c=a==null?void 0:a.Price)==null?void 0:c.message})]})]})}const xe=E.map(({title:o})=>({label:o,value:o})),M=(o,r)=>{var l,n;return(n=(l=E.find(({title:a})=>a===o))==null?void 0:l[r])==null?void 0:n.filter(({used:a})=>!a).map(({title:a})=>({label:a,value:a}))};function he(){return e.jsxs("div",{className:"w-full h-80 animate-pulse",children:[e.jsx("h6",{className:"text-center text-3xl font-bold text-primary-300",children:"Load Options..."}),e.jsx("div",{className:"flex flex-col gap-y-4 my-4",children:ee(4).map((o,r)=>e.jsx(me,{isDisabled:!0},r))})]})}function fe({isEdit:o}){var m,h,f,g,c;const{setValue:r,getValues:l,watch:n}=z(),[a,b]=j.useState([]),[{optionsList:d,loading:w,error:x},N]=j.useState({loading:!1,optionsList:[],error:null}),{Type:u}=l(),O=j.useRef();j.useEffect(()=>{o||(b([]),r("Options",[]))},[(m=n())==null?void 0:m.Type,(h=n())==null?void 0:h.Category]),j.useEffect(()=>{r("Options",a)},[a]);async function C(){var t;try{N(v=>({...v,loading:!0}));const i=te($,"ProductsOptions"),p=(t=await se(i))==null?void 0:t.docs.map(v=>v.data());localStorage.setItem("productsOptions",JSON.stringify(p));const y=p[0].OptionData.find(v=>v.productType===u).productOptions;N({optionsList:y||[],loading:!1,error:null})}catch(i){S.error(i==null?void 0:i.message),N(p=>({...p,error:i==null?void 0:i.message,loading:!1}))}}j.useEffect(()=>{var i;if(!u)return;const t=JSON.parse(localStorage.getItem("productsOptions"));if(t!=null&&t.length){const p=(i=t[0].OptionData.find(y=>y.productType===u))==null?void 0:i.productOptions;N(y=>({...y,optionsList:p}))}else C()},[u]);function s(t,i){const p={title:t,options:A.map(i,"value")};b(y=>i.length?[...A.filter(y,v=>v.title!==t),p]:A.filter(y,v=>v.title!==t))}if(j.useEffect(()=>{var t,i,p;o&&((i=(t=l())==null?void 0:t.Options)!=null&&i.length)&&b((p=l())==null?void 0:p.Options)},[(g=(f=l())==null?void 0:f.Options)==null?void 0:g.length]),x&&!d.length)return e.jsxs("div",{className:"h-80 flex flex-col items-center justify-center gap-y-4",children:[e.jsx("h6",{className:"text-2xl font-bold",children:"Failed To Get Product Options..."}),e.jsx("button",{onClick:()=>C(),className:"px-4 py-2 rounded-md bg-primary-500 text-gray-50",children:"Try Again"})]});if(w)return e.jsx(he,{});if(!w&&(d!=null&&d.length))return e.jsxs("div",{children:[e.jsxs("div",{className:"text-center my-2",children:[e.jsx("h4",{className:"text-3xl font-bold",children:"Select Options"}),e.jsxs("p",{className:"leading-6 text-sm",children:["This user-friendly interface allows admins to quickly add new products or update existing ones with ease ✏️. Key fields like product name, price, description, and category are neatly organized 🛍️.",e.jsx("span",{className:"hidden lg:inline",children:"  Admins can upload product images 📸 and set stock availability directly from the modal. Validation ensures correct data entry ✅, while real-time previews offer clarity 👀. Whether launching a new item or tweaking details, the modal streamlines operations for a smooth e-commerce experience 💼."})]})]}),e.jsxs("div",{className:"",children:[e.jsx("h6",{className:"text-xl font-bold",children:"Options List :"}),e.jsx("div",{ref:O,className:"flex flex-col gap-y-4 my-2",children:d.map(({title:t,options:i,once:p},y)=>{var v,P,D,V;return e.jsx("div",{className:"option",children:e.jsx(k,{onChange:I=>s(t,p?[I]:I),value:(D=(P=(v=n())==null?void 0:v.Options.filter(({title:I})=>I===t)[0])==null?void 0:P.options)==null?void 0:D.map(I=>({label:I,value:I})),isMulti:!p,options:i.map(I=>({label:I,value:I})),placeholder:`Choose ${t}`,controlShouldRenderValue:(V=n())==null?void 0:V.Options})},y)})})]},(c=n())==null?void 0:c.Options)]})}function ye({isEdit:o,onModalChange:r,currentStep:l,setCurrentStep:n}){const{watch:a}=z(),b=()=>l===1?r():n(d=>Math.max(d-1,1));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-h-96 lg:max-h-[55vh] overflow-y-auto overflow-x-hidden styled-scroll-bar scroll-smooth px-2 py-1.5 relative",children:[e.jsx("div",{className:`${l===1?"visible opacity-100 static translate-x-0":"invisible opacity-0 absolute -top-96 -translate-y-96 -translate-x-96"} transition-all duration-500`,children:e.jsx(ge,{isEdit:o})}),e.jsx("div",{className:`${l===2?"visible opacity-100 static translate-x-0":"invisible opacity-0 absolute -top-96 -translate-y-96 -translate-x-96"} transition-all duration-500`,children:e.jsx(fe,{isEdit:o,currentStep:l})}),e.jsx("div",{className:`${l===3?"visible opacity-100 static translate-x-0":"invisible opacity-0 absolute -top-96 -translate-y-96 -translate-x-96"} transition-all duration-500`,children:e.jsx(ue,{isEdit:o})})]}),e.jsxs("div",{className:"flex items-center justify-end my-2 gap-x-2",children:[e.jsx("button",{type:"button",disabled:o&&l===3||l===3&&a().Images!=="[]",onClick:b,className:"px-4 py-2 lg:w-1/6 border-2 rounded-md border-gray-600 text-gray-900 hover:border-primary-800 hover:text-primary-800 transition-all disabled:invisible",children:l===1?"Close":"Back"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-gray-50 rounded-md border-2 border-primary-500 hover:bg-gray-50 hover:text-primary-500 transition-all lg:w-1/5",children:l!==3?"Next":"Submit"})]})]})}const be=[{step:1,title:"General Info"},{step:2,title:"Options"},{step:3,title:"Images"}];function Ie({onModalChange:o,isEdit:r,selectedProduct:l,getProducts:n}){const{userId:a,businessInformation:b,personalInformation:d}=ae(c=>c.userData),[w,x]=j.useState(!1),N=ne({defaultValues:{Collection:"",Tags:[]}}),[u,O]=j.useState(1),{setValue:C,watch:s,handleSubmit:m}=N,h=le();re(),j.useEffect(()=>{r&&Object.entries(l).forEach(([c,t])=>{C(c,t)})},[r,l,C]);function f(){var v;const{Name:c,Type:t,Category:i,Price:p}=s(),y=s().Options;if(u===1&&(!(c!=null&&c.length)||!t||!i||!p)){S.error("Please complete the product information form");return}else if(u===2&&!y.length){S("Add at least one option");return}else if(u===3)if(((v=s())==null?void 0:v.Images.length)>0){g();return}else S.error("add one image at least");O(P=>Math.min(P+1,3))}async function g(c){var p;if(u!==3){f();return}const t=r?s().id:B(a),i={...s(),Images:A.uniq(s("Images")||[]),Thumbnail:((p=s())==null?void 0:p.Images[0])||"",SellerId:a,SellerName:(b==null?void 0:b.business_name)||(d==null?void 0:d.fisrt_name)||"",SellerEmail:(d==null?void 0:d.email)||"",SellerProfile:(d==null?void 0:d.profilePic)||"",createdByUser:!0,createdAt:ie()};try{x(!0),await L(U($,"Products",t),i),r?(S.success("your changes sumbitted"),n(),o()):(S.success("Product Uploaded Succesfully !"),h(`/EcoVibe/Products/${t}`)),x(!1)}catch(y){x(!1),console.log(y)}}return e.jsxs(ce,{...N,children:[e.jsxs("form",{onSubmit:m(g),className:"px-4 bg-gray-50 relative py-2 lg:px-6 lg:py-4 flex flex-col lg:gap-4 w-[95vw] lg:w-[50vw] xl:w-[40vw] h-5/6 lg:h-auto mx-auto lg:border border-gray-200 lg:shadow hover:shadow-2xl transition-all duration-300 rounded-md",children:[e.jsx("div",{className:"flex items-center justify-evenly lg:justify-center lg:gap-x-6 my-4",children:be.map(({step:c,title:t},i)=>e.jsxs("div",{className:"flex flex-col items-center justify-center text-center gap-2 transition-all",children:[e.jsxs("p",{className:`${u===c?"bg-primary-500 text-gray-50":"border border-primary-500 text-primary-500 bg-gray-50"} size-14 rounded-full flex items-center justify-center text-2xl relative`,children:[c,c<3&&e.jsx("p",{className:`${c===u?"bg-primary-500":"bg-gray-300"} absolute -right-9 -z-10 w-10 h-1`})]}),e.jsx("span",{className:`${u===c?"text-primary-500 font-bold":"text-primary-400"} text-sm`,children:t})]},i))}),w&&e.jsxs("div",{className:"absolute inset-0 bg-gray-50 z-50 flex items-center gap-4 justify-center flex-col",children:[e.jsx(oe,{className:"size-24"}),e.jsxs("h4",{className:"text-2xl font-bold text-center",children:[r?"Update product info, please dont refresh page":"Add new product, please dont refresh page","..."]})]}),e.jsx(ye,{isEdit:r,onModalChange:o,currentStep:u,setCurrentStep:O,onSubmitProduct:m(g)})]}),e.jsx("div",{onClick:()=>{if(r)if(u!==3)o();else{S.remove(),S.error("Plase submit your changes...");return}else if(s().Images!=="[]"){S.remove(),S.error("Plase submit your product, you can remove it later...");return}o()},className:"absolute inset-0 bg-gray-950/70 backdrop-blur cursor-pointer -z-10"})]})}export{Ie as A};
