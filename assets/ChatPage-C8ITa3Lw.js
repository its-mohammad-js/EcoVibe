import{r as m,b as j,u as H,_ as V,aq as me,j as e,O as B,ar as re,as as E,s as fe,at as he,q as T,au as Z,av as ge,aw as pe,ax as ye,ay as be,ah as O,ae as A,ai as k,aj as P,A as ve,az as je,aA as Ne,aB as we,aC as Ce,aD as Ie,aE as W,ag as Se,G as F,aF as ne,aG as Me,aH as q,aI as te,g as G,aJ as ke,aK as Le,aL as ze,aM as De,aN as Re}from"./index-JTJf7nkH.js";import{g as M,o as $e,r as S,s as L,a as Te,b as Y,c as Ee,q as _,e as Oe,d as Ae,f as le,u as z,h as Pe}from"./index.esm2017-C65JGmIX.js";import{a as _e}from"./index-YEzdTmCc.js";import{R as Be}from"./index-D-iSnSVs.js";import{l as U}from"./lodash-BZOtwkUF.js";import{M as oe,a as ie}from"./index.esm-C1gw6S_I.js";import{u as Fe}from"./useCreateChatRoom-Bfua8LFB.js";function Ve(s){const a=M(),[{status:l,rooms:o},t]=m.useState({rooms:[],status:null}),{userId:d,auth_status:n,loading:r}=j(p=>p.userData),c=H();function h(){const p=_(S(a,"rooms"),Ae(`${d}/userId`),Oe(d));Y(p,u=>{if(!u.exists()){t({rooms:[],status:"No Conversations Yet..."});return}const g=Object.entries(u.val()).map(([i,x])=>({...x,roomId:i})).filter(({members:i})=>i.includes(d)).map(i=>{var b,w,N;const x=((b=i==null?void 0:i.members)==null?void 0:b.find(C=>C!==d))||Object.keys(i).find(C=>![d,"roomId","messageList","members"].includes(C));if(((w=i[d])==null?void 0:w.last_seen)||((N=i==null?void 0:i.messageList)==null?void 0:N.length)>0)return{roomId:i.roomId,messageList:i.messageList||null,members:i.members,owner:i[d],receiver:{...i[x],receiverId:x}}});t({rooms:g.filter(i=>i),status:g.length?null:"No Conversations Yet..."})})}return m.useEffect(()=>{s&&d&&$e(S(a,`rooms/${s.roomId}/${d}/last_seen`)).set({date:L(),offline:!0})},[s,d]),m.useEffect(()=>{if(n===200){Te(a);const p=S(a,".info/connected");Y(p,u=>{u.val()===!0&&!r?h():t({rooms:[],status:"loading..."})})}else n===401&&(V("Create an account to join the chat!"),c("/EcoVibe/Customers/sign-up"));return()=>{Ee(a),t({rooms:[],status:null})}},[d]),{status:l,rooms:o}}const ce=m.createContext();function He({children:s}){var f;const[a,l]=m.useState(null),{status:o,rooms:t}=Ve(a),[d,n]=m.useState(null),[r,c]=m.useState(null),h=H(),p=me(),u=(f=p==null?void 0:p.state)==null?void 0:f.roomId;return m.useEffect(()=>{a&&h(p.pathname,{roomId:null})},[a]),m.useEffect(()=>{if(u){const g=t.find(i=>i.roomId===u);l(g)}else a&&l(t.find(g=>g.roomId===a.roomId))},[u,t]),m.useEffect(()=>{!a&&!u&&(n(null),c(null))},[u,a]),e.jsx(ce.Provider,{value:{rooms:t,status:o,selectedRoom:a,setSelectedRoom:l,selectedMessage:d,setSelectedMessage:n,messageMode:r,setMode:c},children:s})}const v=()=>m.useContext(ce);function X({action:s,backTitle:a,sureTitle:l,message:o,closeModal:t,submitCallBack:d}){return e.jsxs("div",{className:"bg-gray-50 px-4 py-2 rounded-md flex flex-col gap-y-2 w-80 lg:w-96 xl:w-[30rem]",children:[e.jsx("h4",{className:"text-lg xl:text-2xl font-bold",children:s||"Alert"}),e.jsx("p",{className:"line-clamp-6",children:o||"Are You Sure?"}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx("button",{onClick:()=>t(),className:"px-4 py-2 text-lg hover:bg-gray-200 transition-all rounded-md",children:a||"Cancel"}),e.jsx("button",{onClick:()=>{d(),t()},className:"px-4 py-2 text-lg hover:bg-gray-200 transition-all rounded-md",children:l||"Im Sure"})]})]})}function Ye({deleteRoom:s,room:a,position:l,setContextMenu:o,contextMenu:t}){const d=m.useRef();B(d,()=>o(!1));const{setSelectedRoom:n,rooms:r}=v(),[c,h]=m.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{top:l.y||0,left:l.x/1.7||0},ref:d,className:`${t?"opacity-100 visible":"opacity-0 invisible"} fixed rounded-md transition-all overflow-hidden z-50 top-24 flex flex-col`,children:[e.jsxs("button",{onClick:()=>{const p=r.find(({roomId:u})=>u===a.roomId);n(p),o(!1)},className:"p-4 bg-gray-100 hover:bg-gray-200 transition-all flex items-center gap-x-2",children:[e.jsx(_e,{className:"text-2xl"}),"open Chat"]}),e.jsxs("button",{onClick:()=>{h(!0),o(!1)},className:"p-4 bg-gray-100 hover:bg-gray-200 transition-all flex items-center gap-x-2 text-red-500",children:[e.jsx(re,{className:"text-2xl"}),"delete chat"]})]}),e.jsxs("div",{className:`${c?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex justify-center items-center transition-all`,children:[e.jsx(X,{action:"Delete Chat Room",closeModal:()=>h(!1),message:"Are You Sure You Want To Delete This Chat?, you cannot access messages again...",submitCallBack:()=>s(a.roomId,r)}),e.jsx("div",{onClick:()=>h(!1),className:"absolute inset-0 bg-gray-950/50 -z-10"})]})]})}const ae=({room:s,mode:a,deleteRoom:l})=>{var ee,se;const{profilePic:o,last_seen:t,first_name:d,last_name:n,business_name:r,userType:c}=s.receiver,[h,p]=m.useState(!1),u=m.useRef();B(u,()=>p(!1));const[f,g]=m.useState({x:0,y:0}),{content:i,createdAt:x,type:y}=((ee=s.messageList)==null?void 0:ee.at(-1))||{},[b,w]=m.useState(""),{selectedRoom:N,setSelectedRoom:C,setSelectedMessage:R,rooms:$}=v(),[Q,J]=m.useState(!1);m.useEffect(()=>{const I=new Date(x),D=new Date;I.getFullYear()===D.getFullYear()&&I.getMonth()===D.getMonth()&&I.getDate()===D.getDate()?w(I.toLocaleTimeString("en-us",{month:"2-digit",hour:"2-digit",minute:"2-digit"})):w(I.toDateString())},[x]);function de(){var D;R(a==="message"?(D=s.messageList)==null?void 0:D.at(-1):null),a==="message"&&setTimeout(()=>{R(null)},2e3);const I=$.find(({roomId:K})=>K===s.roomId);C(I)}return m.useEffect(()=>{if(!t){J(!0);return}const I=M(),D=Y(S(I,".info/serverTimeOffset"),K=>{const ue=Date.now()+K.val()-(t==null?void 0:t.date),xe=Math.floor(ue/1e3);J(xe>=30||(t==null?void 0:t.offline))});return()=>D()},[t,N]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{onContextMenu:I=>{I.preventDefault(),g({x:I.clientX,y:I.clientY}),p(!h)},onClick:()=>de(),className:"w-full h-24 relative select-none rounded-md flex items-center hover:bg-gray-300/30 transition-all cursor-pointer gap-x-2 px-4 py-2",children:[e.jsxs("div",{className:"relative",children:[o?e.jsx("img",{src:o,className:"size-20 bg-gray-100 rounded-full"}):e.jsx("div",{className:"size-full lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(E,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})}),e.jsx("div",{className:`
              ${Q?"bg-gray-400":"bg-green-400"} ${a==="message"&&"hidden"} absolute -bottom-1 size-5 right-1 rounded-full transition-all`})]}),e.jsxs("div",{className:"flex flex-col mt-2.5 justify-center h-full w-2/3 select-none",children:[e.jsx("h6",{className:"line-clamp-2 font-bold text-lg text-gray-800",children:c==="customer"?d+" "+n:r}),e.jsx("p",{className:"line-clamp-1 text-gray-700 break-words max-w-56",children:(se=s==null?void 0:s.messageList)!=null&&se.length?y==="text"?i:y:"Nothing yet"}),e.jsx("p",{className:"absolute top-2 right-2 text-sm text-gray-700",children:x?b:""})]})]}),e.jsx(Ye,{deleteRoom:l,room:s,position:f,setContextMenu:p,contextMenu:h})]})};function Ue({openSideNav:s,deleteRoom:a}){const[l,o]=m.useState(""),{rooms:t,setSelectedRoom:d,selectedRoom:n,status:r}=v(),{loading:c}=j(u=>u.userData);fe(".contacts-container");function h(u){const f=u.toLowerCase();return t.flatMap(({messageList:g,roomId:i,receiver:x})=>g==null?void 0:g.filter(y=>{var b;return(b=y==null?void 0:y.content)==null?void 0:b.toLowerCase().includes(f)}).map(y=>({messageList:[y],roomId:i,receiver:x})))}function p(u){const f=u.toLowerCase();return t.filter(({receiver:g})=>[g==null?void 0:g.business_name,g==null?void 0:g.first_name,g==null?void 0:g.last_name].some(i=>i==null?void 0:i.toLowerCase().includes(f)))}return e.jsxs("div",{className:`${n&&"hidden"} lg:!flex lg:w-1/4 w-full h-screen bg-gray-50 flex flex-col`,children:[e.jsxs("div",{className:"",children:[e.jsx("div",{className:"bg-gray-50 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-1.5 cursor-pointer relative",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Messages"}),e.jsx("button",{onClick:()=>s(),className:"absolute -left-2 p-1.5 rounded-full text-4xl hover:text-gray-700 transition-all",children:e.jsx(he,{})})]})}),e.jsx("div",{className:"w-full px-4 pb-2 pt-3",children:e.jsx("input",{onChange:({target:u})=>{var f;o((f=u.value)==null?void 0:f.toLowerCase())},type:"text",value:l,placeholder:"Search Messages & Contacts",className:"py-2.5 bg-gray-200 w-full outline-none px-4 rounded-lg placeholder:text-gray-500"})})]}),e.jsx("div",{className:`${!p(l).length||!(l!=null&&l.length)?"hidden":"basis-[19%] min-h-32"} overflow-x-auto overflow-y-hidden mx-auto flex px-4 gap-3 py-1 hidden-scroll-bar w-full contacts-container`,children:l&&e.jsx("div",{className:"flex items-center gap-x-4 select-none",children:p(l).map((u,f)=>{var g;return e.jsxs("div",{className:"w-24 gap-y-1 flex flex-col items-center justify-center",children:[e.jsx("div",{onClick:()=>d(u),className:"cursor-pointer",children:(g=u.receiver)!=null&&g.profilePic?e.jsx("img",{src:u.receiver.profilePic,className:"size-20 bg-gray-100 rounded-full"}):e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(E,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})})}),e.jsx("p",{onClick:()=>d(u),className:"line-clamp-2 break-words w-10/12 text-sm text-center cursor-pointer",children:u.receiver.userType==="customer"?u.receiver.first_name+" "+u.receiver.last_name:u.receiver.business_name})]},f)})})}),e.jsxs("div",{className:`${l!=null&&l.length?"basis-[55%] lg:basis-[65%]":"basis-[76%] lg:basis-[83%]"} flex flex-col flex-none overflow-auto relative styled-scroll-bar`,children:[T(200).map(u=>e.jsx("div",{className:"w-full h-24 bg-gray-200 flex-none",children:"dic"},u)),e.jsxs("h2",{className:`${!(l!=null&&l.length)&&"hidden"} block px-4 sticky top-0 z-10 py-1 w-full bg-gray-200`,children:["Found ",h(l).length," Messages"]}),c||r?e.jsx("h4",{className:"px-2 py-1 w-full flex justify-center",children:e.jsx("p",{className:"px-4 py-1 text-lg font-bold bg-gray-200/80 rounded-xl",children:"loading..."})}):l?h(l).map((u,f)=>e.jsx(ae,{room:u,mode:"message"},f)):t.map((u,f)=>e.jsx(ae,{room:u,mode:"user",deleteRoom:a},f))]})]})}function Ze({onCloseNav:s,navIsShow:a,openContacts:l}){const{personalInformation:o,userType:t,userId:d}=j(c=>c.userData),{auth_status:n}=j(c=>c.userData),r=H();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${a?"translate-x-0 opacity-100 visible":"-translate-x-16 opacity-0 invisible"} absolute transition-all ease-linear z-50 max-w-20 h-full bg-gray-50 px-4 py-4 flex flex-col items-center gap-y-6 border-r-2 rounded-r-2xl`,children:[e.jsx("button",{onClick:()=>s(),className:"px-2 py-2 bg-primary-500 text-gray-50 text-xl rounded-lg",children:e.jsx(Z,{className:"text-3xl"})}),e.jsxs("div",{className:"flex flex-col h-full relative items-center gap-y-6",children:[e.jsxs("button",{onClick:()=>r("/EcoVibe/"),className:"text-3xl group flex items-center relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(ge,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Back To Home"})]}),e.jsxs("button",{disabled:n!==200,onClick:()=>{s(),l()},className:"text-3xl disabled:hidden group flex items-center relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(Be,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Search Contacts"})]}),e.jsxs("button",{onClick:()=>r(t==="customer"?"/EcoVibe/bag/orders":"/EcoVibe/Dashboard/Orders"),className:"text-3xl group flex items-center relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(pe,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Check Orders"})]}),e.jsxs("button",{onClick:()=>r("/EcoVibe/Dashboard"),disabled:t==="customer",className:"text-3xl group flex items-center disabled:hidden relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(ye,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Dashboard"})]}),e.jsxs("div",{onClick:()=>r(t==="customer"?"/EcoVibe/profile":`/EcoVibe/seller/${d}`),className:"text-3xl absolute bottom-2 group flex items-center hover:bg-gray-200 transition-all rounded-lg",children:[e.jsx(e.Fragment,{children:o!=null&&o.profilePic?e.jsx("img",{src:o==null?void 0:o.profilePic,className:"rounded-full size-14 object-cover"}):e.jsx("p",{className:"p-2",children:e.jsx(E,{})})}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"My Profile"})]})]})]}),e.jsx("div",{onClick:()=>s(),className:`${a?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-40 bg-gray-950/50 backdrop-blur-sm`})]})}function qe(){return e.jsx("div",{className:"h-2/5 overflow-auto absolute animate-pulse w-full bottom-1 styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-4 py-2 px-1",children:T(5).map((s,a)=>e.jsxs("div",{className:"h-28 anima flex flex-col items-start py-1.5 cursor-pointer border-b border-gray-300 hover:border-none hover:bg-gray-200 rounded-md p-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-x-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-x-2",children:[e.jsx("div",{className:"size-8 rounded-full bg-gray-300"}),e.jsx("h2",{className:"w-20 h-2 bg-gray-300 rounded-md"})]}),e.jsx("p",{className:"w-20 h-2 bg-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex flex-col gap-y-2 w-full py-2",children:T(4).map(l=>e.jsx("div",{className:"w-full h-2 bg-gray-300 rounded-md last:w-4/5"},l))})]},a))})})}const Ge=()=>{const{selectedRoom:{receiver:s}}=v();return e.jsxs("div",{className:"size-full relative",children:[e.jsxs("div",{className:"flex flex-col items-center pt-4 pb-2 mb-3.5 gap-y-4 border-b border-gray-300",children:[e.jsx("div",{className:"size-24 gradient-background rounded-full",children:e.jsx("img",{src:s==null?void 0:s.profilePic,alt:"seller-avatar",className:"size-full rounded-full"})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("button",{className:"p-1.5 text-gray-800 hover:bg-gray-300 transition-all bg-gray-200 text-2xl rounded-lg",children:e.jsx(be,{})}),e.jsx("button",{className:"p-1.5 text-gray-800 hover:bg-gray-300 transition-all bg-gray-200 text-2xl rounded-lg",children:e.jsx(E,{})})]})]}),e.jsxs("div",{className:"flex flex-col gap-y-2 h-1/3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-x-3",children:[e.jsx("p",{className:"text-lg font-semibold w-3/5",children:"Shop Name"}),e.jsx("p",{className:"w-2/5 line-clamp-1 break-words",children:s==null?void 0:s.business_name})]}),e.jsxs("div",{className:"flex items-center justify-center gap-x-3",children:[e.jsx("p",{className:"text-lg font-semibold w-3/5",children:"Career Title"}),e.jsx("p",{className:"w-2/5 line-clamp-1 break-words",children:s==null?void 0:s.career_title})]}),e.jsxs("div",{className:"flex items-center justify-center gap-x-3",children:[e.jsx("p",{className:"text-lg font-semibold w-3/5",children:"Email"}),e.jsx("p",{className:"w-2/5 line-clamp-1 break-words",children:s==null?void 0:s.email})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold",children:"Biography"}),e.jsx("p",{className:"line-clamp-4 lg:line-clamp-4 mt-1",children:(s==null?void 0:s.biography)||"Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident blanditiis sed velit, doloribus ipsam possimus tenetur autem! Amet dolorum excepturi earum, tempore exercitationem in quos sapiente voluptates nam aperiam molestiae"})]})]}),e.jsx("div",{className:"w-full h-1/3 justify-self-end",children:e.jsx(Qe,{seller:s})})]})},Qe=({seller:s})=>{const[{error:a,loading:l,reviews:o},t]=m.useState({reviews:[],loading:!1,error:null});m.useEffect(()=>{async function n(){try{t(h=>({...h,loading:!0}));const r=_(O(A,"comments"),k("sellerId","==",s.receiverId)),c=await P(r).then(({docs:h})=>h.map(p=>p.data()));t({loading:!1,error:null,reviews:c})}catch(r){console.log(r),t({loading:!1,error:r,reviews:[]})}}n()},[]);function d(n){return new Date(n).toLocaleDateString()}if(l)return e.jsx(qe,{});if(!l&&(o!=null&&o.length))return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("h4",{className:"text-lg font-bold z-10 bg-gray- 100",children:[o==null?void 0:o.length," Reviews"]}),e.jsx("div",{className:"lg:h-2/5 bg-gray-100 overflow-auto styled-scroll-bar pb-6 lg:pb-0",children:e.jsx("div",{className:"flex flex-col gap-y-4 py-2 px-1",children:o.map((n,r)=>e.jsxs("div",{className:"h-32 flex flex-col items-start py-1.5 cursor-pointer border-b border-gray-300 hover:border-none hover:bg-gray-200 rounded-md p-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-x-2",children:[e.jsx("div",{className:"size-8 rounded-full gradient-background bg-opacity-80",children:e.jsx("img",{src:n.authorProfile,alt:"author-profile",className:"size-full rounded-full"})}),e.jsx("h2",{className:"line-clamp-1 w-3/5 font-bold text-start",children:n.content.first_name}),e.jsx("p",{className:"",children:d(n.date)})]}),e.jsx("div",{className:"line-clamp-2 lg:line-clamp-3 mt-0.5 text-pretty py-1.5",children:n.content.review})]},r))})})]})};function Ke(){return e.jsx("div",{className:"w-full h-2/5 px-2 py-1 overflow-auto styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-4",children:T(4).map((s,a)=>e.jsxs("div",{className:"w-full h-20 animate-pulse bg-gray-300 cursor-pointer rounded-md px-2 py-1 flex flex-col justify-evenly",children:[e.jsx("h4",{className:"w-full h-2 bg-gray-400 rounded-md"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"w-12 h-2 bg-gray-400 rounded-md"}),e.jsx("p",{className:"w-12 h-2 bg-gray-400 rounded-md"})]})]},a))})})}const We=({loading:s,orders:a})=>{const[l,o]=m.useState([]);return m.useEffect(()=>{const t=a.flatMap(n=>Object.values(n==null?void 0:n.orders).flatMap(({items:r})=>r)),d=ve.map(({title:n})=>({title:n.split(" ")[0],profit:t.filter(({Category:r})=>r===n).reduce((r,c)=>r+Number(c.Price),0)}));o(d)},[a]),e.jsxs("div",{className:"w-full h-2/5",children:[e.jsx("h4",{className:"text-lg font-bold",children:"Orders of this customer:"}),e.jsx("div",{className:"size-full flex items-center justify-center",children:e.jsx(je,{width:"100%",height:"100%",className:`${s&&"animate-pulse"}`,children:e.jsxs(Ne,{cx:"50%",cy:"50%",outerRadius:"80%",data:l,children:[e.jsx(we,{}),e.jsx(Ce,{dataKey:"title",className:"text-xs"}),e.jsx(Ie,{dataKey:"profit",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6})]})})})]})},Xe=({loading:s,orders:a})=>{const{userId:l}=j(t=>t.userData);function o(t){return U.filter(t,(r,c)=>c===l).map(r=>r.items.reduce((c,h)=>c+h.Price*h.quantity,0)).reduce((r,c)=>r+c,0)}if(s)return e.jsx(Ke,{});if(!s&&a.length)return e.jsxs("div",{className:"w-full h-2/5",children:[e.jsx("h4",{className:"text-lg font-bold",children:"Orders of this customer:"}),e.jsx("div",{className:"px-2 pb-12 lg:py-1 h-[75%] lg:h-auto overflow-auto styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-4",children:a.map((t,d)=>e.jsxs("div",{className:"w-full h-24 bg-gray-200 cursor-pointer rounded-md px-2 py-1 flex flex-col justify-evenly",children:[e.jsx("h4",{className:"line-clamp-1 break-words font-bold",children:t.orderId}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Total price:"})," $",o(t.orders)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Order Date:"}),W(t.createdAt,{})]})]})]},d))})})]})},Je=()=>{const[{loading:s,orders:a},l]=m.useState({orders:[],loading:!1}),{userId:o}=j(d=>d.userData),{selectedRoom:{receiver:t}}=v();return m.useEffect(()=>{async function d(){try{l(c=>({...c,loading:!0}));const n=Se(O(A,"Orders"),k("customerId","==",t.receiverId),k("sellers","array-contains",o)),r=await P(n).then(({docs:c})=>c.map(h=>h.data()));l({loading:!1,orders:r})}catch(n){l({loading:!1,orders:[]}),console.log(n)}}d()},[]),e.jsxs("div",{className:"size-full flex-col flex gap-y-2",children:[e.jsxs("div",{className:"w-full h-1/5 flex items-center justify-start gap-x-4 px-4 py-2",children:[e.jsx("div",{className:"size-20 rounded-full",children:e.jsx("img",{src:t==null?void 0:t.profilePic,alt:"customer-avatar",className:"size-full rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-y-1 w-4/6",children:[e.jsx("h2",{className:"text-xl font-semibold line-clamp-1",children:(t==null?void 0:t.first_name)+" "+(t==null?void 0:t.last_name)}),e.jsx("p",{className:"text-gray-800",children:t==null?void 0:t.email}),e.jsx("p",{className:"text-gray-800",children:t==null?void 0:t.address})]})]}),e.jsx(We,{orders:a,loading:s}),e.jsx(Xe,{orders:a,loading:s})]})};function es({modalShow:s,onCloseModal:a}){const[l,o]=m.useState(null),{selectedRoom:{receiver:t}}=v();if(m.useEffect(()=>{o((t==null?void 0:t.userType)==="customer"?"customer":"seller")},[t==null?void 0:t.userType]),l)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${s?"visible opacity-100 translate-x-0":"invisible opacity-0 translate-x-28"} w-full lg:w-96 fixed top-0 right-0 ease-in-out h-screen bg-gray-100 z-50 transition-all px-2.5 lg:px-4 py-2`,children:[e.jsx("button",{onClick:()=>a(),className:"absolute left-2 text-3xl lg:hidden z-50",children:e.jsx(Z,{})}),e.jsxs("div",{className:`${t.userType==="both"?"block":"hidden"} w-full flex py-2 items-center justify-between`,children:[e.jsx("button",{onClick:()=>o("seller"),className:`${l==="seller"&&"text-gray-950"} px-4 hover:text-gray-700 rounded-md w-1/2`,children:"Seller Info"}),e.jsx("button",{onClick:()=>o("customer"),className:`${l==="customer"&&"text-gray-950"} px-4 text-gray-500 lg:hover:text-gray-700 rounded-md w-1/2`,children:"Customer Info"})]}),l==="customer"?e.jsx(Je,{}):e.jsx(Ge,{})]}),e.jsx("div",{onClick:()=>a(),className:`${s?"visible opacity-100":"invisible opacity-0"} fixed inset-0 bg-gray-950/60 backdrop-blur-sm z-40 transition-all`})]})}function ss({setUserDetails:s,lastStatus:a}){const{setSelectedRoom:l,selectedRoom:o}=v(),{profilePic:t,status:d,first_name:n,business_name:r,userType:c}=(o==null?void 0:o.receiver)||{};return e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>{l(null)},className:"text-2xl",children:e.jsx(Z,{})}),e.jsx("div",{onClick:()=>s(!0),className:"cursor-pointer",children:t?e.jsx("img",{src:t,className:"size-14 rounded-full",alt:"user-profile"}):e.jsx("div",{className:"size-12 lg:size-16 flex items-center justify-center bg-gray-200 rounded-full",children:e.jsx(E,{className:"text-4xl lg:text-6xl mt-3 rounded-full"})})}),e.jsxs("div",{onClick:()=>s(!0),className:"flex flex-col ml-4 cursor-pointer",children:[e.jsxs("h4",{className:c==="customer"?"":"flex flex-col gap-y-1",children:[e.jsx("p",{className:"text-lg font-bold",children:c==="customer"?n:r}),e.jsx("p",{className:"-mt-1 text-sm line-clamp-1 break-words lg:text-base",children:a.current})]}),e.jsx("p",{children:d})]})]})}function ts(s){return F({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"},child:[]}]})(s)}function ls(s){const{setContextMenu:a,contextMenu:l,setShowAlert:o,setUserDetails:t,setBarIsShow:d}=s,n=m.useRef();B(n,()=>a(()=>a(!1)));const{selectedRoom:r,setSelectedRoom:c}=j(h=>h.userData);return e.jsx("div",{ref:n,className:"flex items-center gap-x-2 px-0.5 pt-1.5",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>a(!l),className:"text-3xl",children:e.jsx(ts,{})}),e.jsxs("div",{className:`${l?"opacity-100 visible":"opacity-0 invisible"} absolute transition-all w-60 overflow-hidden bg-gray-50 z-50 right-0 shadow-2xl rounded-sm flex flex-col`,children:[e.jsxs("button",{onClick:()=>{a(!1),d(!0)},className:"px-4 py-4 text-lg hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(ne,{className:"text-2xl"})," Search bar"]}),e.jsxs("button",{onClick:()=>{a(!1),t(r)},className:"px-4 py-4 text-lg hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(Me,{className:"text-2xl"})," User info"]}),e.jsxs("button",{onClick:()=>{a(!1),c(null)},className:"px-4 py-4 text-lg hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(q,{className:"text-2xl"}),"Close chat"]}),e.jsxs("button",{onClick:()=>{o(!0),a(!1)},className:"px-4 py-4 text-lg text-red-600 hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(re,{className:"text-2xl "}),"Delete chat"]})]})]})})}function as({barIsShow:s,setBarIsShow:a}){var f,g;const[l,o]=m.useState(""),[{results:t,selectedIndex:d},n]=m.useState({selectedIndex:0,results:[]}),{setSelectedMessage:r,selectedRoom:c,messageMode:h}=v(),{userId:p}=j(i=>i.userData);m.useEffect(()=>{if(s||o(""),l.length>0){const i=c==null?void 0:c.messageList.filter(({content:x,type:y,visibleTo:b})=>b.includes(p)&&y==="text"&&x.toLowerCase().includes(l.toLowerCase()));n({selectedIndex:0,results:i.reverse()})}else n({selectedIndex:0,results:[]})},[l,s,c]);const u=i=>{n(x=>({...x,selectedIndex:i==="up"?x.selectedIndex+1:x.selectedIndex-1}))};return m.useEffect(()=>{a(!1)},[c,h]),m.useEffect(()=>{s&&r(t[d])},[d,t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${s?"visible opacity-100 translate-y-0":"opacity-0 invisible translate-y-10"} absolute top-0 w-full right-0 h-[4.5rem] bg-gray-100 transition-all flex items-center justify-center px-4`,children:[e.jsx("button",{onClick:()=>{a(!1),r(null)},className:"text-3xl",children:e.jsx(Z,{})}),e.jsx("input",{onChange:({target:i})=>o(i.value),value:l,type:"text",placeholder:"search messages",className:"flex-1 px-4 py-2 bg-transparent outline-none text-lg"}),e.jsx("button",{className:"text-3xl",children:e.jsx(ne,{})})]}),s&&e.jsxs("div",{className:"w-full absolute right-0 bottom-0 z-50 h-16 bg-gray-50 flex items-center px-4 py-2 transition-all lg:opacity-100",children:[e.jsx("h4",{className:"text-lg font-bold",children:l!=null&&l.length?d?`${d+1} of ${t==null?void 0:t.length}`:`${t==null?void 0:t.length} Messages Find`:`Search Between ${(f=c.messageList)!=null&&f.length?(g=c.messageList)==null?void 0:g.length:0} Messages`}),e.jsxs("div",{className:`${t.length<=0&&"hidden"} flex flex-col absolute bg-gray-50/40 rounded-3xl backdrop-blur-sm right-8 gap-y-2 -top-28`,children:[e.jsx("button",{disabled:d===t.length-1,onClick:()=>u("up"),className:"p-2.5 text-2xl rounded-full bg-gray-100 -rotate-90 disabled:opacity-50 transition-all",children:e.jsx(te,{})}),e.jsx("button",{disabled:!d,onClick:()=>u("down"),className:"p-2.5 text-2xl rounded-full bg-gray-100 rotate-90 disabled:opacity-50 transition-all",children:e.jsx(te,{})})]})]})]})}function rs({setShowAlert:s}){const[a,l]=m.useState(null),[o,t]=m.useState(!1),d=m.useRef();B(d,()=>t(()=>t(!1)));const{selectedRoom:n}=v(),{last_name:r,business_name:c,userType:h,career_title:p,last_seen:u}=(n==null?void 0:n.receiver)||{},f=m.useRef(""),[g,i]=m.useState(!1);m.useEffect(()=>{if(!u){f.current=h!=="customer"?p||c:r;return}const y=M(),b=S(y,".info/serverTimeOffset");let w;const N=()=>{Y(b,C=>{const $=Date.now()+C.val()-(u==null?void 0:u.date),Q=Math.floor($/1e3);f.current=Q>=30||u!=null&&u.offline?`last seen at ${x(u==null?void 0:u.date)}`:"online"},{onlyOnce:!0})};return N(),w=setInterval(N,15e3),()=>{clearInterval(w)}},[u]);function x(y){return new Date(y).toLocaleTimeString("en-us",{year:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}return e.jsxs("div",{onContextMenu:y=>{y.preventDefault(),t(!0)},className:"w-full bg-gray-100 p-2 lg:px-4 flex items-center justify-between z-30 transition-all",children:[e.jsx(ss,{lastStatus:f,setUserDetails:l}),e.jsx(ls,{contextMenu:o,setContextMenu:t,setShowAlert:s,setUserDetails:l,setBarIsShow:i}),e.jsx(es,{modalShow:a,onCloseModal:()=>l(null)}),e.jsx(as,{barIsShow:g,setBarIsShow:i})]})}function ns({message:s}){return e.jsxs("div",{className:" lg:w-72 h-20 border-l-4 relative border-gray-600 flex items-center gap-x-2.5 px-2 py-1",children:[e.jsx("div",{className:"size-16 lg:size-20 bg-gray-100 hover:bg-gray-100/90 transition-all overflow-hidden grid z-0 rounded-full grid-cols-2 grid-rows-2",children:s.order.thumbnails.map((a,l)=>l<3&&e.jsx("img",{className:"size-full object-cover -z-10",src:a},l))}),e.jsxs("div",{className:"w-4/6 flex flex-col gap-y-2.5",children:[e.jsxs("h4",{className:"line-clamp-1 break-words w-11/12 font-bold text-sm hover:underline",children:[s.order.orderId.slice(0,20),"..."]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs font-semibold",children:["$",s.order.totalPrice]}),e.jsxs("p",{className:"font-semibold text-xs",children:["date:  ",W(s.order.createdAt,{year:"numeric",month:"2-digit",day:"2-digit"})]})]})]})]})}function os({message:s}){const[a,l]=m.useState(!1);return e.jsx("div",{className:"w-64 lg:min-w-96",children:e.jsxs("div",{className:`${a&&"fixed inset-0 !h-full z-40"} w-full h-80 lg:h-96 rounded-lg overflow-hidden`,children:[e.jsx("div",{onClick:()=>l(!0),className:"size-full",children:e.jsx(oe,{defaultCenter:[s.location[0],s.location[1]],defaultZoom:11,minZoom:3,maxZoom:10,mouseEvents:a,touchEvents:a,children:s.location&&e.jsx(ie,{color:"#1632e9",width:50,anchor:s.location})})}),a&&e.jsx("button",{onClick:()=>l(!1),className:"absolute top-2 right-2 p-2.5 bg-gray-50 rounded-full text-2xl z-50",children:e.jsx(q,{})})]})})}function is({message:s}){return e.jsxs("div",{className:"h-72 lg:h-80 flex flex-col justify-evenly w-64 lg:w-96",children:[e.jsxs("div",{className:"w-full h-64 relative group rounded-md overflow-hidden",children:[e.jsx("img",{src:s.product.thumbnail,alt:"product-thumbnail",className:"size-full object-cover max-w-full "}),e.jsx("div",{className:"absolute inset-0 bg-gray-950/80 backdrop-blur flex items-center justify-center px-4 py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300",children:e.jsx("p",{className:"line-clamp-[10] text-gray-50 text-center",children:s.product.desc})})]}),e.jsxs("div",{className:"px-2 py-1",children:[e.jsx("h4",{className:"text-lg line-clamp-1 font-bold",children:s.product.name}),e.jsxs("p",{className:"font-semibold",children:["Price: $",s.product.price]})]})]})}function cs({setContextMenu:s,contextMenu:a,message:l,onDeleteMessage:o,position:t}){const d=m.useRef();B(d,()=>s(null));const{userId:n}=j(u=>u.userData),r=u=>u===n,{setSelectedMessage:c,setMode:h}=v();m.useEffect(()=>{},[l]);const p=async()=>{try{const u=document.createElement("input");u.value=l.content,document.body.appendChild(u),u.select(),document.execCommand("copy"),V.success("copied to clipboard")}catch{V.remove(),V.error("Failed to copy message")}};return e.jsxs("div",{ref:d,style:{top:r(l.senderId)?t.y-100:t.y,left:r(l.senderId)?t.x-100:t.x},className:`${a===l.uiid?"visible opacity-100":"invisible opacity-0"}
    w-28 h-fit fixed z-50 bg-gray-100 bottom-0 flex flex-col rounded-md transition-all`,children:[e.jsx("button",{onClick:()=>{c(l),h("reply"),s(!1)},className:"px-4 py-2 text-gray-950 bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all border-b border-b-gray-300",children:"reply"}),e.jsx("button",{disabled:(l==null?void 0:l.type)!=="text",onClick:()=>{p(),s(!1)},className:"disabled:hidden px-4 py-2 text-gray-950 bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all border-b border-b-gray-300",children:"copy"}),e.jsx("button",{onClick:()=>{c(l),h("edit"),s(!1)},className:"px-4 py-2 text-gray-950 disabled:hidden bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all border-b border-b-gray-300",disabled:!r(l.senderId)||l.type!=="text",children:"edit"}),e.jsx("button",{onClick:()=>o(l.uiid),className:"px-4 py-2 text-gray-950 bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all disabled:hidden",disabled:!r(l.senderId),children:"delete"})]})}function ds({message:s,onDeleteMessage:a,setContextMenu:l,contextMenu:o}){var i;const[t,d]=m.useState({x:0,y:0}),[n,r]=m.useState(null),{selectedMessage:c,setSelectedMessage:h,selectedRoom:p}=v(),{userId:u}=j(x=>x.userData),f=x=>x===u;m.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),m.useEffect(()=>{var x;if(s!=null&&s.replyTo){const y=(x=p.messageList)==null?void 0:x.find(({uiid:b})=>b===s.replyTo);r(y)}},[s]);function g(x){return new Date(x).toLocaleDateString("en-US",{year:"numeric",hour:"2-digit",minute:"2-digit"}).split(",")[1]}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`${f(s.senderId)?"self-end bg-slate-200":"self-start bg-gray-50 items-end"} ${(c==null?void 0:c.uiid)===s.uiid&&"!bg-gray-900 text-gray-50 focused-message_shadow"} px-3 py-1.5 w-fit select-none rounded-md flex flex-col items-end gap-y-1 transition-all cursor-pointer max-w-[95%] lg:max-w-[60%]`,children:[e.jsxs("div",{id:s.uiid,onContextMenu:x=>{d({x:x.clientX,y:x.clientY}),x.preventDefault(),l(s.uiid)},children:[e.jsxs("div",{onClick:()=>{h(n),setTimeout(()=>{h(null)},1500)},className:`${n&&"!flex"} hidden h-16 w-full bg-primary-100/50 flex-col mb-2 mt-1 justify-evenly text-gray-900 rounded-lg border-l-4 border-primary-400/50 px-2 py-1`,children:[e.jsx("h4",{className:"text-lg font-bold",children:"Reply To"}),e.jsx("p",{className:"line-clamp-1 text-sm",children:(n==null?void 0:n.type)==="text"?n==null?void 0:n.content.slice(0,((i=n==null?void 0:n.content)==null?void 0:i.length)*10):`${n==null?void 0:n.type} message`})]}),s.type==="text"?e.jsx("p",{className:"text-start w-full break-words max-w-96",children:s.content}):s.type==="order"?e.jsx(ns,{message:s}):s.type==="location"?e.jsx(os,{message:s}):e.jsx(is,{message:s}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 w-full",children:[e.jsx("p",{className:"text-xs opacity-80 order-2",children:g(s.createdAt)}),(s==null?void 0:s.isEdited)&&e.jsx("p",{className:"text-xs opacity-70",children:"Edited"})]})]}),e.jsx(cs,{setContextMenu:l,contextMenu:o,message:s,onDeleteMessage:a,position:t})]})})}const us=()=>{var f,g;const[s,a]=m.useState(null),[{alertIsShow:l,messageId:o},t]=m.useState({alertIsShow:"",messageId:null}),[d,n]=m.useState(null),{selectedRoom:r,selectedMessage:c}=v(),{userId:h}=j(i=>i.userData),p=m.useRef();m.useEffect(()=>{p.current&&(s?p.current.style.overflow="hidden":p.current.style.overflow="auto")},[s]);function u(i){if(!l)t({messageId:i,alertIsShow:!0});else{const x=M(),y=S(x,`rooms/${r.roomId}`);z(y,{messageList:[...r.messageList.filter(({uiid:b})=>b!==o)]}),t({messageId:null,alertIsShow:!1})}}if(m.useEffect(()=>{r&&n(r)},[]),m.useEffect(()=>{if(!d)return;const i=M(),x=S(i,`rooms/${d.roomId}/${h}/last_seen`);if(r){le(x,{date:L()});const y=setInterval(()=>{le(x,{date:L()})},45e3);return()=>{z(x,{date:L(),offline:!0}),clearInterval(y)}}return()=>{z(x,{date:L(),offline:!0})}},[d]),m.useEffect(()=>{c&&document.getElementById(`${c.uiid}`).scrollIntoView({behavior:"smooth",block:"center"})},[c]),m.useEffect(()=>{var y;if(c)return;const i=r.messageList;document.getElementById(`${(y=i[(i==null?void 0:i.length)-1])==null?void 0:y.uiid}`).scrollIntoView({block:"start"})},[r.messageList]),!((f=r==null?void 0:r.messageList)!=null&&f.length))return e.jsx("div",{className:"bg-gray-300 w-full flex justify-center items-center flex-1",children:e.jsx("h4",{className:"px-4 py-2 bg-gray-200 rounded-md font-semibold",children:"Nothing yet"})});if((g=r==null?void 0:r.messageList)!=null&&g.length)return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:p,onContextMenu:i=>i.preventDefault(),className:"flex relative flex-col gap-y-2 w-full overflow-auto flex-1 px-2 pb-1 pt-2 bg-gray-300 styled-scroll-bar",children:r.messageList.map((i,x)=>{var y;return((y=i==null?void 0:i.visibleTo)==null?void 0:y.includes(h))&&e.jsx(ds,{message:i,onDeleteMessage:u,contextMenu:s,setContextMenu:a},x)})}),e.jsxs("div",{className:`${l?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex justify-center items-center transition-all`,children:[e.jsx(X,{action:"Delete Message",closeModal:()=>t({messageId:null,alertIsShow:!1}),message:"Do you want to delete this message ?",submitCallBack:()=>u(),sureTitle:"Delete"}),e.jsx("div",{onClick:()=>t({alertIsShow:!1,messageId:null}),className:"absolute inset-0 bg-gray-950/50 backdrop-blur-sm -z-10"})]})]})};function xs(s){return F({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"},child:[]}]})(s)}function ms(s){return F({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75Z"},child:[]},{tag:"path",attr:{d:"M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Z"},child:[]}]})(s)}function fs(s){return F({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7.886 1.553a1.75 1.75 0 0 1 2.869.604l.633 1.629a5.667 5.667 0 0 0 3.725 3.395l3.959 1.131a1.749 1.749 0 0 1 .757 2.92L16.06 15l5.594 5.595a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L15 16.061l-3.768 3.768a1.749 1.749 0 0 1-2.92-.757l-1.131-3.96a5.665 5.665 0 0 0-3.395-3.724l-1.63-.633a1.75 1.75 0 0 1-.603-2.869Zm6.589 12.912 4.293-4.294a.25.25 0 0 0-.108-.417L14.7 8.623A7.165 7.165 0 0 1 9.99 4.33L9.357 2.7a.25.25 0 0 0-.41-.086L2.614 8.946a.25.25 0 0 0 .086.41l1.63.634a7.167 7.167 0 0 1 4.294 4.71l1.13 3.96a.25.25 0 0 0 .417.108l4.294-4.293Z"},child:[]}]})(s)}function hs(s){return F({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M2.287 2.326L2.692 2h.677v3h-.708V2.792l-.374.281v-.747zM5 3h10v1H5V3zm0 4h10v1H5V7zm10 4H5v1h10v-1zM3.742 7.626l.029-.039.065-.09a.84.84 0 0 0 .156-.507c0-.12-.02-.24-.057-.354a.848.848 0 0 0-.492-.529 1.123 1.123 0 0 0-.452-.082 1.094 1.094 0 0 0-.458.087.867.867 0 0 0-.479.522A1.038 1.038 0 0 0 2 6.957v.05h.81v-.05a.3.3 0 0 1 .046-.157.174.174 0 0 1 .057-.054.19.19 0 0 1 .172 0 .188.188 0 0 1 .056.06.24.24 0 0 1 .031.081.445.445 0 0 1-.036.29 1.309 1.309 0 0 1-.12.182l-1 1.138-.012.013v.54h1.988v-.7h-.9l.65-.724zm-.037 3.817c.046.032.086.07.12.114a.841.841 0 0 1 .167.55c0 .107-.017.213-.05.314a.792.792 0 0 1-.487.5 1.288 1.288 0 0 1-.48.079c-.115 0-.23-.016-.341-.049a.94.94 0 0 1-.258-.123.751.751 0 0 1-.182-.177 1.063 1.063 0 0 1-.116-.2A1.038 1.038 0 0 1 2 12.078v-.049h.814v.049c0 .027.003.055.009.082a.207.207 0 0 0 .03.074.14.14 0 0 0 .053.052.2.2 0 0 0 .157.008.159.159 0 0 0 .056-.039.22.22 0 0 0 .042-.075.417.417 0 0 0 .017-.126.483.483 0 0 0-.022-.163.2.2 0 0 0-.051-.08.138.138 0 0 0-.06-.029.537.537 0 0 0-.077-.007h-.161v-.645h.168a.241.241 0 0 0 .069-.011.164.164 0 0 0 .065-.034.175.175 0 0 0 .048-.067.286.286 0 0 0 .021-.121.28.28 0 0 0-.016-.1.166.166 0 0 0-.097-.099.2.2 0 0 0-.156.007.164.164 0 0 0-.055.053.344.344 0 0 0-.04.156v.049H2v-.049a.987.987 0 0 1 .18-.544.8.8 0 0 1 .179-.186.87.87 0 0 1 .262-.133c.114-.036.234-.053.354-.051.116-.001.231.01.344.036.092.021.18.055.263.1a.757.757 0 0 1 .32.318.73.73 0 0 1 .09.347.81.81 0 0 1-.167.528.562.562 0 0 1-.12.114z"},child:[]}]})(s)}function gs(s){return F({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M6.306 2.146l-4.02 4.02v.708l4.02 4.02.708-.707L3.807 6.98H5.69c2.813 0 4.605.605 5.705 1.729 1.102 1.125 1.615 2.877 1.615 5.421v.35h1v-.35c0-2.646-.527-4.72-1.9-6.121C10.735 6.605 8.617 5.98 5.69 5.98H3.887l3.127-3.126-.708-.708z"},child:[]}]})(s)}function ps(){return e.jsx(e.Fragment,{children:T(3).map((s,a)=>e.jsxs("div",{className:"w-full cursor-pointer animate-pulse hover:bg-gray-300 transition-all h-24 bg-gray-200 rounded-md flex items-center px-2 py-2 gap-x-2.5 relative",children:[e.jsx("div",{className:"size-20 bg-gray-100 overflow-hidden grid z-10 rounded-full grid-cols-2 grid-rows-2"}),e.jsxs("div",{className:"w-4/6",children:[e.jsx("h4",{className:"w-3/4 h-2 mb-4 bg-gray-400 rounded-md"}),e.jsx("p",{className:"w-1/4 h-2 bg-gray-400 rounded-md"})]}),e.jsx("p",{className:"absolute right-2.5 bottom-2 w-14 h-2 bg-gray-400 rounded-md"})]},a))})}function ys({orderData:s,ordersType:a,onCloseModal:l}){const{orders:o,createdAt:t,orderId:d,totalPrice:n}=s,{selectedRoom:r,setMode:c,setSelectedMessage:h,messageMode:p,selectedMessage:u}=v(),{userId:f}=j(x=>x.userData),g=H();function i(){const x=M(),y=S(x,`rooms/${r.roomId}`);z(y,{members:[f,r.receiver.receiverId],messageList:[...(r==null?void 0:r.messageList)||[],{uiid:G(f),type:"order",senderId:f,createdAt:L(),order:{orderId:d,createdAt:t,totalPrice:n,thumbnails:o.items.map(b=>b.Thumbnail)},replyTo:p==="reply"?u.uiid:null,visibleTo:[f,r.receiver.receiverId]}]}),l(),h(null),c(null)}return e.jsxs("div",{onClick:()=>i(),className:"w-full cursor-pointer hover:bg-gray-300 transition-all h-28 bg-gray-200 rounded-md flex items-center px-2 py-2 gap-x-2.5 relative",children:[e.jsx("div",{className:"size-20 bg-gray-100 overflow-hidden grid z-10 rounded-full grid-cols-2 grid-rows-2",children:o.items.map(({Thumbnail:x},y)=>y<3&&e.jsx("img",{className:"size-full object-cover -z-10",src:x},y))}),e.jsxs("div",{className:"w-4/6",children:[e.jsx("h4",{className:"line-clamp-1 break-words font-bold mb-1.5 w-11/12",children:d}),e.jsxs("p",{className:"text-gray-800 font-semibold",children:["Prcie: $",n]})]}),e.jsx("button",{onClick:()=>g(a==="sells"?`/EcoVibe/Dashboard/orders/${d}`:"/EcoVibe/bag/orders"),className:"absolute right-2 top-1.5 text-2xl opacity-70 hover:opacity-100 transition-all",children:e.jsx(ms,{})}),e.jsx("p",{className:"absolute right-2.5 bottom-1 text-xs",children:W(t)})]})}function bs({onCloseModal:s}){const[{loading:a,orders:l,ordersType:o},t]=m.useState({loading:!1,orders:[],ordersType:"sells"}),[d,n]=m.useState(""),{selectedRoom:r}=v(),{userId:c,userType:h}=j(f=>f.userData);m.useEffect(()=>{t(f=>({...f,ordersType:h==="customer"?"purchases":"sells"}))},[h]);async function p(){try{t(x=>({...x,loading:!0}));const f=_(O(A,"Orders"),o==="purchases"?k("customerId","==",c):k("sellers","array-contains",c)),i=(await P(f).then(({docs:x})=>x.map(y=>({...y.data()})))).map(x=>({...x,orders:o==="purchases"?x.orders[r.receiver.receiverId]:x.orders[c]})).filter(x=>o==="purchases"?x.orders:x.customerId===r.receiver.receiverId);t(x=>({...x,loading:!1,orders:i}))}catch(f){t(g=>({...g,loading:!1})),console.log(f)}}m.useEffect(()=>{p()},[o]);function u(){return l.filter(({orderId:f})=>f.toLowerCase().includes(d.toLowerCase()))}return e.jsxs("div",{className:"size-full bg-gray-50 rounded-md px-2 py-2 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",onChange:({target:f})=>n(f.value),value:d,placeholder:"search orders",className:"px-4 py-2 w-full rounded-md outline-none bg-gray-50 border border-gray-300"}),e.jsxs("div",{className:`${h==="customer"&&"hidden"} mb-1 mt-2 flex items-center justify-between gap-x-1`,children:[e.jsx("button",{onClick:()=>t(f=>({...f,ordersType:"sells"})),className:`${o==="sells"&&"!border-gray-600"} px-4 py-3 w-1/2 h-full border-b-2 border-transparent transition-all`,children:"my sells"}),e.jsx("button",{onClick:()=>t(f=>({...f,ordersType:"purchases"})),className:`${o==="purchases"&&"!border-gray-600"} px-4 py-3 border-b-2 border-transparent w-1/2 h-full transition-all`,children:"my purchases"})]})]}),e.jsx("div",{className:"w-full overflow-auto h-full scroll-smooth styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-2 px-2 py-1",children:a?e.jsx(ps,{}):l.length?u().map((f,g)=>e.jsx(ys,{orderData:f,onCloseModal:s,ordersType:o},g)):e.jsx("h4",{className:"m-auto text-center my-20 text-lg font-semibold line-clamp-2",children:o==="sells"?"you have no orders from this customer":"you have no purchase this seller"})})})]})}function vs({onCloseModal:s}){const[a,l]=m.useState(null),{userId:o}=j(p=>p.userData),{messageMode:t,selectedMessage:d,setSelectedMessage:n,setMode:r,selectedRoom:c}=v();function h(){const p={location:a,senderId:o,createdAt:L(),uiid:G(o),type:"location",replyTo:t==="reply"?d.uiid:null,visibleTo:[o,c.receiver.receiverId]},u=M(),f=S(u,`rooms/${c.roomId}`);z(f,{messageList:[...(c==null?void 0:c.messageList)||[],p],members:[o,c.receiver.receiverId]}),s(),n(null),r(null)}return e.jsxs("div",{className:"size-full bg-gray-50 rounded-md relative",children:[e.jsx("div",{className:"w-full h-full rounded-t-md overflow-hidden",children:e.jsx(oe,{onClick:p=>l(p.latLng),defaultCenter:[35.77142984637282,51.46089654722849],defaultZoom:11,minZoom:3,maxZoom:10,children:a&&e.jsx(ie,{color:"#1632e9",width:50,anchor:a})})}),e.jsx("button",{disabled:!a,onClick:h,className:"px-4 py-2 bg-primary-500 rounded-2xl text-gray-50 disabled:bg-gray-400 transition-all absolute bottom-2 right-2",children:"Send Location"}),e.jsx("button",{onClick:()=>s(),className:"absolute top-1 right-1 bg-gray-100 p-1.5 text-xl rounded-full",children:e.jsx(q,{})})]})}function js({onCloseModal:s}){const[{loading:a,products:l,error:o},t]=m.useState({loading:!1,products:[],error:null}),{userId:d}=j(g=>g.userData),{selectedRoom:n,messageMode:r,selectedMessage:c,setSelectedMessage:h,setMode:p}=v();async function u(){try{t(x=>({...x,loading:!0}));const g=_(O(A,"Products"),k("SellerId","in",[d,n.receiver.receiverId])),i=await P(g).then(({docs:x})=>x.map(y=>({...y.data(),id:y.id})));t({loading:!1,products:i,error:!i.length&&404})}catch(g){t({loading:!1,products:[],error:g}),console.log(g)}}m.useEffect(()=>{u()},[]);function f(g){const i={senderId:d,createdAt:L(),uiid:G(d),replyTo:r==="reply"?c.uiid:null,type:"product",product:{id:g.id,thumbnail:g.Thumbnail,desc:g.Description,price:g.Price,name:g.Name},visibleTo:[d,n.receiver.receiverId]},x=M(),y=S(x,`rooms/${n.roomId}`);z(y,{messageList:[...(n==null?void 0:n.messageList)||[],i],members:[d,n.receiver.receiverId]}),s(),h(null),p(null)}return o?e.jsx("div",{className:"size-full bg-gray-50 rounded-md overflow-hidden px-2 py-1 flex flex-col justify-center items-center",children:e.jsx("h2",{className:"text-center font-medium text-lg",children:"No product related to you or your contact was found."})}):e.jsxs("div",{className:"size-full bg-gray-50 rounded-md overflow-hidden px-2 py-1 flex flex-col justify-evenly",children:[e.jsx("div",{className:"",children:e.jsx("input",{type:"text",placeholder:"Search Your Products",className:"w-full h-10 bg-gray-200 rounded-md px-4"})}),e.jsx("div",{className:"overflow-auto styled-scroll-bar h-5/6 px-2 py-1",children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a?T(5).map((g,i)=>e.jsxs("div",{className:"h-48 animate-pulse bg-gray-200 rounded-lg px-2 flex flex-col justify-evenly cursor-pointer",children:[e.jsx("div",{alt:"item-thumbnail",className:"w-full bg-gray-300 h-36 object-cover rounded-lg"}),e.jsx("h4",{className:"w-20 h-2 bg-gray-400 rounded-md"})]},i)):l==null?void 0:l.map((g,i)=>e.jsxs("div",{onClick:()=>f(g),className:"h-48 bg-gray-200 rounded-lg px-2 flex flex-col justify-evenly cursor-pointer",children:[e.jsx("img",{src:g.Thumbnail,alt:"item-thumbnail",className:"w-full h-36 object-cover rounded-lg"}),e.jsx("h4",{className:"line-clamp-1 text-sm font-bold",children:g.Name})]},i))})})]})}function Ns(){const{messageMode:s}=v(),[{modalIsShow:a,type:l},o]=m.useState({modalIsShow:!1,type:null});function t(){o({modalIsShow:!1,type:null})}return e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:s==="edit",className:"text-3xl disabled:opacity-50 text-gray-900 py-2 rounded-md peer",children:e.jsx(xs,{})}),e.jsxs("div",{className:"w-72 z-50 flex flex-col absolute bg-gray-100 -top-44 left-2 rounded-md opacity-0 invisible peer-disabled:hidden peer-hover:visible peer-hover:opacity-100 hover:visible hover:opacity-100 transition-all",children:[e.jsxs("button",{onClick:()=>o({modalIsShow:!0,type:"order"}),className:"px-4 py-4 hover:bg-gray-200 transition-all rounded-md flex items-center justify-start gap-x-2",children:[e.jsx("span",{children:e.jsx(hs,{})}),e.jsx("p",{children:"Share Order"})]}),e.jsxs("button",{onClick:()=>o({modalIsShow:!0,type:"location"}),className:"px-4 py-4 hover:bg-gray-200 transition-all rounded-md flex items-center justify-start gap-x-2",children:[e.jsx("span",{children:e.jsx(fs,{})}),e.jsx("p",{children:"Send Location"})]}),e.jsxs("button",{onClick:()=>o({modalIsShow:!0,type:"product"}),className:"px-4 py-4 hover:bg-gray-200 transition-all rounded-md flex items-center justify-start gap-x-2",children:[e.jsx("span",{children:e.jsx(ke,{})}),e.jsx("p",{children:"Send Product"})]})]}),e.jsxs("div",{className:`${a?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex items-center justify-center transition-all`,children:[e.jsx("div",{className:"w-80 h-[70vh] max-h-[30rem] lg:size-96 p-2",children:l==="order"?e.jsx(bs,{onCloseModal:t}):l==="location"?e.jsx(vs,{onCloseModal:t}):e.jsx(js,{onCloseModal:t})}),e.jsx("div",{onClick:()=>o({modalIsShow:!1,type:null}),className:"absolute inset-0 bg-gray-950/50 -z-10"})]})]})}function ws(){const{setSelectedMessage:s,selectedMessage:a,messageMode:l,setMode:o,selectedRoom:t}=v(),{first_name:d,last_name:n,business_name:r,userType:c}=(t==null?void 0:t.receiver)||{};return e.jsx("div",{className:`${l?"block":"hidden"} w-full h-20`,children:e.jsxs("div",{className:"size-full bg-gray-50 flex items-center gap-x-4 px-4 py-2",children:[e.jsx("p",{className:"text-3xl",children:l==="reply"?e.jsx(gs,{}):e.jsx(Le,{})}),e.jsxs("div",{className:"w-full h-full flex flex-col justify-evenly",children:[e.jsxs("h4",{className:"text-xl font-bold line-clamp-1",children:[l==="edit"?"Edit Message...":`Reply To ${c==="customer"?d+" "+n:r} `,`${a==null?void 0:a.type} Message`]}),e.jsx("p",{className:"text-sm line-clamp-2",children:(a==null?void 0:a.type)==="text"?a==null?void 0:a.content:a==null?void 0:a.type})]}),e.jsx("button",{onClick:()=>{s(null),o(null)},className:"text-3xl",children:e.jsx(q,{})})]})})}function Cs(){const[s,a]=m.useState(""),[l,o]=m.useState(1),{userId:t}=j(f=>f.userData),{setSelectedMessage:d,selectedMessage:n,messageMode:r,setMode:c,selectedRoom:h}=v();m.useEffect(()=>{const f=s==null?void 0:s.length,g=[180,260,350,440];o(U.findIndex(g,i=>f<=i)+1||10)},[s]),m.useEffect(()=>{r==="edit"&&a(n==null?void 0:n.content)},[r]);const p=()=>{const f={content:s,senderId:t,createdAt:L(),uiid:G(t),replyTo:r==="reply"?n.uiid:null,type:"text",visibleTo:[t,h.receiver.receiverId]},g=M(),i=S(g,`rooms/${h.roomId}`);z(i,{messageList:[...(h==null?void 0:h.messageList)||[],f],members:[t,h.receiver.receiverId]}),d(null),c(null),a("")},u=()=>{const f=[...h==null?void 0:h.messageList],g=f.findIndex(({uiid:y})=>y===n.uiid);f[g]={...f[g],content:s,isEdited:!0};const i=M(),x=S(i,`rooms/${h.roomId}`);z(x,{messageList:f}),d(null),c(null),a("")};return e.jsxs("div",{id:"input_message",className:`${r&&"min-h-36 flex flex-col"} w-full transition-all`,children:[e.jsx(ws,{}),e.jsxs("div",{className:"w-full bg-gray-50 px-4 pb-2 pt-1 flex items-end justify-between relative",children:[e.jsx(Ns,{}),e.jsx("textarea",{rows:l,value:s,onKeyDown:f=>{f.key==="Enter"&&s.length&&(f.preventDefault(),r==="edit"?u():p())},onChange:f=>{a(f.target.value)},type:"text",placeholder:"write new message",className:"px-4 py-2.5 resize-none transition-all min-h-12 flex-1 outline-none text-lg text-wrap bg-transparent styled-scroll-bar"}),e.jsx("button",{disabled:!s.length,onClick:()=>r==="edit"?u():p(),className:"text-4xl disabled:text-primary-950 disabled:opacity-50 text-primary-500 hover:text-primary-700 p-2 rounded-md",children:e.jsx(ze,{})})]})]})}function Is(){const[s,a]=m.useState(null);return m.useEffect(()=>{const l=()=>a(window.visualViewport.height);return window.addEventListener("resize",l),l(),()=>{window.removeEventListener("resize",l)}},[]),s}function Ss(s,a,l,o){m.useEffect(()=>{const t=(r,c)=>{const h=c==="move"?r.touches[0]:r.changedTouches[0],p=h.screenY-h.pageY;if(c==="move"&&p<87){const u=(h.pageY-h.screenY)/50+1.5,f=Math.min(Math.max(u*85,0),180);l({opacity:u/3,rotate:f})}c==="end"&&(p<-20?a(null):p<87&&(o.current.scrollIntoView({block:"start",behavior:"smooth"}),l({rotate:0,opacity:0})))},d=r=>t(r,"move"),n=r=>t(r,"end");return window.addEventListener("touchmove",d),window.addEventListener("touchend",n),()=>{window.removeEventListener("touchmove",d),window.removeEventListener("touchend",n)}},[s,a,l,o])}function Ms({deleteRoom:s}){var u;const a=m.useRef(),{selectedRoom:l,setSelectedRoom:o,rooms:t}=v(),d=Is(),[{opacity:n,rotate:r},c]=m.useState({opacity:0,rotate:0});Ss(l,o,c,a);const[h,p]=m.useState(!1);if(!l)return e.jsx("div",{className:"hidden w-3/4 bg-slate-200 lg:flex items-center justify-center relative",children:e.jsx("p",{className:"text-lg font-bold bg-gray-50/50 backdrop-blur-sm px-4 py-2 rounded-xl cursor-pointer",children:"Please Select A Chat First..."})});if(l)return e.jsxs("div",{style:{height:d},className:`${l?"w-full flex":"hid den"} lg:! flex flex-col lg:w-3/4 !w-full h-full bg-slate-200 items-center justify-center relative`,children:[e.jsx("div",{ref:a,className:"w-full",children:e.jsx(rs,{deleteRoom:s,setShowAlert:p})}),e.jsx(us,{}),e.jsx(Cs,{}),e.jsxs("div",{style:{opacity:n},className:"absolute w-full h-32 -bottom-32 z-50 transition-all flex items-center justify-center gap-x-2",children:[e.jsx("p",{style:{rotate:`${r}deg`},className:"transition-all text-3xl rotate-180 duration-700",children:e.jsx(De,{})}),e.jsx("h4",{className:"text-xl font-bold",children:"Return to Chats"})]}),e.jsxs("div",{className:`${h?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex justify-center items-center transition-all`,children:[e.jsx(X,{action:`Delete chat with ${(u=l==null?void 0:l.receiver)==null?void 0:u.first_name} ?`,closeModal:()=>p(!1),message:"Are You Sure You Want To Delete This Chat?, you cannot access messages again...",submitCallBack:()=>s(l.roomId,t)}),e.jsx("div",{onClick:()=>p(!1),className:"absolute inset-0 bg-gray-950/50 -z-10"})]})]})}function ks({user:s,searchType:a,orders:l,onCloseModal:o}){const[t,d]=m.useState(null),{userType:n}=j(i=>i.userData),{personalInformation:r,businessInformation:c,userId:h}=s||{},p=H(),{setSelectedRoom:u}=v(),{createRoom:f}=Fe();m.useEffect(()=>{if(a==="orders"){const i=l==null?void 0:l.filter(({customerId:y,sellers:b})=>n!=="customer"?y===h:b.includes(h)),x=i.reduce((y,b)=>b.createdAt.seconds>y.createdAt.seconds?b:y,i[0]);d(x)}},[a,l,s]);const g=()=>{const i={...s.personalInformation,...s.businessInformation,userId:s.userId,userType:s.userType};f(i,({roomId:x})=>{u({roomId:x,owner:{...r,...c,userType:n,userId:h},receiver:{...i,receiverId:i.userId},members:[h,s.userId]}),o()})};return e.jsxs("div",{onClick:g,className:"w-full h-28 flex items-center px-4 py-2 gap-x-4 cursor-pointer hover:bg-gray-200 transition-all rounded-xl",children:[r.profilePic?e.jsx("img",{src:r.profilePic,className:"size-20 bg-gray-100 rounded-full"}):e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(E,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-y-1.5",children:[e.jsx("h4",{className:"line-clamp-1 w-40 text-lg font-bold break-words",children:r.first_name+" "+r.last_name}),e.jsx("p",{className:"text-sm line-clamp-2 font-semibold",children:a==="orders"?e.jsxs("div",{onClick:()=>p(n==="customer"?`/EcoVibe/bag/orders/${t.orderId.replace("#","")}/${h}`:`/EcoVibe/Dashboard/orders/${t.orderId.replace("#","")}`),className:"hover:opacity-80 transition-all",children:["last order:",e.jsx("p",{className:"line-clamp-1 w-40 break-words",children:t==null?void 0:t.orderId})]}):e.jsx(e.Fragment,{children:(c==null?void 0:c.business_name)||(c==null?void 0:c.career_title)||"seller"})})]})]})}function Ls(){return e.jsxs("div",{className:"w-80 lg:w-96 h-[90vh] 2xl:h-[45rem] bg-gray-50 rounded-md z-10 p-2 flex flex-col",children:[e.jsx("div",{className:"flex bg-gray-200 rounded-md relative",children:e.jsx("input",{disabled:!0,type:"text",placeholder:"search contacts",className:"w-full px-4 py-2 bg-transparent placeholder:text-gray-600 outline-none rounded-md"})}),e.jsx("div",{className:"flex-1 overflow-auto h-[27rem] xl:h-[35rem] styled-scroll-bar my-2",children:e.jsx("div",{className:"inline-flex flex-col w-full gap-y-4 h-full",children:T(20).map((s,a)=>e.jsxs("div",{className:"w-full animate-pulse h-28 flex items-center px-4 py-2 gap-x-4 cursor-pointer hover:bg-gray-200 transition-all rounded-xl",children:[e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(E,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-y-2.5",children:[e.jsx("p",{className:"w-36 h-2 bg-gray-300 rounded-md"}),e.jsx("p",{className:"w-24 h-2 bg-gray-300 rounded-md"})]})]},a))})})]})}function zs({searchQuery:s,setQuery:a,menuIsShow:l,setTab:o,searchType:t}){const d=m.useRef();B(d,()=>o(r=>({...r,menuIsShow:!1})));const{userType:n}=j(r=>r.userData);return e.jsxs("div",{className:"flex bg-gray-200 rounded-md relative",children:[e.jsx("input",{type:"text",value:s,onChange:({target:r})=>a(r.value.toLocaleLowerCase()),placeholder:"search contacts",className:"w-full px-4 py-2 bg-transparent placeholder:text-gray-600 outline-none rounded-md"}),e.jsxs("div",{ref:d,children:[e.jsx("button",{onClick:()=>o(r=>({...r,menuIsShow:!0})),className:"px-2 h-full text-2xl hover:text-gray-500 transition-all",children:e.jsx(Re,{})}),e.jsxs("div",{className:`${l?"translate-y-0 opacity-100 visible":"-translate-y-10 opacity-0 invisible"} absolute top-14 transition-all right-0 w-48 h-24 bg-gray-100 justify-evenly px-2 py-1 rounded-md flex flex-col`,children:[e.jsx("div",{className:"tooltip absolute -top-1 right-8 bg-gray-200"}),e.jsx("button",{onClick:()=>o({menuIsShow:!1,searchType:"all"}),className:`${t==="all"&&"bg-gray-300"} px-4 py-2 rounded-md hover:bg-gray-200 transition-all`,children:"All Sellers"}),e.jsx("hr",{}),e.jsx("button",{onClick:()=>o({menuIsShow:!1,searchType:"orders"}),className:`${t==="orders"&&"bg-gray-300"} px-4 py-2 rounded-md hover:bg-gray-200 transition-all`,children:n==="customer"?"From my purchases":"My Customers"})]})]})]})}function Ds({onCloseModal:s}){const[{menuIsShow:a,searchType:l},o]=m.useState({searchType:"all",menuIsShow:!1}),[t,d]=m.useState(""),[{loading:n,userList:r},c]=m.useState({userList:[],loading:!1}),[h,p]=m.useState([]),{userType:u,userId:f}=j(x=>x.userData);async function g(){if(l==="orders")try{const x=_(O(A,"Orders"),u!=="customer"?k("sellers","array-contains",f):k("customerId","==",f)),y=await P(x).then(({docs:w})=>w.map(N=>N.data()));p(y);const b=y.flatMap(({sellers:w,customerId:N})=>u!=="customer"?N:U.uniq(w));return u==="customer"?b:U.uniq(b)}catch(x){console.log(x)}}m.useEffect(()=>{async function x(){try{c(N=>({...N,loading:!0}));const y=await g(),b=_(O(A,"users"),l==="all"?k("userType","in",["seller","both"]):k("userId","in",y)),w=await P(b).then(({docs:N})=>N.map(C=>C.data()).filter(C=>C.userId!==f));c({userList:w,loading:!1,error:null})}catch(y){c({userList:[],loading:!1,error:y}),console.log(y)}}x()},[l]);function i(x){let y=[];return y=r.filter(b=>{const{personalInformation:w,businessInformation:N}=b,{first_name:C,last_name:R}=w||{},{business_name:$}=N||{};if(C.toLowerCase().includes(x)||R!=null&&R.toLowerCase().includes(x)||$!=null&&$.toLowerCase().includes(t))return b}),x!==""?y:r}if(n)return e.jsx(Ls,{});if(!n)return e.jsxs("div",{className:"w-80 lg:w-96 h-[90vh] 2xl:h-[45rem] bg-gray-50 rounded-md z-10 p-2 flex flex-col",children:[e.jsx(zs,{searchQuery:t,setQuery:d,menuIsShow:a,setTab:o,searchType:l}),e.jsx("div",{className:"flex-1 overflow-auto h-[27rem] xl:h-[35rem] styled-scroll-bar my-2",children:e.jsx("div",{className:"inline-flex flex-col w-full gap-y-4 h-full",children:r.length?i(t).map((x,y)=>e.jsx(ks,{user:x,searchType:l,orders:h,onCloseModal:s},y)):e.jsxs("h4",{className:"text-xl font-bold text-center flex-1 flex items-center justify-center",children:["You have no  ",u==="customer"?"order yet...":"customer yet",", you can change filter to all sellers"]})})})]})}function Bs(){const[s,a]=m.useState(!1),[l,o]=m.useState(!1),{userId:t}=j(n=>n.userData);function d(n,r){var f,g;const c=r.findIndex(i=>i.roomId===n),h={...r[c]},p=M(),u=S(p,`rooms/${h.roomId}`);((f=h.members)==null?void 0:f.length)<2?Pe(u):(z(u,{members:h.members.filter(i=>i!==t),messageList:((g=h.messageList)==null?void 0:g.map(i=>({...i,visibleTo:i.visibleTo.filter(x=>x!==t)})))||[]}),V.success("Room Is Deleted Successfully"))}return e.jsx(He,{children:e.jsx("div",{className:"mx-auto 2xl:max-w-screen-2xl fixed inset-0 z-50",children:e.jsxs("div",{className:"lg:flex justify-between h-full",children:[e.jsx(Ze,{onCloseNav:()=>a(!1),navIsShow:s,openContacts:()=>o(!0)}),e.jsxs("div",{className:"flex-1 flex h-full",children:[e.jsx(Ue,{openSideNav:()=>a(!0),deleteRoom:d}),e.jsx(Ms,{deleteRoom:d}),e.jsxs("div",{className:`${l?"opacity-100 visible":"opacity-0 invisible"} inset-0 fixed flex items-center justify-center z-50 transition-all`,children:[e.jsx(Ds,{onCloseModal:()=>o(!1)}),e.jsx("div",{onClick:()=>o(!1),className:"absolute inset-0 bg-gray-950/85 backdrop-blur-sm"})]})]})]})})})}export{Bs as default};
