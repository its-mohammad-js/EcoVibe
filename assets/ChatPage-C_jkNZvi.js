import{R as w,H as Ke,r as p,I as L,a as S,u as J,J as Ue,K as O,M as A,N as qe,O as re,_ as G,P as Ze,Q as B,S as Ge,T as We,U as Qe,j as e,h as V,D as H,z as Y,E as M,F as K,s as Xe,V as ge,C as Je,W as Ne,X as D,g as oe,Y as et}from"./index-BGjCLYIN.js";import{A as Re,a as T,b as tt,c as ce,d as st,e as rt,f as at,g as lt,h as Ee,i as nt,j as de,k as we,l as it,m as ot}from"./index-Da7aTm6r.js";import{u as q}from"./UseOutsideClick-DqT6tEuw.js";import{a as ct}from"./index-BmpGcSe0.js";import{u as dt}from"./useTouchScroll-BpsbR2Lp.js";import{R as ut}from"./index-C8xwp051.js";import{l as ae}from"./lodash-HxmBhAOq.js";import{f as F,p as W,c as le,G as ft,i as te,D as xt,L as xe,P as mt,A as ht,a as se,b as pt,d as gt,g as Se,l as yt,e as Ce,h as bt,j as Ae,k as vt,m as jt,R as Nt}from"./generateCategoricalChart-CUvsjC-F.js";import{G as Z}from"./iconBase-CGqGdPX7.js";import{M as De,a as ze}from"./index.esm-BKqNwMW6.js";import{b as wt}from"./index-BW_i14_f.js";import{a as St,b as Ct}from"./index-D3JxxZ2c.js";import{u as It}from"./useCreateChatRoom-C6nazDGr.js";import"./index-CnyDuYXe.js";import"./index-Chjiymov.js";var Pt=["cx","cy","innerRadius","outerRadius","gridType","radialLines"];function Q(t){"@babel/helpers - typeof";return Q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},Q(t)}function Ot(t,s){if(t==null)return{};var r=Lt(t,s),l,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)l=i[a],!(s.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(t,l)&&(r[l]=t[l])}return r}function Lt(t,s){if(t==null)return{};var r={},l=Object.keys(t),a,i;for(i=0;i<l.length;i++)a=l[i],!(s.indexOf(a)>=0)&&(r[a]=t[a]);return r}function z(){return z=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},z.apply(this,arguments)}function Ie(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);s&&(l=l.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,l)}return r}function X(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?Ie(Object(r),!0).forEach(function(l){Mt(t,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ie(Object(r)).forEach(function(l){Object.defineProperty(t,l,Object.getOwnPropertyDescriptor(r,l))})}return t}function Mt(t,s,r){return s=kt(s),s in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function kt(t){var s=Rt(t,"string");return Q(s)=="symbol"?s:String(s)}function Rt(t,s){if(Q(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var l=r.call(t,s||"default");if(Q(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var Et=function(s,r,l,a){var i="";return a.forEach(function(n,o){var d=W(r,l,s,n);o?i+="L ".concat(d.x,",").concat(d.y):i+="M ".concat(d.x,",").concat(d.y)}),i+="Z",i},At=function(s){var r=s.cx,l=s.cy,a=s.innerRadius,i=s.outerRadius,n=s.polarAngles,o=s.radialLines;if(!n||!n.length||!o)return null;var d=X({stroke:"#ccc"},F(s,!1));return w.createElement("g",{className:"recharts-polar-grid-angle"},n.map(function(f){var g=W(r,l,a,f),m=W(r,l,i,f);return w.createElement("line",z({},d,{key:"line-".concat(f),x1:g.x,y1:g.y,x2:m.x,y2:m.y}))}))},Dt=function(s){var r=s.cx,l=s.cy,a=s.radius,i=s.index,n=X(X({stroke:"#ccc"},F(s,!1)),{},{fill:"none"});return w.createElement("circle",z({},n,{className:le("recharts-polar-grid-concentric-circle",s.className),key:"circle-".concat(i),cx:r,cy:l,r:a}))},zt=function(s){var r=s.radius,l=s.index,a=X(X({stroke:"#ccc"},F(s,!1)),{},{fill:"none"});return w.createElement("path",z({},a,{className:le("recharts-polar-grid-concentric-polygon",s.className),key:"path-".concat(l),d:Et(r,s.cx,s.cy,s.polarAngles)}))},$t=function(s){var r=s.polarRadius,l=s.gridType;return!r||!r.length?null:w.createElement("g",{className:"recharts-polar-grid-concentric"},r.map(function(a,i){var n=i;return l==="circle"?w.createElement(Dt,z({key:n},s,{radius:a,index:i})):w.createElement(zt,z({key:n},s,{radius:a,index:i}))}))},$e=function(s){var r=s.cx,l=r===void 0?0:r,a=s.cy,i=a===void 0?0:a,n=s.innerRadius,o=n===void 0?0:n,d=s.outerRadius,f=d===void 0?0:d,g=s.gridType,m=g===void 0?"polygon":g,x=s.radialLines,h=x===void 0?!0:x,c=Ot(s,Pt);return f<=0?null:w.createElement("g",{className:"recharts-polar-grid"},w.createElement(At,z({cx:l,cy:i,innerRadius:o,outerRadius:f,gridType:m,radialLines:h},c)),w.createElement($t,z({cx:l,cy:i,innerRadius:o,outerRadius:f,gridType:m,radialLines:h},c)))};$e.displayName="PolarGrid";var me,Pe;function Tt(){if(Pe)return me;Pe=1;function t(s){return s&&s.length?s[0]:void 0}return me=t,me}var he,Oe;function _t(){return Oe||(Oe=1,he=Tt()),he}var Ft=_t();const Bt=Ke(Ft);function U(t){"@babel/helpers - typeof";return U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},U(t)}function ne(){return ne=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},ne.apply(this,arguments)}function Le(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);s&&(l=l.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,l)}return r}function I(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?Le(Object(r),!0).forEach(function(l){E(t,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Le(Object(r)).forEach(function(l){Object.defineProperty(t,l,Object.getOwnPropertyDescriptor(r,l))})}return t}function Vt(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}function Me(t,s){for(var r=0;r<s.length;r++){var l=s[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,_e(l.key),l)}}function Ht(t,s,r){return s&&Me(t.prototype,s),r&&Me(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Yt(t,s,r){return s=ie(s),Kt(t,Te()?Reflect.construct(s,r||[],ie(t).constructor):s.apply(t,r))}function Kt(t,s){if(s&&(U(s)==="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _(t)}function Te(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Te=function(){return!!t})()}function ie(t){return ie=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ie(t)}function _(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ut(t,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(s&&s.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),s&&pe(t,s)}function pe(t,s){return pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,a){return l.__proto__=a,l},pe(t,s)}function E(t,s,r){return s=_e(s),s in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function _e(t){var s=qt(t,"string");return U(s)=="symbol"?s:String(s)}function qt(t,s){if(U(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var l=r.call(t,s||"default");if(U(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var ee=function(t){Ut(s,t);function s(){var r;Vt(this,s);for(var l=arguments.length,a=new Array(l),i=0;i<l;i++)a[i]=arguments[i];return r=Yt(this,s,[].concat(a)),E(_(r),"state",{isAnimationFinished:!1}),E(_(r),"handleAnimationEnd",function(){var n=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),te(n)&&n()}),E(_(r),"handleAnimationStart",function(){var n=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),te(n)&&n()}),E(_(r),"handleMouseEnter",function(n){var o=r.props.onMouseEnter;o&&o(r.props,n)}),E(_(r),"handleMouseLeave",function(n){var o=r.props.onMouseLeave;o&&o(r.props,n)}),r}return Ht(s,[{key:"renderDots",value:function(l){var a=this.props,i=a.dot,n=a.dataKey,o=F(this.props,!1),d=F(i,!0),f=l.map(function(g,m){var x=I(I(I({key:"dot-".concat(m),r:3},o),d),{},{dataKey:n,cx:g.x,cy:g.y,index:m,payload:g});return s.renderDotItem(i,x)});return w.createElement(xe,{className:"recharts-radar-dots"},f)}},{key:"renderPolygonStatically",value:function(l){var a=this.props,i=a.shape,n=a.dot,o=a.isRange,d=a.baseLinePoints,f=a.connectNulls,g;return w.isValidElement(i)?g=w.cloneElement(i,I(I({},this.props),{},{points:l})):te(i)?g=i(I(I({},this.props),{},{points:l})):g=w.createElement(mt,ne({},F(this.props,!0),{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,points:l,baseLinePoints:o?d:null,connectNulls:f})),w.createElement(xe,{className:"recharts-radar-polygon"},g,n?this.renderDots(l):null)}},{key:"renderPolygonWithAnimation",value:function(){var l=this,a=this.props,i=a.points,n=a.isAnimationActive,o=a.animationBegin,d=a.animationDuration,f=a.animationEasing,g=a.animationId,m=this.state.prevPoints;return w.createElement(ht,{begin:o,duration:d,isActive:n,easing:f,from:{t:0},to:{t:1},key:"radar-".concat(g),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(x){var h=x.t,c=m&&m.length/i.length,u=i.map(function(y,b){var v=m&&m[Math.floor(b*c)];if(v){var j=se(v.x,y.x),C=se(v.y,y.y);return I(I({},y),{},{x:j(h),y:C(h)})}var k=se(y.cx,y.x),R=se(y.cy,y.y);return I(I({},y),{},{x:k(h),y:R(h)})});return l.renderPolygonStatically(u)})}},{key:"renderPolygon",value:function(){var l=this.props,a=l.points,i=l.isAnimationActive,n=l.isRange,o=this.state.prevPoints;return i&&a&&a.length&&!n&&(!o||!pt(o,a))?this.renderPolygonWithAnimation():this.renderPolygonStatically(a)}},{key:"render",value:function(){var l=this.props,a=l.hide,i=l.className,n=l.points,o=l.isAnimationActive;if(a||!n||!n.length)return null;var d=this.state.isAnimationFinished,f=le("recharts-radar",i);return w.createElement(xe,{className:f},this.renderPolygon(),(!o||d)&&gt.renderCallByParent(this.props,n))}}],[{key:"getDerivedStateFromProps",value:function(l,a){return l.animationId!==a.prevAnimationId?{prevAnimationId:l.animationId,curPoints:l.points,prevPoints:a.curPoints}:l.points!==a.curPoints?{curPoints:l.points}:null}},{key:"renderDotItem",value:function(l,a){var i;return w.isValidElement(l)?i=w.cloneElement(l,a):te(l)?i=l(a):i=w.createElement(xt,ne({},a,{className:le("recharts-radar-dot",typeof l!="boolean"?l.className:"")})),i}}]),s}(p.PureComponent);E(ee,"displayName","Radar");E(ee,"defaultProps",{angleAxisId:0,radiusAxisId:0,hide:!1,activeDot:!0,dot:!1,legendType:"rect",isAnimationActive:!ft.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});E(ee,"getComposedData",function(t){var s=t.radiusAxis,r=t.angleAxis,l=t.displayedData,a=t.dataKey,i=t.bandSize,n=r.cx,o=r.cy,d=!1,f=[],g=r.type!=="number"?i??0:0;l.forEach(function(x,h){var c=Se(x,r.dataKey,h),u=Se(x,a),y=r.scale(c)+g,b=Array.isArray(u)?yt(u):u,v=Ce(b)?void 0:s.scale(b);Array.isArray(u)&&u.length>=2&&(d=!0),f.push(I(I({},W(n,o,v,y)),{},{name:c,value:u,cx:n,cy:o,radius:v,angle:y,payload:x}))});var m=[];return d&&f.forEach(function(x){if(Array.isArray(x.value)){var h=Bt(x.value),c=Ce(h)?void 0:s.scale(h);m.push(I(I({},x),{},{radius:c},W(n,o,c,x.angle)))}else m.push(x)}),{points:f,isRange:d,baseLinePoints:m}});var Zt=bt({chartName:"RadarChart",GraphicalChild:ee,axisComponents:[{axisType:"angleAxis",AxisComp:Ae},{axisType:"radiusAxis",AxisComp:vt}],formatAxisMap:jt,defaultProps:{layout:"centric",startAngle:90,endAngle:-270,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});function Fe(){const[t,s]=p.useState(null);return p.useEffect(()=>{const r=()=>s(window.visualViewport.height);return window.addEventListener("resize",r),r(),()=>{window.removeEventListener("resize",r)}},[]),{appHeight:t}}function Gt(t){const s=L(),[{status:r,rooms:l},a]=p.useState({rooms:[],status:null}),{userId:i,auth_status:n,loading:o}=S(g=>g.userData),d=J();function f(){const g=B(O(s,"rooms"),We(`${i}/userId`),Ge(i));re(g,m=>{if(!m.exists()){a({rooms:[],status:"No Conversations Yet..."});return}const h=Object.entries(m.val()).map(([c,u])=>({...u,roomId:c})).filter(({members:c})=>c.includes(i)).map(c=>{var b,v,j;const u=((b=c==null?void 0:c.members)==null?void 0:b.find(C=>C!==i))||Object.keys(c).find(C=>![i,"roomId","messageList","members"].includes(C));if(((v=c[i])==null?void 0:v.last_seen)||((j=c==null?void 0:c.messageList)==null?void 0:j.length)>0)return{roomId:c.roomId,messageList:c.messageList||null,members:c.members,owner:c[i],receiver:{...c[u],receiverId:u}}});a({rooms:h.filter(c=>c),status:h.length?null:"No Conversations Yet..."})})}return p.useEffect(()=>{t&&i&&Ue(O(s,`rooms/${t.roomId}/${i}/last_seen`)).set({date:A(),offline:!0})},[t,i]),p.useEffect(()=>{if(n===200){qe(s);const g=O(s,".info/connected");re(g,m=>{m.val()===!0&&!o?f():a({rooms:[],status:"loading..."})})}else n===401&&(G("Create an account to join the chat!"),d("/EcoVibe/Customers/sign-up"));return()=>{Ze(s),a({rooms:[],status:null})}},[i]),{status:r,rooms:l}}const Be=p.createContext();function Wt({children:t}){var x;const[s,r]=p.useState(null),{status:l,rooms:a}=Gt(s),[i,n]=p.useState(null),[o,d]=p.useState(null),f=J(),g=Qe(),m=(x=g==null?void 0:g.state)==null?void 0:x.roomId;return p.useEffect(()=>{s&&f(g.pathname,{roomId:null})},[s]),p.useEffect(()=>{if(m){const h=a.find(c=>c.roomId===m);r(h)}else s&&r(a.find(h=>h.roomId===s.roomId))},[m,a]),p.useEffect(()=>{!s&&!m&&(n(null),d(null))},[m,s]),e.jsx(Be.Provider,{value:{rooms:a,status:l,selectedRoom:s,setSelectedRoom:r,selectedMessage:i,setSelectedMessage:n,messageMode:o,setMode:d},children:t})}const N=()=>p.useContext(Be);function ye({action:t,backTitle:s,sureTitle:r,message:l,closeModal:a,submitCallBack:i}){return e.jsxs("div",{className:"bg-gray-50 px-4 py-2 rounded-md flex flex-col gap-y-2 w-80 lg:w-96 xl:w-[30rem]",children:[e.jsx("h4",{className:"text-lg xl:text-2xl font-bold",children:t||"Alert"}),e.jsx("p",{className:"line-clamp-6",children:l||"Are You Sure?"}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx("button",{onClick:()=>a(),className:"px-4 py-2 text-lg hover:bg-gray-200 transition-all rounded-md",children:s||"Cancel"}),e.jsx("button",{onClick:()=>{i(),a()},className:"px-4 py-2 text-lg hover:bg-gray-200 transition-all rounded-md",children:r||"Im Sure"})]})]})}function Qt({deleteRoom:t,room:s,position:r,setContextMenu:l,contextMenu:a}){const i=p.useRef();q(i,()=>l(!1));const{setSelectedRoom:n,rooms:o}=N(),[d,f]=p.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{top:r.y||0,left:r.x/1.7||0},ref:i,className:`${a?"opacity-100 visible":"opacity-0 invisible"} fixed rounded-md transition-all overflow-hidden z-50 top-24 flex flex-col`,children:[e.jsxs("button",{onClick:()=>{const g=o.find(({roomId:m})=>m===s.roomId);n(g),l(!1)},className:"p-4 bg-gray-100 hover:bg-gray-200 transition-all flex items-center gap-x-2",children:[e.jsx(ct,{className:"text-2xl"}),"open Chat"]}),e.jsxs("button",{onClick:()=>{f(!0),l(!1)},className:"p-4 bg-gray-100 hover:bg-gray-200 transition-all flex items-center gap-x-2 text-red-500",children:[e.jsx(Re,{className:"text-2xl"}),"delete chat"]})]}),e.jsxs("div",{className:`${d?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex justify-center items-center transition-all`,children:[e.jsx(ye,{action:"Delete Chat Room",closeModal:()=>f(!1),message:"Are You Sure You Want To Delete This Chat?, you cannot access messages again...",submitCallBack:()=>t(s.roomId,o)}),e.jsx("div",{onClick:()=>f(!1),className:"absolute inset-0 bg-gray-950/50 -z-10"})]})]})}const ke=({room:t,mode:s,deleteRoom:r})=>{var ve,je;const{profilePic:l,last_seen:a,first_name:i,last_name:n,business_name:o,userType:d}=t.receiver,[f,g]=p.useState(!1),m=p.useRef();q(m,()=>g(!1));const[x,h]=p.useState({x:0,y:0}),{content:c,createdAt:u,type:y}=((ve=t.messageList)==null?void 0:ve.at(-1))||{},[b,v]=p.useState(""),{selectedRoom:j,setSelectedRoom:C,setSelectedMessage:k,rooms:R}=N(),[ue,be]=p.useState(!1);p.useEffect(()=>{const P=new Date(u),$=new Date;P.getFullYear()===$.getFullYear()&&P.getMonth()===$.getMonth()&&P.getDate()===$.getDate()?v(P.toLocaleTimeString("en-us",{month:"2-digit",hour:"2-digit",minute:"2-digit"})):v(P.toDateString())},[u]);function Ve(){var $;k(s==="message"?($=t.messageList)==null?void 0:$.at(-1):null),s==="message"&&setTimeout(()=>{k(null)},2e3);const P=R.find(({roomId:fe})=>fe===t.roomId);C(P)}return p.useEffect(()=>{if(!a){be(!0);return}const P=L(),$=re(O(P,".info/serverTimeOffset"),fe=>{const He=Date.now()+fe.val()-(a==null?void 0:a.date),Ye=Math.floor(He/1e3);be(Ye>=30||(a==null?void 0:a.offline))});return()=>$()},[a,j]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{onContextMenu:P=>{P.preventDefault(),h({x:P.clientX,y:P.clientY}),g(!f)},onClick:()=>Ve(),className:"w-full h-24 relative select-none rounded-md flex items-center hover:bg-gray-300/30 transition-all cursor-pointer gap-x-2 px-4 py-2",children:[e.jsxs("div",{className:"relative",children:[l?e.jsx("img",{src:l,className:"size-20 bg-gray-100 rounded-full"}):e.jsx("div",{className:"size-full lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(T,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})}),e.jsx("div",{className:`
              ${ue?"bg-gray-400":"bg-green-400"} ${s==="message"&&"hidden"} absolute -bottom-1 size-5 right-1 rounded-full transition-all`})]}),e.jsxs("div",{className:"flex flex-col mt-2.5 justify-center h-full w-2/3 select-none",children:[e.jsx("h6",{className:"line-clamp-2 font-bold md:text-lg break-words text-gray-800",children:d==="customer"?i+" "+n:o||i||"uknown user name!"}),e.jsx("p",{className:"line-clamp-1 text-gray-700 break-words max-w-56",children:(je=t==null?void 0:t.messageList)!=null&&je.length?y==="text"?c:y:"Nothing yet"}),e.jsx("p",{className:"absolute top-2 right-2 text-sm text-gray-700",children:u?b:""})]})]}),e.jsx(Qt,{deleteRoom:r,room:t,position:x,setContextMenu:g,contextMenu:f})]})};function Xt({openSideNav:t,deleteRoom:s}){const[r,l]=p.useState(""),{rooms:a,setSelectedRoom:i,selectedRoom:n,status:o}=N(),{loading:d}=S(h=>h.userData);dt(".contacts-container");const{appHeight:f}=Fe(),g=p.useRef();function m(h){const c=h.toLowerCase();return a.flatMap(({messageList:u,roomId:y,receiver:b})=>u==null?void 0:u.filter(v=>{var j;return(j=v==null?void 0:v.content)==null?void 0:j.toLowerCase().includes(c)}).map(v=>({messageList:[v],roomId:y,receiver:b})))}function x(h){const c=h.toLowerCase();return a.filter(({receiver:u})=>[u==null?void 0:u.business_name,u==null?void 0:u.first_name,u==null?void 0:u.last_name].some(y=>y==null?void 0:y.toLowerCase().includes(c)))}return e.jsxs("div",{style:{height:document.activeElement!==g.current?f:"100vh"},className:`${n&&"hidden"} ${r.length&&""} lg:!flex lg:col-span-3 w-full bg-gray-50 flex flex-col`,children:[e.jsxs("div",{className:"",children:[e.jsx("div",{className:"bg-gray-50 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-1.5 cursor-pointer relative",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Messages"}),e.jsx("button",{onClick:()=>t(),className:"absolute -left-2 p-1.5 rounded-full text-4xl hover:text-gray-700 transition-all",children:e.jsx(tt,{})})]})}),e.jsx("div",{className:"w-full px-4 pb-2 pt-3",children:e.jsx("input",{ref:g,onChange:({target:h})=>{var c;l((c=h.value)==null?void 0:c.toLowerCase())},type:"text",value:r,placeholder:"Search Messages & Contacts",className:"py-2.5 bg-gray-200 w-full outline-none px-4 rounded-lg placeholder:text-gray-500"})})]}),e.jsx("div",{className:`${!x(r).length||!(r!=null&&r.length)?"hidden":"basis-[19%] min-h-32"} overflow-x-auto overflow-y-hidden mx-auto flex justify-start w-full px-4 gap-3 py-1 hidden-scroll-bar contacts-container`,children:r&&e.jsx("div",{className:"flex items-center gap-x-4 select-none flex-none",children:x(r).map((h,c)=>{var u;return e.jsxs("div",{className:"w-24 gap-y-1 flex flex-col items-center justify-center",children:[e.jsx("div",{onClick:()=>i(h),className:"cursor-pointer",children:(u=h.receiver)!=null&&u.profilePic?e.jsx("img",{src:h.receiver.profilePic,className:"size-20 bg-gray-100 rounded-full"}):e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(T,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})})}),e.jsx("p",{onClick:()=>i(h),className:"line-clamp-2 break-words w-10/12 text-sm text-center cursor-pointer",children:h.receiver.userType==="customer"?h.receiver.first_name+" "+h.receiver.last_name:h.receiver.business_name})]},c)})})}),e.jsxs("div",{className:`${r!=null&&r.length?"basis-[55%] lg:basis-[65%]":"basis-[76%] lg:basis-[83%]"} flex flex-col flex-none overflow-auto relative styled-scroll-bar`,children:[e.jsxs("h2",{className:`${!(r!=null&&r.length)&&"hidden"} block px-4 sticky top-0 z-10 py-1 w-full bg-gray-200`,children:["Found ",m(r).length," Messages"]}),d||o?e.jsx("h4",{className:"px-2 py-1 absolute top-1/2 w-full flex justify-center",children:e.jsx("p",{className:"px-4 py-1 text-lg font-bold bg-gray-200/80 rounded-xl",children:o||"loading..."})}):r?m(r).map((h,c)=>e.jsx(ke,{room:h,mode:"message"},c)):a.map((h,c)=>e.jsx(ke,{room:h,mode:"user",deleteRoom:s},c))]})]})}function Jt({onCloseNav:t,navIsShow:s,openContacts:r}){const{personalInformation:l,userType:a,userId:i,loading:n}=S(f=>f.userData),{auth_status:o}=S(f=>f.userData),d=J();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${s?"translate-x-0 opacity-100 visible":"-translate-x-16 opacity-0 invisible"} absolute transition-all ease-linear z-50 max-w-20 h-full bg-gray-50 px-4 py-4 flex flex-col items-center gap-y-6 border-r-2 rounded-r-2xl`,children:[e.jsx("button",{onClick:()=>t(),className:"px-2 py-2 bg-primary-500 text-gray-50 text-xl rounded-lg",children:e.jsx(ce,{className:"text-3xl"})}),e.jsxs("div",{className:"flex flex-col h-full relative items-center gap-y-6",children:[e.jsxs("button",{onClick:()=>d("/EcoVibe/"),className:"text-3xl group flex items-center relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(st,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Back To Home"})]}),e.jsxs("button",{disabled:o!==200||n,onClick:()=>{t(),r()},className:"text-3xl disabled:hidden group flex items-center relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(ut,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Search Contacts"})]}),e.jsxs("button",{onClick:()=>d(a==="customer"?"/EcoVibe/bag/orders":"/EcoVibe/Dashboard/Orders"),className:"text-3xl group flex items-center relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(rt,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Check Orders"})]}),e.jsxs("button",{onClick:()=>d("/EcoVibe/Dashboard"),disabled:a==="customer",className:"text-3xl group flex items-center disabled:hidden relative hover:bg-gray-200 transition-all px-2 rounded-lg py-2",children:[e.jsx(at,{}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"Dashboard"})]}),e.jsxs("div",{onClick:()=>d(a==="customer"?"/EcoVibe/profile":`/EcoVibe/seller/${i}`),className:"text-3xl absolute bottom-2 group flex items-center hover:bg-gray-200 transition-all rounded-lg",children:[e.jsx(e.Fragment,{children:l!=null&&l.profilePic?e.jsx("img",{src:l==null?void 0:l.profilePic,className:"rounded-full size-14 object-cover"}):e.jsx("p",{className:"p-2",children:e.jsx(T,{})})}),e.jsx("p",{className:"absolute z-50 left-12 shadow-2xl shadow-gray-400 text-base bg-gray-50 border border-gray-300 px-4 py-1 rounded-xl invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all translate-y-10 group-hover:translate-y-0 text-nowrap",children:"My Profile"})]})]})]}),e.jsx("div",{onClick:()=>t(),className:`${s?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-40 bg-gray-950/50 backdrop-blur-sm`})]})}function es(){return e.jsx("div",{className:"h-2/5 overflow-auto absolute animate-pulse w-full bottom-1 styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-4 py-2 px-1",children:V(5).map((t,s)=>e.jsxs("div",{className:"h-28 anima flex flex-col items-start py-1.5 cursor-pointer border-b border-gray-300 hover:border-none hover:bg-gray-200 rounded-md p-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-x-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-x-2",children:[e.jsx("div",{className:"size-8 rounded-full bg-gray-300"}),e.jsx("h2",{className:"w-20 h-2 bg-gray-300 rounded-md"})]}),e.jsx("p",{className:"w-20 h-2 bg-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex flex-col gap-y-2 w-full py-2",children:V(4).map(r=>e.jsx("div",{className:"w-full h-2 bg-gray-300 rounded-md last:w-4/5"},r))})]},s))})})}const ts=()=>{const{selectedRoom:{receiver:t}}=N();return e.jsxs("div",{className:"size-full relative",children:[e.jsxs("div",{className:"flex flex-col items-center pt-4 pb-2 mb-3.5 gap-y-4 border-b border-gray-300",children:[e.jsx("div",{className:"size-24 gradient-background rounded-full",children:e.jsx("img",{src:t==null?void 0:t.profilePic,alt:"seller-avatar",className:"size-full rounded-full"})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("button",{className:"p-1.5 text-gray-800 hover:bg-gray-300 transition-all bg-gray-200 text-2xl rounded-lg",children:e.jsx(lt,{})}),e.jsx("button",{className:"p-1.5 text-gray-800 hover:bg-gray-300 transition-all bg-gray-200 text-2xl rounded-lg",children:e.jsx(T,{})})]})]}),e.jsxs("div",{className:"flex flex-col gap-y-2 h-1/3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-x-3",children:[e.jsx("p",{className:"text-lg font-semibold w-3/5",children:"Shop Name"}),e.jsx("p",{className:"w-2/5 line-clamp-1 break-words",children:t==null?void 0:t.business_name})]}),e.jsxs("div",{className:"flex items-center justify-center gap-x-3",children:[e.jsx("p",{className:"text-lg font-semibold w-3/5",children:"Career Title"}),e.jsx("p",{className:"w-2/5 line-clamp-1 break-words",children:t==null?void 0:t.career_title})]}),e.jsxs("div",{className:"flex items-center justify-center gap-x-3",children:[e.jsx("p",{className:"text-lg font-semibold w-3/5",children:"Email"}),e.jsx("p",{className:"w-2/5 line-clamp-1 break-words",children:t==null?void 0:t.email})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold",children:"Biography"}),e.jsx("p",{className:"line-clamp-4 lg:line-clamp-4 mt-1",children:(t==null?void 0:t.biography)||"Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident blanditiis sed velit, doloribus ipsam possimus tenetur autem! Amet dolorum excepturi earum, tempore exercitationem in quos sapiente voluptates nam aperiam molestiae"})]})]}),e.jsx("div",{className:"w-full h-1/3 justify-self-end",children:e.jsx(ss,{seller:t})})]})},ss=({seller:t})=>{const[{error:s,loading:r,reviews:l},a]=p.useState({reviews:[],loading:!1,error:null});p.useEffect(()=>{async function n(){try{a(f=>({...f,loading:!0}));const o=B(H(Y,"comments"),M("sellerId","==",t.receiverId)),d=await K(o).then(({docs:f})=>f.map(g=>g.data()));a({loading:!1,error:null,reviews:d})}catch(o){console.log(o),a({loading:!1,error:o,reviews:[]})}}n()},[]);function i(n){return new Date(n).toLocaleDateString()}if(r)return e.jsx(es,{});if(!r&&(l!=null&&l.length))return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("h4",{className:"text-lg font-bold z-10 bg-gray- 100",children:[l==null?void 0:l.length," Reviews"]}),e.jsx("div",{className:"lg:h-2/5 bg-gray-100 overflow-auto styled-scroll-bar pb-6 lg:pb-0",children:e.jsx("div",{className:"flex flex-col gap-y-4 py-2 px-1",children:l.map((n,o)=>e.jsxs("div",{className:"h-32 flex flex-col items-start py-1.5 cursor-pointer border-b border-gray-300 hover:border-none hover:bg-gray-200 rounded-md p-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-x-2",children:[e.jsx("div",{className:"size-8 rounded-full gradient-background bg-opacity-80",children:e.jsx("img",{src:n.authorProfile,alt:"author-profile",className:"size-full rounded-full"})}),e.jsx("h2",{className:"line-clamp-1 w-3/5 font-bold text-start",children:n.content.first_name}),e.jsx("p",{className:"",children:i(n.date)})]}),e.jsx("div",{className:"line-clamp-2 lg:line-clamp-3 mt-0.5 text-pretty py-1.5",children:n.content.review})]},o))})})]})};function rs(){return e.jsx("div",{className:"w-full h-2/5 px-2 py-1 overflow-auto styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-4",children:V(4).map((t,s)=>e.jsxs("div",{className:"w-full h-20 animate-pulse bg-gray-300 cursor-pointer rounded-md px-2 py-1 flex flex-col justify-evenly",children:[e.jsx("h4",{className:"w-full h-2 bg-gray-400 rounded-md"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"w-12 h-2 bg-gray-400 rounded-md"}),e.jsx("p",{className:"w-12 h-2 bg-gray-400 rounded-md"})]})]},s))})})}const as=({loading:t,orders:s})=>{const[r,l]=p.useState([]);return p.useEffect(()=>{const a=s.flatMap(n=>Object.values(n==null?void 0:n.orders).flatMap(({items:o})=>o)),i=Xe.map(({title:n})=>({title:n.split(" ")[0],profit:a.filter(({Category:o})=>o===n).reduce((o,d)=>o+Number(d.Price),0)}));l(i)},[s]),e.jsxs("div",{className:"w-full h-2/5",children:[e.jsx("h4",{className:"text-lg font-bold",children:"Orders of this customer:"}),e.jsx("div",{className:"size-full flex items-center justify-center",children:e.jsx(Nt,{width:"100%",height:"100%",className:`${t&&"animate-pulse"}`,children:e.jsxs(Zt,{cx:"50%",cy:"50%",outerRadius:"80%",data:r,children:[e.jsx($e,{}),e.jsx(Ae,{dataKey:"title",className:"text-xs"}),e.jsx(ee,{dataKey:"profit",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6})]})})})]})},ls=({loading:t,orders:s})=>{const{userId:r}=S(a=>a.userData);function l(a){return ae.filter(a,(o,d)=>d===r).map(o=>o.items.reduce((d,f)=>d+f.Price*f.quantity,0)).reduce((o,d)=>o+d,0)}if(t)return e.jsx(rs,{});if(!t&&s.length)return e.jsxs("div",{className:"w-full h-2/5",children:[e.jsx("h4",{className:"text-lg font-bold",children:"Orders of this customer:"}),e.jsx("div",{className:"px-2 pb-12 lg:py-1 h-[75%] lg:h-auto overflow-auto styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-4",children:s.map((a,i)=>e.jsxs("div",{className:"w-full h-24 bg-gray-200 cursor-pointer rounded-md px-2 py-1 flex flex-col justify-evenly",children:[e.jsx("h4",{className:"line-clamp-1 break-words font-bold",children:a.orderId}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Total price:"})," $",l(a.orders)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Order Date:"}),ge(a.createdAt,{})]})]})]},i))})})]})},ns=()=>{const[{loading:t,orders:s},r]=p.useState({orders:[],loading:!1}),{userId:l}=S(i=>i.userData),{selectedRoom:{receiver:a}}=N();return p.useEffect(()=>{async function i(){try{r(d=>({...d,loading:!0}));const n=Je(H(Y,"Orders"),M("customerId","==",a.receiverId),M("sellers","array-contains",l)),o=await K(n).then(({docs:d})=>d.map(f=>f.data()));r({loading:!1,orders:o})}catch(n){r({loading:!1,orders:[]}),console.log(n)}}i()},[]),e.jsxs("div",{className:"size-full flex-col flex gap-y-2",children:[e.jsxs("div",{className:"w-full h-1/5 flex items-center justify-start gap-x-4 px-4 py-2",children:[e.jsx("div",{className:"size-20 rounded-full",children:e.jsx("img",{src:a==null?void 0:a.profilePic,alt:"customer-avatar",className:"size-full rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-y-1 w-4/6",children:[e.jsx("h2",{className:"text-xl font-semibold line-clamp-1",children:(a==null?void 0:a.first_name)+" "+(a==null?void 0:a.last_name)}),e.jsx("p",{className:"text-gray-800",children:a==null?void 0:a.email}),e.jsx("p",{className:"text-gray-800",children:a==null?void 0:a.address})]})]}),e.jsx(as,{orders:s,loading:t}),e.jsx(ls,{orders:s,loading:t})]})};function is({modalShow:t,onCloseModal:s}){const[r,l]=p.useState(null),{selectedRoom:{receiver:a}}=N();if(p.useEffect(()=>{l((a==null?void 0:a.userType)==="customer"?"customer":"seller")},[a==null?void 0:a.userType]),r)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${t?"visible opacity-100 translate-x-0":"invisible opacity-0 translate-x-28"} w-full lg:w-96 fixed top-0 right-0 ease-in-out h-screen bg-gray-100 z-50 transition-all px-2.5 lg:px-4 py-2`,children:[e.jsx("button",{onClick:()=>s(),className:"absolute left-2 text-3xl lg:hidden z-50",children:e.jsx(ce,{})}),e.jsxs("div",{className:`${a.userType==="both"?"block":"hidden"} w-full flex py-2 items-center justify-between`,children:[e.jsx("button",{onClick:()=>l("seller"),className:`${r==="seller"&&"text-gray-950"} px-4 hover:text-gray-700 rounded-md w-1/2`,children:"Seller Info"}),e.jsx("button",{onClick:()=>l("customer"),className:`${r==="customer"&&"text-gray-950"} px-4 text-gray-500 lg:hover:text-gray-700 rounded-md w-1/2`,children:"Customer Info"})]}),r==="customer"?e.jsx(ns,{}):e.jsx(ts,{})]}),e.jsx("div",{onClick:()=>s(),className:`${t?"visible opacity-100":"invisible opacity-0"} fixed inset-0 bg-gray-950/60 backdrop-blur-sm z-40 transition-all`})]})}function os({setUserDetails:t,lastStatus:s}){const{setSelectedRoom:r,selectedRoom:l}=N(),{profilePic:a,status:i,first_name:n,business_name:o,userType:d}=(l==null?void 0:l.receiver)||{};return e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>{r(null)},className:"text-4xl hover:scale-110 transition-all",children:e.jsx(ce,{})}),e.jsx("div",{onClick:()=>t(!0),className:"cursor-pointer flex-none hover:opacity-80 hover:scale-[103%] transition-all",children:a?e.jsx("img",{src:a,className:"size-14 rounded-full",alt:"user-profile"}):e.jsx("div",{className:"size-12 lg:size-16 flex items-center justify-center bg-gray-200 rounded-full",children:e.jsx(T,{className:"text-4xl lg:text-6xl mt-3 rounded-full"})})}),e.jsxs("div",{onClick:()=>t(!0),className:"flex flex-col w-7/12 ml-4 cursor-pointer",children:[e.jsxs("h4",{className:d==="customer"?"":"flex flex-col gap-y-1",children:[e.jsx("p",{className:"text-lg font-bold line-clamp-1 break-words",children:d==="customer"?n:o||n}),e.jsx("p",{className:"-mt-1 text-sm line-clamp-1 break-words lg:text-base",children:s.current})]}),e.jsx("p",{children:i})]})]})}function cs(t){return Z({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"},child:[]}]})(t)}function ds(t){const{setContextMenu:s,contextMenu:r,setShowAlert:l,setUserDetails:a,setBarIsShow:i}=t,n=p.useRef();q(n,()=>s(()=>s(!1)));const{setSelectedRoom:o}=N();return e.jsx("div",{ref:n,className:"flex items-center gap-x-2 px-0.5 pt-1.5",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>s(!r),className:"text-3xl",children:e.jsx(cs,{})}),e.jsxs("div",{className:`${r?"opacity-100 visible":"opacity-0 invisible"} absolute transition-all w-60 overflow-hidden bg-gray-50 z-50 right-0 shadow-2xl rounded-sm flex flex-col`,children:[e.jsxs("button",{onClick:()=>{s(!1),i(!0)},className:"px-4 py-4 text-lg hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(Ee,{className:"text-2xl"})," Search bar"]}),e.jsxs("button",{onClick:()=>{a(!0),s(!1)},className:"px-4 py-4 text-lg hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(nt,{className:"text-2xl"})," User info"]}),e.jsxs("button",{onClick:()=>{o(null),s(!1)},className:"px-4 py-4 text-lg hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(de,{className:"text-2xl"}),"Close chat"]}),e.jsxs("button",{onClick:()=>{l(!0),s(!1)},className:"px-4 py-4 text-lg text-red-600 hover:bg-gray-200 transition-all flex items-center gap-x-3",children:[e.jsx(Re,{className:"text-2xl "}),"Delete chat"]})]})]})})}function us({barIsShow:t,setBarIsShow:s}){var x,h;const[r,l]=p.useState(""),[{results:a,selectedIndex:i},n]=p.useState({selectedIndex:0,results:[]}),{setSelectedMessage:o,selectedRoom:d,messageMode:f}=N(),{userId:g}=S(c=>c.userData);p.useEffect(()=>{if(t||l(""),r.length>0){const c=d==null?void 0:d.messageList.filter(({content:u,type:y,visibleTo:b})=>b.includes(g)&&y==="text"&&u.toLowerCase().includes(r.toLowerCase()));n({selectedIndex:0,results:c.reverse()})}else n({selectedIndex:0,results:[]})},[r,t,d]);const m=c=>{n(u=>({...u,selectedIndex:c==="up"?u.selectedIndex+1:u.selectedIndex-1}))};return p.useEffect(()=>{s(!1)},[d,f]),p.useEffect(()=>{t&&o(a[i])},[i,a]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${t?"visible opacity-100 translate-y-0":"opacity-0 invisible translate-y-10"} absolute top-0 w-full right-0 h-[4.5rem] bg-gray-100 transition-all flex items-center justify-center px-4`,children:[e.jsx("button",{onClick:()=>{s(!1),o(null)},className:"text-3xl",children:e.jsx(ce,{})}),e.jsx("input",{onChange:({target:c})=>l(c.value),value:r,type:"text",placeholder:"search messages",className:"flex-1 px-4 py-2 bg-transparent outline-none text-lg"}),e.jsx("button",{className:"text-3xl",children:e.jsx(Ee,{})})]}),t&&e.jsxs("div",{className:"w-full absolute right-0 bottom-0 z-50 h-16 bg-gray-50 flex items-center px-4 py-2 transition-all lg:opacity-100",children:[e.jsx("h4",{className:"text-lg font-bold",children:r!=null&&r.length?i?`${i+1} of ${a==null?void 0:a.length}`:`${a==null?void 0:a.length} Messages Find`:`Search Between ${(x=d.messageList)!=null&&x.length?(h=d.messageList)==null?void 0:h.length:0} Messages`}),e.jsxs("div",{className:`${a.length<=0&&"hidden"} flex flex-col absolute bg-gray-50/40 rounded-3xl backdrop-blur-sm right-8 gap-y-2 -top-28`,children:[e.jsx("button",{disabled:i===a.length-1,onClick:()=>m("up"),className:"p-2.5 text-2xl rounded-full bg-gray-100 -rotate-90 disabled:opacity-50 transition-all",children:e.jsx(we,{})}),e.jsx("button",{disabled:!i,onClick:()=>m("down"),className:"p-2.5 text-2xl rounded-full bg-gray-100 rotate-90 disabled:opacity-50 transition-all",children:e.jsx(we,{})})]})]})]})}function fs({setShowAlert:t}){const[s,r]=p.useState(null),[l,a]=p.useState(!1),i=p.useRef();q(i,()=>a(()=>a(!1)));const{selectedRoom:n}=N(),{last_name:o,business_name:d,userType:f,career_title:g,last_seen:m}=(n==null?void 0:n.receiver)||{},x=p.useRef(""),[h,c]=p.useState(!1);p.useEffect(()=>{if(!m){x.current=f!=="customer"?g||d:o;return}const y=L(),b=O(y,".info/serverTimeOffset");let v;const j=()=>{re(b,C=>{const R=Date.now()+C.val()-(m==null?void 0:m.date),ue=Math.floor(R/1e3);x.current=ue>=30||m!=null&&m.offline?`last seen at ${u(m==null?void 0:m.date)}`:"online"},{onlyOnce:!0})};return j(),v=setInterval(j,15e3),()=>{clearInterval(v)}},[m]);function u(y){return new Date(y).toLocaleTimeString("en-us",{year:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}return e.jsxs("div",{onContextMenu:y=>{y.preventDefault(),a(!0)},className:"w-full bg-gray-100 p-2 lg:px-4 flex items-center justify-between z-30 transition-all",children:[e.jsx(os,{lastStatus:x,setUserDetails:r}),e.jsx(ds,{contextMenu:l,setContextMenu:a,setShowAlert:t,setUserDetails:r,setBarIsShow:c}),e.jsx(is,{modalShow:s,onCloseModal:()=>r(null)}),e.jsx(us,{barIsShow:h,setBarIsShow:c})]})}function xs({message:t}){return e.jsxs("div",{className:" lg:w-72 h-20 border-l-4 relative border-gray-600 flex items-center gap-x-2.5 px-2 py-1",children:[e.jsx("div",{className:"size-16 lg:size-20 bg-gray-100 hover:bg-gray-100/90 transition-all overflow-hidden grid z-0 rounded-full grid-cols-2 grid-rows-2",children:t.order.thumbnails.map((s,r)=>r<3&&e.jsx("img",{className:"size-full object-cover -z-10",src:s},r))}),e.jsxs("div",{className:"w-4/6 flex flex-col gap-y-2.5",children:[e.jsxs("h4",{className:"line-clamp-1 break-words w-11/12 font-bold text-sm hover:underline",children:[t.order.orderId.slice(0,20),"..."]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs font-semibold",children:["$",t.order.totalPrice]}),e.jsxs("p",{className:"font-semibold text-xs",children:["date:  ",ge(t.order.createdAt,{year:"numeric",month:"2-digit",day:"2-digit"})]})]})]})]})}function ms({message:t}){const[s,r]=p.useState(!1);return e.jsx("div",{className:"w-64 lg:min-w-96",children:e.jsxs("div",{className:`${s&&"fixed inset-0 !h-full z-40"} w-full h-80 lg:h-96 rounded-lg overflow-hidden`,children:[e.jsx("div",{onClick:()=>r(!0),className:"size-full",children:e.jsx(De,{defaultCenter:[t.location[0],t.location[1]],defaultZoom:11,minZoom:3,maxZoom:18,mouseEvents:s,touchEvents:s,children:t.location&&e.jsx(ze,{color:"#1632e9",width:50,anchor:t.location})})}),s&&e.jsx("button",{onClick:()=>r(!1),className:"absolute top-2 right-2 p-2.5 bg-gray-50 rounded-full text-2xl z-50",children:e.jsx(de,{})})]})})}function hs({message:t}){return e.jsxs("div",{className:"h-72 lg:h-80 flex flex-col justify-evenly w-64 lg:w-96",children:[e.jsxs("div",{className:"w-full h-64 relative group rounded-md overflow-hidden",children:[e.jsx("img",{src:t.product.thumbnail,alt:"product-thumbnail",className:"size-full object-cover max-w-full "}),e.jsx("div",{className:"absolute inset-0 bg-gray-950/80 backdrop-blur flex items-center justify-center px-4 py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300",children:e.jsx("p",{className:"line-clamp-[10] text-gray-50 text-center",children:t.product.desc})})]}),e.jsxs("div",{className:"px-2 py-1",children:[e.jsx("h4",{className:"text-lg line-clamp-1 font-bold",children:t.product.name}),e.jsxs("p",{className:"font-semibold",children:["Price: $",t.product.price]})]})]})}function ps({setContextMenu:t,contextMenu:s,message:r,onDeleteMessage:l,position:a}){const i=p.useRef();q(i,()=>t(null));const{userId:n}=S(m=>m.userData),o=m=>m===n,{setSelectedMessage:d,setMode:f}=N();p.useEffect(()=>{},[r]);const g=async()=>{try{const m=document.createElement("input");m.value=r.content,document.body.appendChild(m),m.select(),document.execCommand("copy"),G.success("copied to clipboard")}catch{G.remove(),G.error("Failed to copy message")}};return e.jsxs("div",{ref:i,style:{top:o(r.senderId)?a.y-100:a.y,left:o(r.senderId)?a.x-100:a.x},className:`${s===r.uiid?"visible opacity-100":"invisible opacity-0"}
    w-28 h-fit fixed z-50 bg-gray-100 bottom-0 flex flex-col rounded-md transition-all`,children:[e.jsx("button",{onClick:()=>{d(r),f("reply"),t(!1)},className:"px-4 py-2 text-gray-950 bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all border-b border-b-gray-300",children:"reply"}),e.jsx("button",{disabled:(r==null?void 0:r.type)!=="text",onClick:()=>{g(),t(!1)},className:"disabled:hidden px-4 py-2 text-gray-950 bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all border-b border-b-gray-300",children:"copy"}),e.jsx("button",{onClick:()=>{d(r),f("edit"),t(!1)},className:"px-4 py-2 text-gray-950 disabled:hidden bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all border-b border-b-gray-300",disabled:!o(r.senderId)||r.type!=="text",children:"edit"}),e.jsx("button",{onClick:()=>l(r.uiid),className:"px-4 py-2 text-gray-950 bg-gray-100 rounded-md hover:bg-gray-950 hover:text-gray-50 transition-all disabled:hidden",disabled:!o(r.senderId),children:"delete"})]})}function gs({message:t,onDeleteMessage:s,setContextMenu:r,contextMenu:l}){var c;const[a,i]=p.useState({x:0,y:0}),[n,o]=p.useState(null),{selectedMessage:d,setSelectedMessage:f,selectedRoom:g}=N(),{userId:m}=S(u=>u.userData),x=u=>u===m;p.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),p.useEffect(()=>{var u;if(t!=null&&t.replyTo){const y=(u=g.messageList)==null?void 0:u.find(({uiid:b})=>b===t.replyTo);o(y)}},[t]);function h(u){return new Date(u).toLocaleDateString("en-US",{year:"numeric",hour:"2-digit",minute:"2-digit"}).split(",")[1]}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`${x(t.senderId)?"self-end bg-slate-200":"self-start bg-gray-50 items-end"} ${(d==null?void 0:d.uiid)===t.uiid&&"!bg-gray-900 text-gray-50 focused-message_shadow"} px-3 py-1.5 w-fit select-none rounded-md flex flex-col items-end gap-y-1 transition-all cursor-pointer max-w-[95%] lg:max-w-[60%]`,children:[e.jsxs("div",{id:t.uiid,onContextMenu:u=>{i({x:u.clientX,y:u.clientY}),u.preventDefault(),r(t.uiid)},children:[e.jsxs("div",{onClick:()=>{f(n),setTimeout(()=>{f(null)},1500)},className:`${n&&"!flex"} hidden h-16 w-full bg-primary-100/50 flex-col mb-2 mt-1 justify-evenly text-gray-900 rounded-lg border-l-4 border-primary-400/50 px-2 py-1`,children:[e.jsx("h4",{className:"text-lg font-bold",children:"Reply To"}),e.jsx("p",{className:"line-clamp-1 text-sm",children:(n==null?void 0:n.type)==="text"?n==null?void 0:n.content.slice(0,((c=n==null?void 0:n.content)==null?void 0:c.length)*10):`${n==null?void 0:n.type} message`})]}),t.type==="text"?e.jsx("p",{className:"text-start w-full break-words max-w-96",children:t.content}):t.type==="order"?e.jsx(xs,{message:t}):t.type==="location"?e.jsx(ms,{message:t}):e.jsx(hs,{message:t}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 w-full",children:[e.jsx("p",{className:"text-xs opacity-80 order-2",children:h(t.createdAt)}),(t==null?void 0:t.isEdited)&&e.jsx("p",{className:"text-xs opacity-70",children:"Edited"})]})]}),e.jsx(ps,{setContextMenu:r,contextMenu:l,message:t,onDeleteMessage:s,position:a})]})})}const ys=()=>{var x,h;const[t,s]=p.useState(null),[{alertIsShow:r,messageId:l},a]=p.useState({alertIsShow:"",messageId:null}),[i,n]=p.useState(null),{selectedRoom:o,selectedMessage:d}=N(),{userId:f}=S(c=>c.userData),g=p.useRef();p.useEffect(()=>{g.current&&(t?g.current.style.overflow="hidden":g.current.style.overflow="auto")},[t]);function m(c){if(!r)a({messageId:c,alertIsShow:!0});else{const u=L(),y=O(u,`rooms/${o.roomId}`);D(y,{messageList:[...o.messageList.filter(({uiid:b})=>b!==l)]}),a({messageId:null,alertIsShow:!1})}}if(p.useEffect(()=>{o&&n(o)},[]),p.useEffect(()=>{if(!i)return;const c=L(),u=O(c,`rooms/${i.roomId}/${f}/last_seen`);if(o){Ne(u,{date:A()});const y=setInterval(()=>{Ne(u,{date:A()})},45e3);return()=>{D(u,{date:A(),offline:!0}),clearInterval(y)}}return()=>{D(u,{date:A(),offline:!0})}},[i]),p.useEffect(()=>{d&&document.getElementById(`${d.uiid}`).scrollIntoView({behavior:"smooth",block:"end"})},[d]),p.useEffect(()=>{var u;if(d)return;const c=o.messageList;c!=null&&c.length&&document.getElementById(`${(u=c[(c==null?void 0:c.length)-1])==null?void 0:u.uiid}`).scrollIntoView({block:"end"})},[o.messageList]),!((x=o==null?void 0:o.messageList)!=null&&x.length))return e.jsx("div",{className:"bg-gray-300 w-full flex justify-center items-center flex-1",children:e.jsx("h4",{className:"px-4 py-2 bg-gray-200 rounded-md font-semibold",children:"Nothing yet"})});if((h=o==null?void 0:o.messageList)!=null&&h.length)return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:g,onContextMenu:c=>c.preventDefault(),className:"flex relative flex-col gap-y-2 w-full overflow-auto flex-1 px-2 pb-1 pt-2 bg-gray-300 styled-scroll-bar",children:o.messageList.map((c,u)=>{var y;return((y=c==null?void 0:c.visibleTo)==null?void 0:y.includes(f))&&e.jsx(gs,{message:c,onDeleteMessage:m,contextMenu:t,setContextMenu:s},u)})}),e.jsxs("div",{className:`${r?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex justify-center items-center transition-all`,children:[e.jsx(ye,{action:"Delete Message",closeModal:()=>a({messageId:null,alertIsShow:!1}),message:"Do you want to delete this message ?",submitCallBack:()=>m(),sureTitle:"Delete"}),e.jsx("div",{onClick:()=>a({alertIsShow:!1,messageId:null}),className:"absolute inset-0 bg-gray-950/50 backdrop-blur-sm -z-10"})]})]})};function bs(t){return Z({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"},child:[]}]})(t)}function vs(t){return Z({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75Z"},child:[]},{tag:"path",attr:{d:"M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Z"},child:[]}]})(t)}function js(t){return Z({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7.886 1.553a1.75 1.75 0 0 1 2.869.604l.633 1.629a5.667 5.667 0 0 0 3.725 3.395l3.959 1.131a1.749 1.749 0 0 1 .757 2.92L16.06 15l5.594 5.595a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L15 16.061l-3.768 3.768a1.749 1.749 0 0 1-2.92-.757l-1.131-3.96a5.665 5.665 0 0 0-3.395-3.724l-1.63-.633a1.75 1.75 0 0 1-.603-2.869Zm6.589 12.912 4.293-4.294a.25.25 0 0 0-.108-.417L14.7 8.623A7.165 7.165 0 0 1 9.99 4.33L9.357 2.7a.25.25 0 0 0-.41-.086L2.614 8.946a.25.25 0 0 0 .086.41l1.63.634a7.167 7.167 0 0 1 4.294 4.71l1.13 3.96a.25.25 0 0 0 .417.108l4.294-4.293Z"},child:[]}]})(t)}function Ns(t){return Z({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M2.287 2.326L2.692 2h.677v3h-.708V2.792l-.374.281v-.747zM5 3h10v1H5V3zm0 4h10v1H5V7zm10 4H5v1h10v-1zM3.742 7.626l.029-.039.065-.09a.84.84 0 0 0 .156-.507c0-.12-.02-.24-.057-.354a.848.848 0 0 0-.492-.529 1.123 1.123 0 0 0-.452-.082 1.094 1.094 0 0 0-.458.087.867.867 0 0 0-.479.522A1.038 1.038 0 0 0 2 6.957v.05h.81v-.05a.3.3 0 0 1 .046-.157.174.174 0 0 1 .057-.054.19.19 0 0 1 .172 0 .188.188 0 0 1 .056.06.24.24 0 0 1 .031.081.445.445 0 0 1-.036.29 1.309 1.309 0 0 1-.12.182l-1 1.138-.012.013v.54h1.988v-.7h-.9l.65-.724zm-.037 3.817c.046.032.086.07.12.114a.841.841 0 0 1 .167.55c0 .107-.017.213-.05.314a.792.792 0 0 1-.487.5 1.288 1.288 0 0 1-.48.079c-.115 0-.23-.016-.341-.049a.94.94 0 0 1-.258-.123.751.751 0 0 1-.182-.177 1.063 1.063 0 0 1-.116-.2A1.038 1.038 0 0 1 2 12.078v-.049h.814v.049c0 .027.003.055.009.082a.207.207 0 0 0 .03.074.14.14 0 0 0 .053.052.2.2 0 0 0 .157.008.159.159 0 0 0 .056-.039.22.22 0 0 0 .042-.075.417.417 0 0 0 .017-.126.483.483 0 0 0-.022-.163.2.2 0 0 0-.051-.08.138.138 0 0 0-.06-.029.537.537 0 0 0-.077-.007h-.161v-.645h.168a.241.241 0 0 0 .069-.011.164.164 0 0 0 .065-.034.175.175 0 0 0 .048-.067.286.286 0 0 0 .021-.121.28.28 0 0 0-.016-.1.166.166 0 0 0-.097-.099.2.2 0 0 0-.156.007.164.164 0 0 0-.055.053.344.344 0 0 0-.04.156v.049H2v-.049a.987.987 0 0 1 .18-.544.8.8 0 0 1 .179-.186.87.87 0 0 1 .262-.133c.114-.036.234-.053.354-.051.116-.001.231.01.344.036.092.021.18.055.263.1a.757.757 0 0 1 .32.318.73.73 0 0 1 .09.347.81.81 0 0 1-.167.528.562.562 0 0 1-.12.114z"},child:[]}]})(t)}function ws(t){return Z({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M6.306 2.146l-4.02 4.02v.708l4.02 4.02.708-.707L3.807 6.98H5.69c2.813 0 4.605.605 5.705 1.729 1.102 1.125 1.615 2.877 1.615 5.421v.35h1v-.35c0-2.646-.527-4.72-1.9-6.121C10.735 6.605 8.617 5.98 5.69 5.98H3.887l3.127-3.126-.708-.708z"},child:[]}]})(t)}function Ss(){return e.jsx(e.Fragment,{children:V(3).map((t,s)=>e.jsxs("div",{className:"w-full cursor-pointer animate-pulse hover:bg-gray-300 transition-all h-24 bg-gray-200 rounded-md flex items-center px-2 py-2 gap-x-2.5 relative",children:[e.jsx("div",{className:"size-20 bg-gray-100 overflow-hidden grid z-10 rounded-full grid-cols-2 grid-rows-2"}),e.jsxs("div",{className:"w-4/6",children:[e.jsx("h4",{className:"w-3/4 h-2 mb-4 bg-gray-400 rounded-md"}),e.jsx("p",{className:"w-1/4 h-2 bg-gray-400 rounded-md"})]}),e.jsx("p",{className:"absolute right-2.5 bottom-2 w-14 h-2 bg-gray-400 rounded-md"})]},s))})}function Cs({orderData:t,ordersType:s,onCloseModal:r}){const{orders:l,createdAt:a,orderId:i,totalPrice:n}=t,{selectedRoom:o,setMode:d,setSelectedMessage:f,messageMode:g,selectedMessage:m}=N(),{userId:x}=S(u=>u.userData),h=J();function c(){const u=L(),y=O(u,`rooms/${o.roomId}`);D(y,{members:[x,o.receiver.receiverId],messageList:[...(o==null?void 0:o.messageList)||[],{uiid:oe(x),type:"order",senderId:x,createdAt:A(),order:{orderId:i,createdAt:a,totalPrice:n,thumbnails:l.items.map(b=>b.Thumbnail)},replyTo:g==="reply"?m.uiid:null,visibleTo:[x,o.receiver.receiverId]}]}),r(),f(null),d(null)}return e.jsxs("div",{onClick:()=>c(),className:"w-full cursor-pointer hover:bg-gray-300 transition-all h-28 bg-gray-200 rounded-md flex items-center px-2 py-2 gap-x-2.5 relative",children:[e.jsx("div",{className:"size-20 bg-gray-100 overflow-hidden grid z-10 rounded-full grid-cols-2 grid-rows-2",children:l.items.map(({Thumbnail:u},y)=>y<3&&e.jsx("img",{className:"size-full object-cover -z-10",src:u},y))}),e.jsxs("div",{className:"w-4/6",children:[e.jsx("h4",{className:"line-clamp-1 break-words font-bold mb-1.5 w-11/12",children:i}),e.jsxs("p",{className:"text-gray-800 font-semibold",children:["Prcie: $",n]})]}),e.jsx("button",{onClick:()=>h(s==="sells"?`/EcoVibe/Dashboard/orders/${i}`:"/EcoVibe/bag/orders"),className:"absolute right-2 top-1.5 text-2xl opacity-70 hover:opacity-100 transition-all",children:e.jsx(vs,{})}),e.jsx("p",{className:"absolute right-2.5 bottom-1 text-xs",children:ge(a)})]})}function Is({onCloseModal:t}){const[{loading:s,orders:r,ordersType:l},a]=p.useState({loading:!1,orders:[],ordersType:"sells"}),[i,n]=p.useState(""),{selectedRoom:o}=N(),{userId:d,userType:f}=S(x=>x.userData);p.useEffect(()=>{a(x=>({...x,ordersType:f==="customer"?"purchases":"sells"}))},[f]);async function g(){try{a(u=>({...u,loading:!0}));const x=B(H(Y,"Orders"),l==="purchases"?M("customerId","==",d):M("sellers","array-contains",d)),c=(await K(x).then(({docs:u})=>u.map(y=>({...y.data()})))).map(u=>({...u,orders:l==="purchases"?u.orders[o.receiver.receiverId]:u.orders[d]})).filter(u=>l==="purchases"?u.orders:u.customerId===o.receiver.receiverId);a(u=>({...u,loading:!1,orders:c}))}catch(x){a(h=>({...h,loading:!1})),console.log(x)}}p.useEffect(()=>{g()},[l]);function m(){return r.filter(({orderId:x})=>x.toLowerCase().includes(i.toLowerCase()))}return e.jsxs("div",{className:"size-full bg-gray-50 rounded-md px-2 py-2 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",onChange:({target:x})=>n(x.value),value:i,placeholder:"search orders",className:"px-4 py-2 w-full rounded-md outline-none bg-gray-50 border border-gray-300"}),e.jsxs("div",{className:`${f==="customer"&&"hidden"} mb-1 mt-2 flex items-center justify-between gap-x-1`,children:[e.jsx("button",{onClick:()=>a(x=>({...x,ordersType:"sells"})),className:`${l==="sells"&&"!border-gray-600"} px-4 py-3 w-1/2 h-full border-b-2 border-transparent transition-all`,children:"my sells"}),e.jsx("button",{onClick:()=>a(x=>({...x,ordersType:"purchases"})),className:`${l==="purchases"&&"!border-gray-600"} px-4 py-3 border-b-2 border-transparent w-1/2 h-full transition-all`,children:"my purchases"})]})]}),e.jsx("div",{className:"w-full overflow-auto h-full scroll-smooth styled-scroll-bar",children:e.jsx("div",{className:"flex flex-col gap-y-2 px-2 py-1",children:s?e.jsx(Ss,{}):r.length?m().map((x,h)=>e.jsx(Cs,{orderData:x,onCloseModal:t,ordersType:l},h)):e.jsx("h4",{className:"m-auto text-center my-20 text-lg font-semibold line-clamp-2",children:l==="sells"?"you have no orders from this customer":"you have no purchase this seller"})})})]})}function Ps({onCloseModal:t}){const[s,r]=p.useState(null),{userId:l}=S(g=>g.userData),{messageMode:a,selectedMessage:i,setSelectedMessage:n,setMode:o,selectedRoom:d}=N();function f(){const g={location:s,senderId:l,createdAt:A(),uiid:oe(l),type:"location",replyTo:a==="reply"?i.uiid:null,visibleTo:[l,d.receiver.receiverId]},m=L(),x=O(m,`rooms/${d.roomId}`);D(x,{messageList:[...(d==null?void 0:d.messageList)||[],g],members:[l,d.receiver.receiverId]}),t(),n(null),o(null)}return e.jsxs("div",{className:"size-full bg-gray-50 rounded-md relative",children:[e.jsx("div",{className:"w-full h-full rounded-t-md overflow-hidden",children:e.jsx(De,{onClick:g=>r(g.latLng),defaultCenter:[35.77142984637282,51.46089654722849],defaultZoom:11,minZoom:3,maxZoom:18,children:s&&e.jsx(ze,{color:"#1632e9",width:50,anchor:s})})}),e.jsx("button",{disabled:!s,onClick:f,className:"px-4 py-2 bg-primary-500 rounded-2xl text-gray-50 disabled:bg-gray-400 transition-all absolute bottom-2 right-2",children:"Send Location"}),e.jsx("button",{onClick:()=>t(),className:"absolute top-1 right-1 bg-gray-100 p-1.5 text-xl rounded-full",children:e.jsx(de,{})})]})}function Os({onCloseModal:t}){const[{loading:s,products:r,error:l},a]=p.useState({loading:!1,products:[],error:null}),{userId:i}=S(h=>h.userData),{selectedRoom:n,messageMode:o,selectedMessage:d,setSelectedMessage:f,setMode:g}=N();async function m(){try{a(u=>({...u,loading:!0}));const h=B(H(Y,"Products"),M("SellerId","in",[i,n.receiver.receiverId])),c=await K(h).then(({docs:u})=>u.map(y=>({...y.data(),id:y.id})));a({loading:!1,products:c,error:!c.length&&404})}catch(h){a({loading:!1,products:[],error:h}),console.log(h)}}p.useEffect(()=>{m()},[]);function x(h){const c={senderId:i,createdAt:A(),uiid:oe(i),replyTo:o==="reply"?d.uiid:null,type:"product",product:{id:h.id,thumbnail:h.Thumbnail,desc:h.Description,price:h.Price,name:h.Name},visibleTo:[i,n.receiver.receiverId]},u=L(),y=O(u,`rooms/${n.roomId}`);D(y,{messageList:[...(n==null?void 0:n.messageList)||[],c],members:[i,n.receiver.receiverId]}),t(),f(null),g(null)}return l?e.jsx("div",{className:"size-full bg-gray-50 rounded-md overflow-hidden px-2 py-1 flex flex-col justify-center items-center",children:e.jsx("h2",{className:"text-center font-medium text-lg",children:"No product related to you or your contact was found."})}):e.jsxs("div",{className:"size-full bg-gray-50 rounded-md overflow-hidden px-2 py-1 flex flex-col justify-evenly",children:[e.jsx("div",{className:"",children:e.jsx("input",{type:"text",placeholder:"Search Your Products",className:"w-full h-10 bg-gray-200 rounded-md px-4"})}),e.jsx("div",{className:"overflow-auto styled-scroll-bar h-5/6 px-2 py-1",children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:s?V(5).map((h,c)=>e.jsxs("div",{className:"h-48 animate-pulse bg-gray-200 rounded-lg px-2 flex flex-col justify-evenly cursor-pointer",children:[e.jsx("div",{alt:"item-thumbnail",className:"w-full bg-gray-300 h-36 object-cover rounded-lg"}),e.jsx("h4",{className:"w-20 h-2 bg-gray-400 rounded-md"})]},c)):r==null?void 0:r.map((h,c)=>e.jsxs("div",{onClick:()=>x(h),className:"h-48 bg-gray-200 rounded-lg px-2 flex flex-col justify-evenly cursor-pointer",children:[e.jsx("img",{src:h.Thumbnail,alt:"item-thumbnail",className:"w-full h-36 object-cover rounded-lg"}),e.jsx("h4",{className:"line-clamp-1 text-sm font-bold",children:h.Name})]},c))})})]})}function Ls(){const{messageMode:t}=N(),[{modalIsShow:s,type:r},l]=p.useState({modalIsShow:!1,type:null});function a(){l({modalIsShow:!1,type:null})}return e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:t==="edit",className:"text-3xl disabled:opacity-50 text-gray-900 py-2 rounded-md peer",children:e.jsx(bs,{})}),e.jsxs("div",{className:"w-72 z-50 flex flex-col absolute bg-gray-100 -top-44 left-2 rounded-md opacity-0 invisible peer-disabled:hidden peer-hover:visible peer-hover:opacity-100 hover:visible hover:opacity-100 transition-all",children:[e.jsxs("button",{onClick:()=>l({modalIsShow:!0,type:"order"}),className:"px-4 py-4 hover:bg-gray-200 transition-all rounded-md flex items-center justify-start gap-x-2",children:[e.jsx("span",{children:e.jsx(Ns,{})}),e.jsx("p",{children:"Share Order"})]}),e.jsxs("button",{onClick:()=>l({modalIsShow:!0,type:"location"}),className:"px-4 py-4 hover:bg-gray-200 transition-all rounded-md flex items-center justify-start gap-x-2",children:[e.jsx("span",{children:e.jsx(js,{})}),e.jsx("p",{children:"Send Location"})]}),e.jsxs("button",{onClick:()=>l({modalIsShow:!0,type:"product"}),className:"px-4 py-4 hover:bg-gray-200 transition-all rounded-md flex items-center justify-start gap-x-2",children:[e.jsx("span",{children:e.jsx(wt,{})}),e.jsx("p",{children:"Send Product"})]})]}),e.jsxs("div",{className:`${s?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex items-center justify-center transition-all`,children:[e.jsx("div",{className:"w-80 h-[70vh] max-h-[30rem] lg:size-96 p-2",children:r==="order"?e.jsx(Is,{onCloseModal:a}):r==="location"?e.jsx(Ps,{onCloseModal:a}):e.jsx(Os,{onCloseModal:a})}),e.jsx("div",{onClick:()=>l({modalIsShow:!1,type:null}),className:"absolute inset-0 bg-gray-950/50 -z-10"})]})]})}function Ms(){const{setSelectedMessage:t,selectedMessage:s,messageMode:r,setMode:l,selectedRoom:a}=N(),{first_name:i,last_name:n,business_name:o,userType:d}=(a==null?void 0:a.receiver)||{};return e.jsx("div",{className:`${r?"block":"hidden"} w-full h-20`,children:e.jsxs("div",{className:"size-full bg-gray-50 flex items-center gap-x-4 px-4 py-2",children:[e.jsx("p",{className:"text-3xl",children:r==="reply"?e.jsx(ws,{}):e.jsx(St,{})}),e.jsxs("div",{className:"w-full h-full flex flex-col justify-evenly",children:[e.jsxs("h4",{className:"text-xl font-bold line-clamp-1",children:[r==="edit"?"Edit Message...":`Reply To ${d==="customer"?i+" "+n:o} `,`${s==null?void 0:s.type} Message`]}),e.jsx("p",{className:"text-sm line-clamp-2",children:(s==null?void 0:s.type)==="text"?s==null?void 0:s.content:s==null?void 0:s.type})]}),e.jsx("button",{onClick:()=>{t(null),l(null)},className:"text-3xl",children:e.jsx(de,{})})]})})}function ks(){const[t,s]=p.useState(""),[r,l]=p.useState(1),{userId:a}=S(x=>x.userData),{setSelectedMessage:i,selectedMessage:n,messageMode:o,setMode:d,selectedRoom:f}=N();p.useEffect(()=>{const x=t==null?void 0:t.length,h=[180,260,350,440];l(ae.findIndex(h,c=>x<=c)+1||10)},[t]),p.useEffect(()=>{o==="edit"&&s(n==null?void 0:n.content)},[o]);const g=()=>{const x={content:t,senderId:a,createdAt:A(),uiid:oe(a),replyTo:o==="reply"?n.uiid:null,type:"text",visibleTo:[a,f.receiver.receiverId]},h=L(),c=O(h,`rooms/${f.roomId}`);D(c,{messageList:[...(f==null?void 0:f.messageList)||[],x],members:[a,f.receiver.receiverId]}),i(null),d(null),s("")},m=()=>{const x=[...f==null?void 0:f.messageList],h=x.findIndex(({uiid:y})=>y===n.uiid);x[h]={...x[h],content:t,isEdited:!0};const c=L(),u=O(c,`rooms/${f.roomId}`);D(u,{messageList:x}),i(null),d(null),s("")};return e.jsxs("div",{id:"input_message",className:`${o&&"min-h-36 flex flex-col"} w-full transition-all`,children:[e.jsx(Ms,{}),e.jsxs("div",{className:"w-full bg-gray-50 px-4 pb-2 pt-1 flex items-end justify-between relative",children:[e.jsx(Ls,{}),e.jsx("textarea",{rows:r,value:t,onKeyDown:x=>{x.key==="Enter"&&t.length&&(x.preventDefault(),o==="edit"?m():g())},onChange:x=>{s(x.target.value)},type:"text",placeholder:"write new message",className:"px-4 py-2.5 resize-none transition-all min-h-12 flex-1 outline-none text-lg text-wrap bg-transparent styled-scroll-bar"}),e.jsx("button",{disabled:!t.length,onClick:()=>o==="edit"?m():g(),className:"text-4xl disabled:text-primary-950 disabled:opacity-50 text-primary-500 hover:text-primary-700 p-2 rounded-md",children:e.jsx(it,{})})]})]})}function Rs(t,s,r,l){p.useEffect(()=>{const a=(o,d)=>{const f=d==="move"?o.touches[0]:o.changedTouches[0],g=f.screenY-f.pageY;if(d==="move"&&g<87){const m=(f.pageY-f.screenY)/50+1.5,x=Math.min(Math.max(m*85,0),180);r({opacity:m/3,rotate:x})}d==="end"&&(g<-20?s(null):g<87&&(l.current.scrollIntoView({block:"start",behavior:"smooth"}),r({rotate:0,opacity:0})))},i=o=>a(o,"move"),n=o=>a(o,"end");return window.addEventListener("touchmove",i),window.addEventListener("touchend",n),()=>{window.removeEventListener("touchmove",i),window.removeEventListener("touchend",n)}},[t,s,r,l])}function Es({deleteRoom:t}){var m;const s=p.useRef(),{selectedRoom:r,setSelectedRoom:l,rooms:a}=N(),{appHeight:i}=Fe(),[{opacity:n,rotate:o},d]=p.useState({opacity:0,rotate:0});Rs(r,l,d,s);const[f,g]=p.useState(!1);if(!r)return e.jsx("div",{className:"hidden col-span-9 col-start-4 bg-slate-200 lg:flex items-center justify-center relative",children:e.jsx("p",{className:"text-lg font-bold bg-gray-50/50 backdrop-blur-sm px-4 py-2 rounded-xl cursor-pointer",children:"Please Select A Chat First..."})});if(r)return e.jsxs("div",{style:{height:i},className:`${r?"col-span-9 col-start-4 flex":"hidden"} lg:! flex flex-col lg:w-3/4 !w-full h-full bg-slate-200 items-center justify-center relative`,children:[e.jsx("div",{ref:s,className:"w-full",children:e.jsx(fs,{deleteRoom:t,setShowAlert:g})}),e.jsx(ys,{}),e.jsx(ks,{}),e.jsxs("div",{style:{opacity:n},className:"absolute w-full h-32 -bottom-32 z-50 transition-all flex items-center justify-center gap-x-2",children:[e.jsx("p",{style:{rotate:`${o}deg`},className:"transition-all text-3xl rotate-180 duration-700",children:e.jsx(ot,{})}),e.jsx("h4",{className:"text-xl font-bold",children:"Return to Chats"})]}),e.jsxs("div",{className:`${f?"opacity-100 visible":"opacity-0 invisible"} fixed inset-0 z-50 flex justify-center items-center transition-all`,children:[e.jsx(ye,{action:`Delete chat with ${(m=r==null?void 0:r.receiver)==null?void 0:m.first_name} ?`,closeModal:()=>g(!1),message:"Are You Sure You Want To Delete This Chat?, you cannot access messages again...",submitCallBack:()=>t(r.roomId,a)}),e.jsx("div",{onClick:()=>g(!1),className:"absolute inset-0 bg-gray-950/50 -z-10"})]})]})}function As({user:t,searchType:s,orders:r,onCloseModal:l}){const[a,i]=p.useState(null),{userType:n}=S(c=>c.userData),{personalInformation:o,businessInformation:d,userId:f}=t||{},g=J(),{setSelectedRoom:m}=N(),{createRoom:x}=It();p.useEffect(()=>{if(s==="orders"){const c=r==null?void 0:r.filter(({customerId:y,sellers:b})=>n!=="customer"?y===f:b.includes(f)),u=c.reduce((y,b)=>b.createdAt.seconds>y.createdAt.seconds?b:y,c[0]);i(u)}},[s,r,t]);const h=()=>{const c={...t.personalInformation,...t.businessInformation,userId:t.userId,userType:t.userType};x(c,({roomId:u})=>{m({roomId:u,owner:{...o,...d,userType:n,userId:f},receiver:{...c,receiverId:c.userId},members:[f,t.userId]}),l()})};return e.jsxs("div",{onClick:h,className:"w-full h-28 flex items-center px-4 py-2 gap-x-4 cursor-pointer hover:bg-gray-200 transition-all rounded-xl",children:[o.profilePic?e.jsx("img",{src:o.profilePic,className:"size-20 bg-gray-100 rounded-full"}):e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(T,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-y-1.5",children:[e.jsx("h4",{className:"line-clamp-1 w-40 text-lg font-bold break-words",children:o.first_name+" "+o.last_name}),e.jsx("p",{className:"text-sm line-clamp-2 font-semibold",children:s==="orders"?e.jsxs("div",{onClick:()=>g(n==="customer"?`/EcoVibe/bag/orders/${a.orderId.replace("#","")}/${f}`:`/EcoVibe/Dashboard/orders/${a.orderId.replace("#","")}`),className:"hover:opacity-80 transition-all",children:["last order:",e.jsx("p",{className:"line-clamp-1 w-40 break-words",children:a==null?void 0:a.orderId})]}):e.jsx(e.Fragment,{children:(d==null?void 0:d.business_name)||(d==null?void 0:d.career_title)||"seller"})})]})]})}function Ds(){return e.jsxs("div",{className:"w-80 lg:w-96 h-[90vh] 2xl:h-[45rem] bg-gray-50 rounded-md z-10 p-2 flex flex-col",children:[e.jsx("div",{className:"flex bg-gray-200 rounded-md relative",children:e.jsx("input",{disabled:!0,type:"text",placeholder:"search contacts",className:"w-full px-4 py-2 bg-transparent placeholder:text-gray-600 outline-none rounded-md"})}),e.jsx("div",{className:"flex-1 overflow-auto h-[27rem] xl:h-[35rem] styled-scroll-bar my-2",children:e.jsx("div",{className:"inline-flex flex-col w-full gap-y-4 h-full",children:V(20).map((t,s)=>e.jsxs("div",{className:"w-full animate-pulse h-28 flex items-center px-4 py-2 gap-x-4 cursor-pointer hover:bg-gray-200 transition-all rounded-xl",children:[e.jsx("div",{className:"size-16 lg:size-20 flex items-center justify-center group bg-gray-200 text-gray-500 rounded-full",children:e.jsx(T,{className:"text-6xl lg:text-7xl mt-3 group-hover:mt-2 transition-all rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-y-2.5",children:[e.jsx("p",{className:"w-36 h-2 bg-gray-300 rounded-md"}),e.jsx("p",{className:"w-24 h-2 bg-gray-300 rounded-md"})]})]},s))})})]})}function zs({searchQuery:t,setQuery:s,menuIsShow:r,setTab:l,searchType:a}){const i=p.useRef();q(i,()=>l(o=>({...o,menuIsShow:!1})));const{userType:n}=S(o=>o.userData);return e.jsxs("div",{className:"flex bg-gray-200 rounded-md relative",children:[e.jsx("input",{type:"text",value:t,onChange:({target:o})=>s(o.value.toLocaleLowerCase()),placeholder:"search contacts",className:"w-full px-4 py-2 bg-transparent placeholder:text-gray-600 outline-none rounded-md"}),e.jsxs("div",{ref:i,children:[e.jsx("button",{onClick:()=>l(o=>({...o,menuIsShow:!0})),className:"px-2 h-full text-2xl hover:text-gray-500 transition-all",children:e.jsx(Ct,{})}),e.jsxs("div",{className:`${r?"translate-y-0 opacity-100 visible":"-translate-y-10 opacity-0 invisible"} absolute top-14 transition-all right-0 w-48 h-24 bg-gray-100 justify-evenly px-2 py-1 rounded-md flex flex-col`,children:[e.jsx("div",{className:"tooltip absolute -top-1 right-8 bg-gray-200"}),e.jsx("button",{onClick:()=>l({menuIsShow:!1,searchType:"all"}),className:`${a==="all"&&"bg-gray-300"} px-4 py-2 rounded-md hover:bg-gray-200 transition-all`,children:"All Sellers"}),e.jsx("hr",{}),e.jsx("button",{onClick:()=>l({menuIsShow:!1,searchType:"orders"}),className:`${a==="orders"&&"bg-gray-300"} px-4 py-2 rounded-md hover:bg-gray-200 transition-all`,children:n==="customer"?"From my purchases":"My Customers"})]})]})]})}function $s({onCloseModal:t}){const[{menuIsShow:s,searchType:r},l]=p.useState({searchType:"all",menuIsShow:!1}),[a,i]=p.useState(""),[{loading:n,userList:o},d]=p.useState({userList:[],loading:!1}),[f,g]=p.useState([]),{userType:m,userId:x}=S(u=>u.userData);async function h(){if(r==="orders")try{const u=B(H(Y,"Orders"),m!=="customer"?M("sellers","array-contains",x):M("customerId","==",x)),y=await K(u).then(({docs:v})=>v.map(j=>j.data()));g(y);const b=y.flatMap(({sellers:v,customerId:j})=>m!=="customer"?j:ae.uniq(v));return m==="customer"?b:ae.uniq(b)}catch(u){console.log(u)}}p.useEffect(()=>{async function u(){try{d(j=>({...j,loading:!0}));const y=await h(),b=B(H(Y,"users"),r==="all"?M("userType","in",["seller","both"]):M("userId","in",y)),v=await K(b).then(({docs:j})=>j.map(C=>C.data()).filter(C=>C.userId!==x));d({userList:v,loading:!1,error:null})}catch(y){d({userList:[],loading:!1,error:y}),console.log(y)}}u()},[r,x]);function c(u){let y=[];return y=o.filter(b=>{const{personalInformation:v,businessInformation:j}=b,{first_name:C,last_name:k}=v||{},{business_name:R}=j||{};if(C.toLowerCase().includes(u)||k!=null&&k.toLowerCase().includes(u)||R!=null&&R.toLowerCase().includes(a))return b}),u!==""?y:o}if(n)return e.jsx(Ds,{});if(!n)return e.jsxs("div",{className:"w-80 lg:w-96 h-[90vh] 2xl:h-[45rem] bg-gray-50 rounded-md z-10 p-2 flex flex-col",children:[e.jsx(zs,{searchQuery:a,setQuery:i,menuIsShow:s,setTab:l,searchType:r}),e.jsx("div",{className:"flex-1 overflow-auto h-[27rem] xl:h-[35rem] styled-scroll-bar my-2",children:e.jsx("div",{className:"inline-flex flex-col w-full gap-y-4 h-full",children:o.length?c(a).map((u,y)=>e.jsx(As,{user:u,searchType:r,orders:f,onCloseModal:t},y)):e.jsxs("h4",{className:"text-xl font-bold text-center flex-1 flex items-center justify-center",children:["You have no  ",m==="customer"?"order yet...":"customer yet",", you can change filter to all sellers"]})})})]})}function er(){const[t,s]=p.useState(!1),[r,l]=p.useState(!1),{userId:a}=S(n=>n.userData);function i(n,o){var x,h;const d=o.findIndex(c=>c.roomId===n),f={...o[d]},g=L(),m=O(g,`rooms/${f.roomId}`);((x=f.members)==null?void 0:x.length)<2?et(m):(D(m,{members:f.members.filter(c=>c!==a),messageList:((h=f.messageList)==null?void 0:h.map(c=>({...c,visibleTo:c.visibleTo.filter(u=>u!==a)})))||[]}),G.success("Room Is Deleted Successfully"))}return e.jsx(Wt,{children:e.jsx("div",{className:"mx-auto 2xl:max-w-screen-2xl fixed w-full z-50",children:e.jsxs("div",{className:"lg:flex justify-between h-full",children:[e.jsx(Jt,{onCloseNav:()=>s(!1),navIsShow:t,openContacts:()=>l(!0)}),e.jsxs("div",{className:"flex-1 h-full lg:grid grid-cols-12",children:[e.jsx(Xt,{openSideNav:()=>s(!0),deleteRoom:i}),e.jsx(Es,{deleteRoom:i}),e.jsxs("div",{className:`${r?"opacity-100 visible":"opacity-0 invisible"} inset-0 fixed flex items-center justify-center z-50 transition-all`,children:[e.jsx($s,{onCloseModal:()=>l(!1)}),e.jsx("div",{onClick:()=>l(!1),className:"absolute inset-0 bg-gray-950/85 backdrop-blur-sm"})]})]})]})})})}export{er as default};
