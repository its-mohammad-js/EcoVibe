import{g as B,a as j,r as p,b as h,c as q,q as x,h as A,i as k}from"./index.esm2017-CV0xs99B.js";import{r as o,b as D}from"./index-DjBRLo1V.js";import{l as y}from"./lodash-CGynJUam.js";const C=(u,a)=>{const[m,c]=o.useState(!1),[b,f]=o.useState([]),i=o.useRef([]),d=o.useRef(a),n=B(),{userId:l,auth_status:E,loading:R}=D(e=>e.userData),v=()=>{const e=p(n,"stories"),s=u?x(e,k("authorId"),A(u)):e;h(s,g=>{const t=Object.values(g.val()||{});if(i.current=t,!d.current){const r=S(t);f(r)}})},S=e=>{const s=y.groupBy(e,"authorId");return Object.keys(s).forEach(t=>{s[t]=s[t].map(r=>({...r,isSeen:r.seenBy.includes(l)}))}),y.sortBy(Object.keys(s),t=>s[t].every(r=>r.isSeen)).map(t=>({authorId:t,slides:s[t]}))};return o.useEffect(()=>{d.current=a},[a]),o.useEffect(()=>{j(n);const e=p(n,".info/connected");return h(e,s=>{s.val()===!0&&!R?(v(),c(!1)):c(!0)}),()=>{q(n)}},[E,l]),o.useEffect(()=>{if(!a){const e=S(i.current);f(e)}},[a]),{loading:m,groupedStories:b}};export{C as u};
