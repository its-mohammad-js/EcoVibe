import{g as S,r as g,e as q,u as x,a as A,b as j,c as B,q as T,h as $,i as w}from"./index.esm2017-CFaB4tgL.js";import{r as f,ba as G,bb as H,cA as k,_ as y,u as Q}from"./index-CI59rSFI.js";import{l as D}from"./lodash-BaoyRbXr.js";function C(c){const[d,o]=f.useState(!1);return{loading:d,onDeleteSlide:async(i,e=()=>{})=>{try{const a=S();o(!0);const p=G(H,i.contentUrl);await k(p);const l=g(a,`stories/${i.id}`);q(l),o(!1),e()}catch(a){y.error("There was an error on delete story, please try again later"),o(!1),e(),console.log(a)}},onRemoveHighlight:async i=>{try{o(!0),c(!1);const e=S(),a=g(e,`stories/${i.id}`);x(a,{highlightRef:null,title:null}),y.success("highlight removed successfully"),o(!1),c(!0)}catch(e){y.error("There was an error on remove highlight, please try again later"),o(!1),c(!1),console.log(e)}}}}const F=(c,d)=>{const[o,h]=f.useState(!1),[b,i]=f.useState([]),e=S(),{userId:a,loading:p}=Q(n=>n.userData),l=f.useRef(),E=()=>{const n=g(e,"stories"),t=c?T(n,w("authorId"),$(c)):n;j(t,m=>{const s=Object.values(m.val()||{});i(s)})},L=n=>{const t=D.groupBy(n,"authorId");Object.keys(t).forEach(s=>{t[s]=t[s].map(r=>{var u;return{...r,isSeen:(u=r.seenBy)==null?void 0:u.includes(a)}})});const m=D.sortBy(Object.keys(t),s=>t[s].every(r=>r.isSeen));return l.current=d?l.current:m,l.current.map(s=>{var u,R,v,_,O;const r=t[s];return{authorId:s,first_name:(R=(u=r[0])==null?void 0:u.author)==null?void 0:R.first_name,last_name:(_=(v=r[0])==null?void 0:v.author)==null?void 0:_.last_name,profile_pic:(O=r[0])==null?void 0:O.authorProfilePic,slides:r}})};return f.useEffect(()=>{A(e);const n=g(e,".info/connected");return j(n,t=>{t.val()===!0&&!p?(E(),h(!1)):h(!0)}),()=>{B(e)}},[a]),{loading:o,groupedStories:L(b)}};export{C as a,F as u};
